{"version":3,"file":"index.js","sources":["../src/helpers/access.ts","../src/composables/Mountable.ts","../src/helpers/removeUndefined.ts","../src/helpers/shallowEqual.ts","../src/composables/Stateful.ts","../src/helpers/createIsSupportedSignal.ts","../src/with-checks/throwifyWithChecksFp.ts","../src/errors.ts","../src/with-checks/withChecksFp.ts","../src/composables/Button.ts","../src/features/BackButton/BackButton.ts","../src/fn-options/sharedFeatureOptions.ts","../src/fn-options/createFnOption.ts","../src/globals/signals-registry.ts","../src/globals/postEvent.ts","../src/fn-options/withPostEvent.ts","../src/helpers/component-storage.ts","../src/helpers/navigation.ts","../src/fn-options/withStateRestore.ts","../src/globals/version.ts","../src/fn-options/withVersion.ts","../src/fn-options/buttonOptions.ts","../src/features/BackButton/instance.ts","../src/composables/AsyncMountable.ts","../src/features/Biometry/Biometry.ts","../src/globals/request.ts","../src/fn-options/withRequest.ts","../src/features/Biometry/instance.ts","../src/features/ClosingBehavior/ClosingBehavior.ts","../src/features/ClosingBehavior/instance.ts","../src/features/CloudStorage/CloudStorage.ts","../src/globals/createRequestId.ts","../src/globals/invokeCustomMethod.ts","../src/fn-options/withInvokeCustomMethod.ts","../src/features/CloudStorage/instance.ts","../src/features/DeviceStorage/DeviceStorage.ts","../src/fn-options/withCreateRequestId.ts","../src/features/DeviceStorage/instance.ts","../src/features/emoji-status/requestEmojiStatusAccess.ts","../src/features/emoji-status/setEmojiStatus.ts","../src/features/HapticFeedback/HapticFeedback.ts","../src/features/HapticFeedback/instance.ts","../src/features/home-screen/addToHomeScreen.ts","../src/features/home-screen/checkHomeScreenStatus.ts","../src/features/InitData/InitData.ts","../src/features/InitData/instance.ts","../src/features/Invoice/Invoice.ts","../src/features/Invoice/instance.ts","../src/features/links/openLink.ts","../src/features/links/openTelegramLink.ts","../src/features/links/shareURL.ts","../src/features/LocationManager/LocationManager.ts","../src/features/LocationManager/instance.ts","../src/features/MainButton/MainButton.ts","../src/helpers/css-vars.ts","../src/helpers/isColorDark.ts","../src/features/ThemeParams/ThemeParams.ts","../src/globals/themeParams.ts","../src/features/ThemeParams/instance.ts","../src/fn-options/bottomButtonOptions.ts","../src/features/MainButton/instance.ts","../src/features/MiniApp/MiniApp.ts","../src/features/MiniApp/instance.ts","../src/features/Popup/prepareParams.ts","../src/features/Popup/Popup.ts","../src/features/Popup/instance.ts","../src/features/privacy/requestPhoneAccess.ts","../src/features/privacy/requestContact.ts","../src/features/privacy/requestWriteAccess.ts","../src/features/QrScanner/QrScanner.ts","../src/features/QrScanner/instance.ts","../src/features/SecondaryButton/SecondaryButton.ts","../src/features/SecondaryButton/instance.ts","../src/features/SecureStorage/SecureStorage.ts","../src/features/SecureStorage/instance.ts","../src/features/SettingsButton/SettingsButton.ts","../src/features/SettingsButton/instance.ts","../src/features/SwipeBehavior/SwipeBehavior.ts","../src/features/SwipeBehavior/instance.ts","../src/features/uncategorized/copyTextToClipboard.ts","../src/features/uncategorized/downloadFile.ts","../src/features/uncategorized/getCurrentTime.ts","../src/features/uncategorized/hideKeyboard.ts","../src/features/uncategorized/readTextFromClipboard.ts","../src/features/uncategorized/retrieveAndroidDeviceDataFrom.ts","../src/features/uncategorized/retrieveAndroidDeviceData.ts","../src/features/uncategorized/sendData.ts","../src/features/uncategorized/shareMessage.ts","../src/features/uncategorized/shareStory.ts","../src/globals/isInlineMode.ts","../src/features/uncategorized/switchInlineQuery.ts","../src/features/Viewport/Viewport.ts","../src/features/Viewport/instance.ts","../src/init.ts"],"sourcesContent":["import type { MaybeAccessor } from '@/types.js';\n\nexport function access<T>(value: MaybeAccessor<T>): T {\n  return typeof value === 'function' ? (value as any)() as T : value;\n}\n","import { batch, computed, signal } from '@tma.js/signals';\nimport { either as E, function as fn } from 'fp-ts';\n\nimport { access } from '@/helpers/access.js';\nimport type { MaybeAccessor } from '@/types.js';\n\nexport interface MountableOptions<S, Err> {\n  /**\n   * A state to use if the `restoreState` function returned falsy value or\n   * `isPageReload` returned false.\n   */\n  initialState: S | (() => E.Either<Err, S>);\n  /**\n   * @returns True if the current page was reloaded.\n   */\n  isPageReload: MaybeAccessor<boolean>;\n  /**\n   * A function to call whenever the component was mounted.\n   * @param state - restored state.\n   */\n  onMounted?: (state: S) => void;\n  /**\n   * A function to call whenever the component was unmounted.\n   */\n  onUnmounted?: VoidFunction;\n  /**\n   * Attempts to restore previously saved component state. This function\n   * will only be called if the current page was reloaded.\n   */\n  restoreState: () => (S | undefined);\n}\n\nexport class Mountable<S extends object, Err = never> {\n  constructor({\n    onMounted,\n    restoreState,\n    initialState,\n    onUnmounted,\n    isPageReload,\n  }: MountableOptions<S, Err>) {\n    this.mount = () => {\n      if (this.isMounted()) {\n        return E.right(undefined);\n      }\n      const restored = access(isPageReload) ? restoreState() : undefined;\n      const state = restored\n        ? E.right(restored)\n        : (typeof initialState === 'function' ? initialState() : E.right(initialState));\n\n      return fn.pipe(state, E.map(s => {\n        batch(() => {\n          this._isMounted.set(true);\n          onMounted?.(s);\n        });\n      }));\n    };\n\n    this.unmount = () => {\n      if (this._isMounted()) {\n        batch(() => {\n          this._isMounted.set(false);\n          onUnmounted?.();\n        });\n      }\n    };\n  }\n\n  private readonly _isMounted = signal(false);\n\n  /**\n   * Signal indicating if the component is mounted.\n   */\n  readonly isMounted = computed(this._isMounted);\n\n  /**\n   * Mounts the component restoring its state and calling required side effects.\n   */\n  readonly mount: () => E.Either<Err, void>;\n\n  /**\n   * Unmounts the component.\n   */\n  readonly unmount: () => void;\n}\n","import type { UnionRequiredKeys } from '@tma.js/toolkit';\n\ntype RemoveUndefined<T> = {\n  [K in UnionRequiredKeys<T>]-?: T[K]\n};\n\n/**\n * @returns Object with keys having undefined values.\n * @param value - an object to remove undefined values from.\n */\nexport function removeUndefined<T extends {}>(value: T): RemoveUndefined<T> {\n  const result = {} as RemoveUndefined<T>;\n  for (const k in value) {\n    const v = value[k];\n    v !== undefined && ((result as any)[k] = v);\n  }\n  return result;\n}\n","export function shallowEqual<T extends object>(a: T, b: T): boolean {\n  const aKeys = Object.keys(a);\n  const bKeys = Object.keys(b);\n  return aKeys.length !== bKeys.length\n    ? false\n    : aKeys.every(aKey => {\n      return Object.prototype.hasOwnProperty.call(b, aKey)\n        && (a as any)[aKey] === (b as any)[aKey];\n    });\n}\n","import { type Computed, computed, type Signal, signal } from '@tma.js/signals';\n\nimport { removeUndefined } from '@/helpers/removeUndefined.js';\nimport { shallowEqual } from '@/helpers/shallowEqual.js';\n\nexport interface StatefulOptions<S> {\n  /**\n   * The initial state.\n   */\n  initialState: S;\n  /**\n   * A function to call whenever the state changes.\n   * @param state - updated state.\n   */\n  onChange: (state: S) => void;\n}\n\nexport class Stateful<S extends object> {\n  constructor({ initialState, onChange }: StatefulOptions<S>) {\n    this._state = signal(initialState, { equals: shallowEqual });\n    this.state = computed(this._state);\n    this.state.sub(onChange);\n  }\n\n  protected readonly _state: Signal<S>;\n\n  /**\n   * The current state.\n   */\n  readonly state: Computed<S>;\n\n  /**\n   * Creates a computed signal based on the state.\n   * @param key - a state key to use as a source.\n   */\n  getter<K extends keyof S>(key: K): Computed<S[K]> {\n    return computed(() => this._state()[key]);\n  }\n\n  /**\n   * Updates the state.\n   * @param state - updates to apply.\n   */\n  readonly setState = (state: Partial<S>): void => {\n    const nextState = { ...this.state(), ...removeUndefined(state) };\n    if (!shallowEqual(nextState, this.state())) {\n      this._state.set(nextState);\n    }\n  };\n\n  /**\n   * @returns True if specified payload will update the state.\n   * @param state\n   */\n  hasDiff(state: Partial<S>): boolean {\n    return !shallowEqual({ ...this.state(), ...removeUndefined(state) }, this.state());\n  }\n}\n","import { type MethodName, supports } from '@tma.js/bridge';\nimport { type Computed, computed } from '@tma.js/signals';\nimport type { Version } from '@tma.js/types';\n\nimport { access } from '@/helpers/access.js';\nimport type { MaybeAccessor } from '@/types.js';\n\nexport function createIsSupportedSignal(\n  method: MethodName,\n  version: MaybeAccessor<Version>,\n): Computed<boolean> {\n  return computed(() => supports(method, access(version)));\n}\n","import { throwifyFpFn, throwifyAnyEither, type AnyFn } from '@tma.js/toolkit';\nimport { function as fn, option as O } from 'fp-ts';\n\nimport type { WithChecksFp, WithChecks } from '@/with-checks/withChecksFp.js';\n\n// #__NO_SIDE_EFFECTS__\nexport function throwifyWithChecksFp<\n  Fn extends AnyFn,\n  HasSupportCheck extends boolean,\n  SupportsMapKeySchema extends string,\n>(\n  fn_: WithChecksFp<Fn, HasSupportCheck, SupportsMapKeySchema>,\n): WithChecks<Fn, HasSupportCheck, SupportsMapKeySchema> {\n  return Object.assign(throwifyFpFn(fn_), {\n    ifAvailable(...args: Parameters<Fn>) {\n      return fn.pipe(\n        fn_.ifAvailable(...args),\n        O.match(\n          () => ({ ok: false }),\n          data => ({\n            ok: true,\n            data: throwifyAnyEither(data),\n          }),\n        ),\n      );\n    },\n  }) as unknown as WithChecks<Fn, HasSupportCheck, SupportsMapKeySchema>;\n}\n","import { errorClass, errorClassWithData } from 'error-kid';\nimport type { BaseIssue } from 'valibot';\n\nfunction msgToTuple(message?: string): [string?] {\n  return [message];\n}\n\nexport class ValidationError extends /* #__PURE__ */ errorClassWithData<\n  { input: unknown; issues: BaseIssue<any>[] },\n  [input: unknown, issues: BaseIssue<any>[]]\n>(\n  'ValidationError',\n  (input, issues) => ({ input, issues }),\n  'Validation error',\n) {\n}\n\nexport class CSSVarsBoundError extends /* #__PURE__ */ errorClass(\n  'CSSVarsBoundError',\n  'CSS variables are already bound',\n) {\n}\n\nexport class DeviceStorageMethodError extends /* #__PURE__ */ errorClassWithData<\n  { error: string },\n  [error: string]\n>('DeviceStorageMethodError', error => ({ error }), error => [error]) {\n}\n\nexport class SecureStorageMethodError extends /* #__PURE__ */ errorClassWithData<\n  { error: string },\n  [error: string]\n>('SecureStorageMethodError', error => ({ error }), error => [error]) {\n}\n\nexport class NotAvailableError extends /* #__PURE__ */ errorClass<[message: string]>(\n  'NotAvailableError',\n  msgToTuple,\n) {\n}\n\nexport class InvalidEnvError extends /* #__PURE__ */ errorClass<[message?: string]>(\n  'InvalidEnvError',\n  msgToTuple,\n) {\n}\n\nexport class FunctionUnavailableError extends /* #__PURE__ */ errorClass<[message?: string]>(\n  'FunctionNotAvailableError',\n  msgToTuple,\n) {\n}\n\nexport class InvalidArgumentsError extends /* #__PURE__ */ errorClass<[message: string, cause?: unknown]>(\n  'InvalidArgumentsError',\n  (message, cause) => [message, { cause }],\n) {\n}\n\nexport class ConcurrentCallError extends /* #__PURE__ */ errorClass<[message: string]>(\n  'ConcurrentCallError',\n  msgToTuple,\n) {\n}\n\nexport class SetEmojiStatusError extends /* #__PURE__ */ errorClass<[error: string]>(\n  'SetEmojiStatusError',\n  error => [`Failed to set emoji status: ${error}`],\n) {\n}\n\nexport class AccessDeniedError extends /* #__PURE__ */ errorClass<[message: string]>(\n  'AccessDeniedError',\n  msgToTuple,\n) {\n}\n\nexport class FullscreenFailedError extends /* #__PURE__ */ errorClass<[message: string]>(\n  'FullscreenFailedError',\n  msgToTuple,\n) {\n}\n\nexport class ShareMessageError extends /* #__PURE__ */ errorClass<[error: string]>(\n  'ShareMessageError',\n  msgToTuple,\n) {\n}\n\nexport class UnknownThemeParamsKeyError extends /* #__PURE__ */ errorClass<[key: string]>(\n  'UnknownThemeParamsKeyError',\n  key => [`Unknown theme params key passed: ${key}`],\n) {\n}\n","import {\n  type MethodName,\n  supports,\n  type MethodNameWithVersionedParams,\n  type MethodVersionedParams,\n} from '@tma.js/bridge';\nimport { type Computed, computed } from '@tma.js/signals';\nimport type {\n  If,\n  IsNever,\n  AnyFnAnyEither,\n  RightOfReturn,\n  LeftOfReturn,\n  MaybeMonadReturnTypeToCommon,\n  MaybeCommonReturnTypeToMonad,\n  AnyFn,\n} from '@tma.js/toolkit';\nimport type { Version } from '@tma.js/types';\nimport { either as E, option as O, taskEither as TE } from 'fp-ts';\n\nimport { FunctionUnavailableError } from '@/errors.js';\nimport { access } from '@/helpers/access.js';\nimport type { MaybeAccessor } from '@/types.js';\n\ntype IfReturnsTask<Fn extends AnyFnAnyEither, A, B> =\n  ReturnType<Fn> extends TE.TaskEither<any, any> ? A : B;\n\ntype OptionsBasedRequires<O extends WithChecksOptions<any>> = O extends { requires: any }\n  ? true : false;\n\ntype OptionsBasedSupports<O extends WithChecksOptions<any>> = O extends { supports: any }\n  ? Extract<keyof O['supports'], string> : never;\n\ntype OptionsBasedFn<Opts extends WithChecksOptions<any>> = (...args: any[]) => (\n  Opts['returns'] extends 'plain'\n    ? any\n    : Opts['returns'] extends 'promise'\n      ? PromiseLike<any>\n      : Opts['returns'] extends 'task'\n        ? TE.TaskEither<any, any>\n        : E.Either<any, any>\n);\n\n/**\n * @returns Error text if something is wrong.\n */\nexport type CustomSupportFn = () => string | undefined;\n\nexport type Require =\n  | MethodName\n  | CustomSupportFn\n  | { every: (MethodName | CustomSupportFn)[] }\n  | { some: (MethodName | CustomSupportFn)[] };\n\n/**\n * A map where the key is a method name with versioned parameters, and the value is a tuple\n * containing the method and parameter names. The third tuple value is a function accepting\n * the wrapped function arguments and returning true if support check must be applied.\n */\nexport type SupportsMap<Args extends any[]> = {\n  [OptionName: string]: {\n    [M in MethodNameWithVersionedParams]: {\n      /**\n       * Method name.\n       * @example 'web_app_set_header_color'\n       */\n      method: M;\n      /**\n       * Method version-dependent parameter.\n       * @example `color`\n       */\n      param: MethodVersionedParams<M>;\n      /**\n       * @returns True if the support function should be called.\n       * @param args - function arguments.\n       */\n      shouldCheck: (...args: Args) => boolean;\n    };\n  }[MethodNameWithVersionedParams];\n};\n\ntype WrappedFnReturnType<Fn extends AnyFn> = ReturnType<Fn> extends E.Either<any, any>\n  ? E.Either<FunctionUnavailableError | LeftOfReturn<Fn>, RightOfReturn<Fn>>\n  : ReturnType<Fn> extends TE.TaskEither<any, any>\n    ? TE.TaskEither<FunctionUnavailableError | LeftOfReturn<Fn>, RightOfReturn<Fn>>\n    : ReturnType<Fn> extends PromiseLike<infer U>\n      ? TE.TaskEither<FunctionUnavailableError, U>\n      : E.Either<FunctionUnavailableError, ReturnType<Fn>>;\n\nexport type WrappedFn<Fn extends AnyFn> = (...args: Parameters<Fn>) => WrappedFnReturnType<Fn>;\n\nexport type WithChecksFp<\n  Fn extends AnyFn,\n  HasSupportCheck extends boolean,\n  SupportsMapKeySchema extends string = never,\n> =\n  & WrappedFn<Fn>\n  & {\n  /**\n   * A signal returning `true` if the function is available in the current environment and\n   * conditions.\n   *\n   * To be more accurate, the method checks the following:\n   * 1. The current environment is Telegram Mini Apps.\n   * 2. The SDK package is initialized (if this requirement is specified).\n   * 3. If passed, the `isSupported` signal returned true.\n   * 4. If passed, the `isMounted` signal returned true.\n   *\n   * *You should use this function when possible because it provides must-have code security\n   * mechanisms and makes a developer sure that he is using the package properly.*\n   *\n   * @returns True if the function is available in the current environment.\n   * @example\n   * if (backButton.show.isAvailable()) {\n   *   backButton.show();\n   * }\n   */\n    isAvailable: Computed<boolean>;\n    /**\n   * Calls the function only in case it is available.\n   *\n   * It uses the `isAvailable` internally to check if the function is available for call.\n   * @example\n   * backButton.show.ifAvailable();\n   */\n    ifAvailable(...args: Parameters<Fn>): O.Option<MaybeCommonReturnTypeToMonad<Fn>>;\n  }\n  & If<HasSupportCheck, {\n  /**\n   * The signal returning `true` if the function is supported by the Telegram client,\n   * including some possible additional conditions.\n   *\n   * It is highly recommended to use this signal only in certain narrow cases when only the\n   * function support check is required, but not its availability.\n   *\n   * This signal is not applying additional operations like checking if the current environment\n   * is Mini Apps and the SDK is initialized.\n   *\n   * To check if the function is available for use, use the `isAvailable` signal.\n   *\n   * @returns True if this function is supported.\n   * @see isAvailable\n   * @example\n   * if (backButton.show.isSupported()) {\n   *   console.log('The method is supported');\n   * }\n   */\n    isSupported: Computed<boolean>;\n  }, {}>\n  & If<IsNever<SupportsMapKeySchema>, {}, {\n  /**\n   * A map where the key is the function-specific option name and value is a signal indicating\n   * if it is supported by the current environment.\n   * @example\n   * if (miniApp.setHeaderColor.isAvailable()) {\n   *   if (miniApp.setHeaderColor.supports('rgb')) {\n   *     miniApp.setHeaderColor('#ffaabb');\n   *   } else {\n   *     miniApp.setHeaderColor('bg_color');\n   *   }\n   * }\n   */\n    supports: (key: SupportsMapKeySchema) => boolean;\n  }>;\n\nexport type WithChecks<\n  Fn extends AnyFn,\n  HasSupportCheck extends boolean,\n  SupportsMapKeySchema extends string = never,\n> =\n  & ((...args: Parameters<Fn>) => MaybeMonadReturnTypeToCommon<Fn>)\n  & Omit<WithChecksFp<Fn, HasSupportCheck, SupportsMapKeySchema>, 'ifAvailable'>\n  & {\n  /**\n   * Calls the function only in case it is available.\n   *\n   * It uses the `isAvailable` internally to check if the function is available for call.\n   * @example\n   * backButton.show.ifAvailable();\n   */\n    ifAvailable(...args: Parameters<Fn>):\n      | { ok: true; data: MaybeMonadReturnTypeToCommon<Fn> }\n      | { ok: false };\n  };\n\nexport interface WithChecksOptions<Fn extends AnyFn> {\n  /**\n   * Signal returning true if the owning component is mounted.\n   */\n  isMounted?: () => boolean;\n  /**\n   * Signal returning true if the owning component is mounting.\n   */\n  isMounting?: () => boolean;\n  /**\n   * A value determining the function requirements. This will enable additional checks for\n   * the function before being called.\n   */\n  requires?: Require;\n  /**\n   * A signal to retrieve the current Telegram Mini Apps version or the value itself.\n   */\n  isTma: MaybeAccessor<boolean>;\n  /**\n   * A map where the key is a method name with versioned parameters, and the value is a tuple\n   * containing the method and parameter names. The third tuple value is a function accepting\n   * the wrapped function arguments and returning true if support check must be applied.\n   */\n  supports?: SupportsMap<Parameters<Fn>>;\n  /**\n   * A signal to retrieve the current Telegram Mini Apps version or the value itself.\n   */\n  version?: MaybeAccessor<Version>;\n  /**\n   * Allows to determine what exactly should be returned from the function - TaskEither or Either.\n   * There is no other way to know it until the function itself is called, but we need to perform\n   * some checks before calling it and return a valid value based on the function return type.\n   */\n  returns: Fn extends AnyFnAnyEither\n    ? IfReturnsTask<Fn, 'task', 'either'>\n    : ReturnType<Fn> extends PromiseLike<any> ? 'promise' : 'plain';\n}\n\nexport function withChecksFp<Fn extends AnyFn, O extends WithChecksOptions<Fn>>(\n  fn: Fn,\n  options: O,\n): WithChecksFp<Fn, OptionsBasedRequires<O>, OptionsBasedSupports<O>> {\n  const version = computed(() => access(options.version) || '100');\n  const isTma = computed(() => access(options.isTma));\n\n  // Simplify the isSupported value to work with an array of validators or a single object.\n  const { requires: optionsIsSupported, returns } = options;\n  const isSupportedSimplified = optionsIsSupported\n    ? typeof optionsIsSupported === 'object'\n      ? optionsIsSupported\n      : { every: [optionsIsSupported] }\n    : undefined;\n\n  /**\n   * @param optionName - target option.\n   * @returns True if specified option is supported.\n   */\n  const isOptionSupported = (optionName: string): boolean => {\n    if (!options.supports) {\n      return true;\n    }\n    const optionSettings = options.supports[optionName];\n    return supports(optionSettings.method, optionSettings.param, version());\n  };\n\n  /**\n   * @returns All found errors according to the isSupported variable value.\n   */\n  const calculateSupportError = (): string | undefined => {\n    // isSupported was not specified. In this case, we assume that the function has no\n    // dependencies and is always supported.\n    if (!isSupportedSimplified) {\n      return;\n    }\n    const [mode, requirements] = 'every' in isSupportedSimplified\n      ? ['every', isSupportedSimplified.every] as const\n      : ['some', isSupportedSimplified.some] as const;\n\n    for (let i = 0; i < requirements.length; i++) {\n      const requirement = requirements[i];\n      const error = typeof requirement === 'function'\n        ? requirement()\n        : supports(requirement, version())\n          ? undefined\n          : `it is unsupported in Mini Apps version ${version()}`;\n      // Return only if there was an error and all requirements must be satisfied, or\n      // this was the last one requirement (when some of the requirements must be met).\n      if (error && (mode === 'every' || i === requirements.length - 1)) {\n        return error;\n      }\n    }\n  };\n\n  /**\n   * @returns An error related to supports.<name> check.\n   */\n  const calculateOptionSupportError = (\n    ...args: Parameters<Fn>\n  ): string | undefined => {\n    for (const k in options.supports) {\n      if (options.supports[k].shouldCheck(...args) && !isOptionSupported(k)) {\n        return `option ${k} is not supported in Mini Apps version ${version()}`;\n      }\n    }\n  };\n\n  const isSupported = computed(() => !calculateSupportError());\n  const isInitialized = computed(() => version() !== '0.0');\n  const isMounted = computed(() => (options.isMounted ? options.isMounted() : true));\n  const isAvailable = computed(\n    () => isTma()\n      && isInitialized()\n      && isSupported()\n      && isMounted(),\n  );\n\n  const wrapError = (message: string): WrappedFnReturnType<Fn> => {\n    const err = new FunctionUnavailableError(message);\n    return (['task', 'promise'].includes(options.returns)\n      ? TE.left(err)\n      : E.left(err)) as WrappedFnReturnType<Fn>;\n  };\n\n  const call = (...args: Parameters<Fn>): MaybeCommonReturnTypeToMonad<Fn> => {\n    if (returns === 'plain') {\n      return E.tryCatch(() => fn(...args), e => e) as MaybeCommonReturnTypeToMonad<Fn>;\n    }\n    if (returns === 'promise') {\n      return TE.tryCatch(() => fn(...args), e => e) as MaybeCommonReturnTypeToMonad<Fn>;\n    }\n    return fn(...args);\n  };\n\n  return Object.assign(\n    (...args: Parameters<Fn>): WrappedFnReturnType<Fn> => {\n      const errMessagePrefix = 'Unable to call function:';\n      if (!isTma()) {\n        return wrapError(`${errMessagePrefix} it can't be called outside Mini Apps`);\n      }\n      if (!isInitialized()) {\n        return wrapError(`${errMessagePrefix} the SDK was not initialized. Use the SDK init() function`);\n      }\n      const supportErr = calculateSupportError();\n      if (supportErr) {\n        return wrapError(`${errMessagePrefix} ${supportErr}`);\n      }\n      const supportsOptionErr = calculateOptionSupportError(...args);\n      if (supportsOptionErr) {\n        return wrapError(`${errMessagePrefix} ${supportsOptionErr}`);\n      }\n      if (!isMounted()) {\n        const message = options.isMounting?.()\n          ? 'mounting. Wait for the mount completion'\n          : 'unmounted. Use the mount() method';\n        return wrapError(`${errMessagePrefix} the component is ${message}`);\n      }\n      return call(...args) as WrappedFnReturnType<Fn>;\n    },\n    fn,\n    {\n      isAvailable,\n      ifAvailable(...args: Parameters<Fn>): O.Option<MaybeCommonReturnTypeToMonad<Fn>> {\n        return isAvailable() ? O.some(call(...args)) : O.none;\n      },\n    },\n    isSupportedSimplified ? { isSupported } : {},\n    options.supports ? { supports: isOptionSupported } : {},\n  );\n}\n\nexport function createWithChecksFp<O extends WithChecksOptions<any>>(options: O) {\n  return <Fn extends OptionsBasedFn<O>>(fn: Fn): WithChecksFp<\n    Fn,\n    OptionsBasedRequires<O>,\n    OptionsBasedSupports<O>\n  > => withChecksFp(fn, options);\n}\n","import type { PostEventError, MethodName, MethodParams } from '@tma.js/bridge';\nimport { computed, type Computed } from '@tma.js/signals';\nimport { either as E, function as fn } from 'fp-ts';\n\nimport { Mountable } from '@/composables/Mountable.js';\nimport { Stateful } from '@/composables/Stateful.js';\nimport type { SharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport type { WithPostEvent } from '@/fn-options/withPostEvent.js';\nimport type { WithStateRestore } from '@/fn-options/withStateRestore.js';\nimport type { WithVersion } from '@/fn-options/withVersion.js';\nimport { createIsSupportedSignal } from '@/helpers/createIsSupportedSignal.js';\nimport { removeUndefined } from '@/helpers/removeUndefined.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport {\n  type WithChecksFp,\n  type WithChecks,\n  createWithChecksFp,\n} from '@/with-checks/withChecksFp.js';\n\ntype ButtonEither = E.Either<PostEventError, void>;\n\ntype BoolFields<S> = {\n  [K in keyof S]-?: S[K] extends boolean ? K : never;\n}[keyof S];\n\nexport interface ButtonOptions<S, M extends MethodName>\n  extends SharedFeatureOptions,\n  WithStateRestore<S>,\n  WithPostEvent,\n  WithVersion {\n  /**\n   * The initial button state.\n   */\n  initialState: S;\n  /**\n   * Removes a component click listener.\n   * @param listener - a listener to remove.\n   * @param once - should the listener be called only once.\n   */\n  offClick: (listener: VoidFunction, once?: boolean) => void;\n  /**\n   * Adds a component click listener.\n   * @returns A function to remove listener.\n   * @param listener - a listener to add.\n   * @param once - should the listener be called only once.\n   */\n  onClick: (listener: VoidFunction, once?: boolean) => VoidFunction;\n  /**\n   * A Mini Apps method to commit changes.\n   */\n  method: M;\n  /**\n   * A function to create method payload.\n   * @param state\n   */\n  payload: (state: S) => MethodParams<M>;\n}\n\nexport class Button<S extends object, M extends MethodName> {\n  constructor({\n    isTma,\n    storage,\n    onClick,\n    offClick,\n    initialState,\n    isPageReload,\n    postEvent,\n    payload,\n    method,\n    version,\n  }: ButtonOptions<S, M>) {\n    const stateful = new Stateful({\n      initialState,\n      onChange(state) {\n        storage.set(state);\n      },\n    });\n    const mountable = new Mountable<S>({\n      initialState,\n      isPageReload,\n      onMounted: stateful.setState,\n      restoreState: storage.get,\n    });\n\n    const wrapOptions = { version, requires: method, isTma };\n    const wrapSupportedPlain = createWithChecksFp({\n      ...wrapOptions,\n      returns: 'plain',\n    });\n    const wrapMountedEither = createWithChecksFp({\n      ...wrapOptions,\n      returns: 'either',\n      isMounted: mountable.isMounted,\n    });\n\n    this.isMounted = mountable.isMounted;\n    this.isSupported = createIsSupportedSignal(method, version);\n    this.state = stateful.state;\n\n    this.setStateFp = wrapMountedEither(state => {\n      const nextState = { ...this.state(), ...removeUndefined(state) };\n      if (!stateful.hasDiff(nextState)) {\n        return E.right(undefined);\n      }\n      return fn.pipe(\n        postEvent(method as any, payload(nextState)),\n        E.map(() => {\n          stateful.setState(nextState);\n        }),\n      );\n    });\n    this.setState = throwifyWithChecksFp(this.setStateFp);\n    this.onClickFp = wrapSupportedPlain(onClick);\n    this.onClick = throwifyWithChecksFp(this.onClickFp);\n    this.offClickFp = wrapSupportedPlain(offClick);\n    this.offClick = throwifyWithChecksFp(this.offClickFp);\n    this.mountFp = wrapSupportedPlain(() => {\n      const nothing = () => undefined;\n      return fn.pipe(mountable.mount(), E.match(nothing, nothing));\n    });\n    this.mount = throwifyWithChecksFp(this.mountFp);\n    this.unmount = mountable.unmount;\n    this.stateSetters = key => {\n      const wrapped = wrapMountedEither(value => {\n        return this.setStateFp({ [key]: value } as unknown as Partial<S>);\n      });\n      return [throwifyWithChecksFp(wrapped), wrapped];\n    };\n    this.stateBoolSetters = <K extends keyof S>(key: K) => {\n      const [, setFp] = this.stateSetters(key);\n      const setFalse = wrapMountedEither(() => setFp(false as S[K]));\n      const setTrue = wrapMountedEither(() => setFp(true as S[K]));\n      return [\n        [throwifyWithChecksFp(setFalse), setFalse],\n        [throwifyWithChecksFp(setTrue), setTrue],\n      ];\n    };\n  }\n\n  /**\n   * Signal indicating if the component is currently mounted.\n   */\n  readonly isMounted: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is supported.\n   */\n  readonly isSupported: Computed<boolean>;\n\n  /**\n   * Complete button state.\n   */\n  readonly state: Computed<S>;\n\n  /**\n   * @returns A computed based on the specified state and its related key.\n   * @param key - a key to use.\n   */\n  stateGetter<K extends keyof S>(key: K): Computed<S[K]> {\n    return computed(() => this.state()[key]);\n  }\n\n  /**\n   * @returns A setter with checks for the specified key.\n   * @param key\n   */\n  readonly stateSetters: <K extends keyof S>(key: K) => [\n    throwing: WithChecks<(value: S[K]) => void, true>,\n    fp: WithChecksFp<(value: S[K]) => ButtonEither, true>,\n  ];\n\n  /**\n   * @returns Setters with checks to set a specified boolean key.\n   * @param key\n   */\n  readonly stateBoolSetters: <K extends BoolFields<S>>(key: K) => [\n    setFalse: [\n      throwing: WithChecks<() => void, true>,\n      fp: WithChecksFp<() => ButtonEither, true>,\n    ],\n    setTrue: [\n      throwing: WithChecks<() => void, true>,\n      fp: WithChecksFp<() => ButtonEither, true>,\n    ],\n  ];\n\n  /**\n   * Updates the button state.\n   */\n  readonly setStateFp: WithChecksFp<(state: Partial<S>) => ButtonEither, true>;\n\n  /**\n   * @see setStateFp\n   */\n  readonly setState: WithChecks<(state: Partial<S>) => void, true>;\n\n  /**\n   * Adds a new button listener.\n   * @param listener - event listener.\n   * @param once - should the listener be called only once.\n   * @returns A function to remove bound listener.\n   * @example\n   * const off = button.onClick(() => {\n   *   console.log('User clicked the button');\n   *   off();\n   * });\n   */\n  readonly onClickFp: WithChecksFp<(listener: VoidFunction, once?: boolean) => VoidFunction, true>;\n\n  /**\n   * @see onClickFp\n   */\n  readonly onClick: WithChecks<(listener: VoidFunction, once?: boolean) => VoidFunction, true>;\n\n  /**\n   * Removes the button click listener.\n   * @param listener - event listener.\n   * @param once - should the listener be called only once.\n   * @example\n   * function listener() {\n   *   console.log('User clicked the button');\n   *   button.offClick(listener);\n   * }\n   * button.onClick(listener);\n   */\n  readonly offClickFp: WithChecksFp<\n    (listener: VoidFunction, once?: boolean) => void,\n    true\n  >;\n\n  /**\n   * @see offClickFp\n   */\n  readonly offClick: WithChecks<(listener: VoidFunction, once?: boolean) => void, true>;\n\n  /**\n   * Mounts the component restoring its state.\n   * @since Mini Apps v6.1\n   */\n  readonly mountFp: WithChecksFp<() => void, true>;\n\n  /**\n   * @see mountFp\n   */\n  readonly mount: WithChecks<() => void, true>;\n\n  /**\n   * Unmounts the component.\n   *\n   * Note that this function does not remove listeners added via the `onClick`\n   * function, so you have to remove them on your own.\n   * @see onClick\n   */\n  readonly unmount: () => void;\n}\n","import type { PostEventError } from '@tma.js/bridge';\nimport type { Computed } from '@tma.js/signals';\nimport { either as E } from 'fp-ts';\n\nimport { Button, type ButtonOptions } from '@/composables/Button.js';\nimport type { WithChecksFp, WithChecks } from '@/with-checks/withChecksFp.js';\n\nexport interface BackButtonState {\n  isVisible: boolean;\n}\n\nexport type BackButtonOptions = Omit<\n  ButtonOptions<BackButtonState, 'web_app_setup_back_button'>,\n  'method' | 'payload' | 'initialState'\n>;\n\n/**\n * @since Mini Apps v6.1\n */\nexport class BackButton {\n  constructor(options: BackButtonOptions) {\n    const button = new Button({\n      ...options,\n      method: 'web_app_setup_back_button',\n      payload: state => ({ is_visible: state.isVisible }),\n      initialState: { isVisible: false },\n    });\n\n    this.isVisible = button.stateGetter('isVisible');\n    this.isMounted = button.isMounted;\n    this.isSupported = button.isSupported;\n    [[this.hide, this.hideFp], [this.show, this.showFp]] = button.stateBoolSetters('isVisible');\n    this.onClick = button.onClick;\n    this.onClickFp = button.onClickFp;\n    this.offClick = button.offClick;\n    this.offClickFp = button.offClickFp;\n    this.mount = button.mount;\n    this.mountFp = button.mountFp;\n    this.unmount = button.unmount;\n  }\n\n  /**\n   * Signal indicating if the component is currently visible.\n   */\n  readonly isVisible: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is currently mounted.\n   */\n  readonly isMounted: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is supported.\n   */\n  readonly isSupported: Computed<boolean>;\n\n  /**\n   * Hides the button.\n   * @since Mini Apps v6.1\n   */\n  readonly hideFp: WithChecksFp<() => E.Either<PostEventError, void>, true>;\n\n  /**\n   * @see hideFp\n   */\n  readonly hide: WithChecks<() => void, true>;\n\n  /**\n   * Shows the button.\n   * @since Mini Apps v6.1\n   */\n  readonly showFp: WithChecksFp<() => E.Either<PostEventError, void>, true>;\n\n  /**\n   * @see showFp\n   */\n  readonly show: WithChecks<() => void, true>;\n\n  /**\n   * Adds a new button listener.\n   * @param listener - event listener.\n   * @param once - should the listener be called only once.\n   * @returns A function to remove bound listener.\n   * @since Mini Apps v6.1\n   * @example\n   * const off = button.onClick(() => {\n   *   console.log('User clicked the button');\n   *   off();\n   * });\n   */\n  readonly onClickFp: WithChecksFp<\n    (listener: VoidFunction, once?: boolean) => VoidFunction,\n    true\n  >;\n\n  /**\n   * @see onClickFp\n   */\n  readonly onClick: WithChecks<(listener: VoidFunction, once?: boolean) => VoidFunction, true>;\n\n  /**\n   * Removes the button click listener.\n   * @param listener - event listener.\n   * @param once - should the listener be called only once.\n   * @since Mini Apps v6.1\n   * @example\n   * function listener() {\n   *   console.log('User clicked the button');\n   *   button.offClick(listener);\n   * }\n   * button.onClick(listener);\n   */\n  readonly offClickFp: WithChecksFp<\n    (listener: VoidFunction, once?: boolean) => void,\n    true\n  >;\n\n  /**\n   * @see offClickFp\n   */\n  readonly offClick: WithChecks<(listener: VoidFunction, once?: boolean) => void, true>;\n\n  /**\n   * Mounts the component restoring its state.\n   * @since Mini Apps v6.1\n   */\n  readonly mountFp: WithChecksFp<() => void, true>;\n\n  /**\n   * @see mountFp\n   */\n  readonly mount: WithChecks<() => void, true>;\n\n  /**\n   * Unmounts the component.\n   *\n   * Note that this function does not remove listeners added via the `onClick`\n   * function, so you have to remove them on your own.\n   * @see onClick\n   */\n  readonly unmount: () => void;\n}\n","import { isTMAFp } from '@tma.js/bridge';\nimport { computed } from '@tma.js/signals';\n\nimport type { MaybeAccessor } from '@/types.js';\n\nexport interface SharedFeatureOptions {\n  /**\n   * True if the current environment is Telegram Mini Apps.\n   */\n  isTma: MaybeAccessor<boolean>;\n}\n\nexport function sharedFeatureOptions(): SharedFeatureOptions {\n  return { isTma: computed(() => isTMAFp()) };\n}\n","import { access } from '@/helpers/access.js';\nimport type { MaybeAccessor } from '@/types.js';\n\nexport function createFnOption<T>(mix: MaybeAccessor<T>) {\n  return <O extends object>(obj: O) => {\n    return { ...obj, ...access(mix) };\n  };\n}\n","import {\n  computed,\n  type Computed,\n  type Signal,\n  signal,\n  type SignalOptions,\n} from '@tma.js/signals';\n\nexport type SignalsTuple<T> = [Signal<T>, Computed<T>];\n\nconst signals: (Signal<any> | Computed<any>)[] = [];\n\n/**\n * Creates a new signal with the initial value.\n * @param initialValue - the initial value.\n * @param options - additional options.\n */\nexport function createSignal<T>(\n  initialValue: T,\n  options?: SignalOptions<T>,\n): Signal<T>;\n\n/**\n * Creates a new signal without the initial value.\n * @param initialValue - the initial value.\n * @param options - additional options.\n */\nexport function createSignal<T>(\n  initialValue?: T,\n  options?: SignalOptions<T | undefined>,\n): Signal<T | undefined>;\n\n// #__NO_SIDE_EFFECTS__\nexport function createSignal<T>(\n  initialValue?: T,\n  options?: SignalOptions<T | undefined>,\n): Signal<T | undefined> {\n  const s = signal(initialValue, options);\n  signals.push(s);\n  return s;\n}\n\n/**\n * Creates a signal, which wil be automatically updated if some of its dependant signals were\n * modified.\n * @param fn - computation function.\n * @param options - additional functions.\n */\n// #__NO_SIDE_EFFECTS__\nexport function createComputed<T>(fn: (prev?: T) => T, options?: SignalOptions<T>): Computed<T> {\n  const s = computed(fn, options);\n  signals.push(s);\n  return s;\n}\n\n/**\n * Resets all signals states.\n */\nexport function resetSignals() {\n  signals.forEach(s => {\n    s.unsubAll();\n    'reset' in s && s.reset();\n  });\n}\n\n/**\n * @returns A tuple, containing a manual and computed signals. The computed signal is based on\n * the manual one.\n * @param initialValue - the initial value.\n * @param options - additional options.\n */\nexport function createSignalsTuple<T>(\n  initialValue: T,\n  options?: SignalOptions<T>,\n): SignalsTuple<T>;\n\n/**\n * @returns A tuple, containing a manual and computed signals. The computed signal is based on\n * the manual one.\n * @param initialValue - an initial value.\n * @param options - additional options.\n */\nexport function createSignalsTuple<T>(\n  initialValue?: T,\n  options?: SignalOptions<T | undefined>,\n): SignalsTuple<T | undefined>;\n\n// #__NO_SIDE_EFFECTS__\nexport function createSignalsTuple<T>(\n  initialValue?: T,\n  options?: SignalOptions<T | undefined>,\n): SignalsTuple<T | undefined> {\n  const s = createSignal(initialValue, options);\n  return [s, createComputed(s)];\n}\n","import { postEventFp as _postEventFp, type PostEventFpFn, type PostEventFn } from '@tma.js/bridge';\nimport { throwifyAnyEither } from '@tma.js/toolkit';\n\nimport { createSignal } from '@/globals/signals-registry.js';\n\nexport const postEventFpSignal = createSignal(_postEventFp);\n\nexport const postEventFp: PostEventFpFn = (...args: any[]) => {\n  return (postEventFpSignal as any)()(...args);\n};\n\nexport const postEvent: PostEventFn = (...args: any[]) => {\n  return throwifyAnyEither((postEventFp as any)(...args));\n};\n","import { type PostEventFpFn } from '@tma.js/bridge';\n\nimport { createFnOption } from '@/fn-options/createFnOption.js';\nimport { postEventFp } from '@/globals/postEvent.js';\n\nexport interface WithPostEvent {\n  /**\n   * A postEvent function to use to call Mini Apps methods.\n   */\n  postEvent: PostEventFpFn;\n}\n\nexport const withPostEvent = createFnOption<WithPostEvent>({\n  postEvent: postEventFp,\n});\n","import { getStorageValue, setStorageValue } from '@tma.js/toolkit';\n\nexport interface ComponentStorage<T> {\n  get: () => T | undefined;\n  set: (value: T) => void;\n}\n\n/**\n * Creates a new sessionStorage-based component storage.\n * @param key - session storage key to use.\n */\nexport function createComponentSessionStorage<T>(key: string): ComponentStorage<T> {\n  return {\n    get: () => getStorageValue<T>(key),\n    set(value) {\n      setStorageValue<T>(key, value);\n    },\n  };\n}\n","/**\n * Returns the first navigation entry from window.performance.\n * @returns First navigation entry or null, in case performance functionality is not supported\n * or navigation entry was not found.\n */\nfunction getFirstNavigationEntry(): PerformanceNavigationTiming | undefined {\n  return performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming | undefined;\n}\n\n/**\n * @returns True, if the current page was reloaded.\n * @see https://stackoverflow.com/a/36444134/11894710\n */\nexport function isPageReload(): boolean {\n  const entry = getFirstNavigationEntry();\n  return !!entry && entry.type === 'reload';\n}\n","import { createFnOption } from '@/fn-options/createFnOption.js';\nimport { type ComponentStorage, createComponentSessionStorage } from '@/helpers/component-storage.js';\nimport { isPageReload } from '@/helpers/navigation.js';\nimport type { MaybeAccessor } from '@/types.js';\n\nexport interface WithStateRestore<T> {\n  /**\n   * A storage the component could use to store its data.\n   */\n  storage: ComponentStorage<T>;\n  /**\n   * True if the current page is reloaded.\n   */\n  isPageReload: MaybeAccessor<boolean>;\n}\n\nexport function withStateRestore<S>(storageName: string) {\n  return createFnOption<WithStateRestore<S>>({\n    storage: createComponentSessionStorage<S>(storageName),\n    isPageReload,\n  });\n}\n","import type { Version } from '@tma.js/types';\n\nimport { createSignal } from '@/globals/signals-registry.js';\n\n/**\n * The current Mini Apps version.\n */\nexport const version = createSignal<Version>('0.0');\n","import type { Version } from '@tma.js/types';\n\nimport { createFnOption } from '@/fn-options/createFnOption.js';\nimport { version } from '@/globals/version.js';\nimport type { MaybeAccessor } from '@/types.js';\n\nexport interface WithVersion {\n  /**\n   * The currently supported Telegram Mini Apps version by the Telegram client.\n   */\n  version: MaybeAccessor<Version>;\n}\n\nexport const withVersion = createFnOption<WithVersion>({ version });\n","import { on, off, type EventName } from '@tma.js/bridge';\nimport { function as fn } from 'fp-ts';\n\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withStateRestore } from '@/fn-options/withStateRestore.js';\nimport { withVersion } from '@/fn-options/withVersion.js';\n\n// @__NO_SIDE_EFFECTS__\nexport function buttonOptions<S>(storageName: string, trackedClickEvent: EventName) {\n  return {\n    ...fn.pipe(\n      sharedFeatureOptions(),\n      withPostEvent,\n      withVersion,\n      withStateRestore<S>(storageName),\n    ),\n    onClick(listener: VoidFunction, once?: boolean): VoidFunction {\n      return on(trackedClickEvent, listener, once);\n    },\n    offClick(listener: VoidFunction, once?: boolean): void {\n      off(trackedClickEvent, listener, once);\n    },\n  };\n}\n","import { BackButton } from '@/features/BackButton/BackButton.js';\nimport { buttonOptions } from '@/fn-options/buttonOptions.js';\n\nexport const backButton = /* @__PURE__*/ new BackButton(\n  buttonOptions('backButton', 'back_button_pressed'),\n);\n","import { batch, computed, signal } from '@tma.js/signals';\nimport { taskEither as TE, function as fn } from 'fp-ts';\n\nimport { access } from '@/helpers/access.js';\nimport type { AsyncOptions, MaybeAccessor } from '@/types.js';\n\nexport interface AsyncMountableOptions<S, E> {\n  /**\n   * A function to retrieve the initial state.\n   * @param options - additional options.\n   */\n  initialState: (options?: AsyncOptions) => TE.TaskEither<E, S>;\n  /**\n   * @returns True if the current page was reloaded.\n   */\n  isPageReload: MaybeAccessor<boolean>;\n  /**\n   * A function to call whenever the component was mounted.\n   * @param state - restored state.\n   */\n  onMounted?: (state: S) => void;\n  /**\n   * A function to call whenever the component was unmounted.\n   */\n  onUnmounted?: VoidFunction;\n  /**\n   * Attempts to restore previously saved component state. This function\n   * will only be called if the current page was reloaded.\n   */\n  restoreState: () => (S | undefined);\n}\n\nexport class AsyncMountable<S extends object, E> {\n  constructor({\n    initialState,\n    onMounted,\n    restoreState,\n    onUnmounted,\n    isPageReload,\n  }: AsyncMountableOptions<S, E>) {\n    this.mount = options => {\n      if (this._isMounted()) {\n        return TE.right(undefined);\n      }\n      const restored = access(isPageReload) ? restoreState() : undefined;\n      return fn.pipe(\n        restored ? TE.right(restored) : initialState(options),\n        TE.map(state => {\n          // The user could call mount several times in a row while the\n          // component was still mounting. We should prevent calling the\n          // same hooks several times in this case.\n          if (!this._isMounted()) {\n            batch(() => {\n              this._isMounted.set(true);\n              onMounted?.(state);\n            });\n          }\n        }),\n      );\n    };\n\n    this.unmount = () => {\n      if (this._isMounted()) {\n        batch(() => {\n          this._isMounted.set(false);\n          onUnmounted?.();\n        });\n      }\n    };\n  }\n\n  private readonly _isMounted = signal(false);\n\n  /**\n   * Signal indicating if the component is mounted.\n   */\n  readonly isMounted = computed(this._isMounted);\n\n  /**\n   * Mounts the component restoring its state and calling required side effects.\n   * @param options - additional execution options.\n   */\n  readonly mount: (options?: AsyncOptions) => TE.TaskEither<E, void>;\n\n  /**\n   * Unmounts the component.\n   */\n  readonly unmount: () => void;\n}\n","import type {\n  RequestError,\n  PostEventError,\n  EventPayload,\n  BiometryAuthRequestStatus,\n  EventListener,\n  BiometryTokenUpdateStatus,\n} from '@tma.js/bridge';\nimport type { Computed } from '@tma.js/signals';\nimport { BetterPromise } from 'better-promises';\nimport { either as E, taskEither as TE, function as fn } from 'fp-ts';\n\nimport { AsyncMountable } from '@/composables/AsyncMountable.js';\nimport { Stateful } from '@/composables/Stateful.js';\nimport { NotAvailableError } from '@/errors.js';\nimport type {\n  BiometryAuthenticateOptions, BiometryOptions,\n  BiometryRequestAccessOptions,\n  BiometryState,\n  BiometryUpdateTokenOptions,\n} from '@/features/Biometry/types.js';\nimport { createIsSupportedSignal } from '@/helpers/createIsSupportedSignal.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { createWithChecksFp, WithChecks, WithChecksFp } from '@/with-checks/withChecksFp.js';\n\ntype BiometryTask<T> = TE.TaskEither<RequestError, T>;\n\ninterface AuthenticateResult {\n  /**\n   * Authentication status.\n   */\n  status: BiometryAuthRequestStatus;\n  /**\n   * Token from the local secure storage saved previously.\n   */\n  token?: string;\n}\n\nfunction createNotAvailableError() {\n  return new NotAvailableError('Biometry is not available');\n}\n\nfunction eventToState(event: EventPayload<'biometry_info_received'>): BiometryState {\n  let available = false;\n  let tokenSaved = false;\n  let deviceId = '';\n  let accessRequested = false;\n  let type = '';\n  let accessGranted = false;\n  if (event.available) {\n    available = true;\n    tokenSaved = event.token_saved;\n    deviceId = event.device_id;\n    accessRequested = event.access_requested;\n    type = event.type;\n    accessGranted = event.access_granted;\n  }\n  return { available, tokenSaved, deviceId, type, accessGranted, accessRequested };\n}\n\n/**\n * @since Mini Apps v7.2\n */\nexport class Biometry {\n  constructor({\n    version,\n    request,\n    postEvent,\n    storage,\n    onInfoReceived,\n    offInfoReceived,\n    isTma,\n    isPageReload,\n  }: BiometryOptions) {\n    const listener: EventListener<'biometry_info_received'> = event => {\n      stateful.setState(eventToState(event));\n    };\n\n    const stateful = new Stateful<BiometryState>({\n      initialState: {\n        available: false,\n        type: 'unknown',\n        accessGranted: false,\n        accessRequested: false,\n        deviceId: '',\n        tokenSaved: false,\n      },\n      onChange: storage.set,\n    });\n    const mountable = new AsyncMountable({\n      initialState(options) {\n        return fn.pipe(\n          request('web_app_biometry_get_info', 'biometry_info_received', options),\n          TE.map(eventToState),\n        );\n      },\n      isPageReload,\n      onMounted(state) {\n        stateful.setState(state);\n        onInfoReceived(listener);\n      },\n      onUnmounted() {\n        offInfoReceived(listener);\n      },\n      restoreState: storage.get,\n    });\n\n    const wrapOptions = { version, requires: 'web_app_biometry_request_auth', isTma } as const;\n    const wrapSupportedEither = createWithChecksFp({\n      ...wrapOptions,\n      returns: 'either',\n    });\n    const wrapSupportedTask = createWithChecksFp({\n      ...wrapOptions,\n      returns: 'task',\n    });\n    const wrapMountedTask = createWithChecksFp({\n      ...wrapOptions,\n      isMounted: mountable.isMounted,\n      returns: 'task',\n    });\n\n    this.isAvailable = stateful.getter('available');\n    this.isMounted = mountable.isMounted;\n    this.isSupported = createIsSupportedSignal('web_app_biometry_request_auth', version);\n    this.state = stateful.state;\n    this.unmount = mountable.unmount;\n    this.mountFp = wrapSupportedTask(mountable.mount);\n\n    this.authenticateFp = wrapMountedTask(options => {\n      return !this.isAvailable()\n        ? TE.left(createNotAvailableError())\n        : fn.pipe(\n          request('web_app_biometry_request_auth', 'biometry_auth_requested', {\n            ...options,\n            params: { reason: ((options || {}).reason || '').trim() },\n          }),\n          TE.map(response => {\n            stateful.setState({ token: response.token });\n            return response;\n          }),\n        );\n    });\n\n    this.openSettingsFp = wrapSupportedEither(() => postEvent('web_app_biometry_open_settings'));\n\n    this.requestAccessFp = wrapMountedTask(options => {\n      return fn.pipe(\n        request('web_app_biometry_request_access', 'biometry_info_received', {\n          ...options,\n          params: { reason: ((options || {}).reason || '').trim() },\n        }),\n        TE.chain(response => {\n          const state = eventToState(response);\n          if (!state.available) {\n            return TE.left(createNotAvailableError());\n          }\n          stateful.setState(state);\n          return TE.right(state.accessRequested);\n        }),\n      );\n    });\n\n    this.updateTokenFp = wrapMountedTask((options = {}) => {\n      return fn.pipe(\n        request('web_app_biometry_update_token', 'biometry_token_updated', {\n          ...options,\n          params: { token: options.token || '', reason: options.reason?.trim() },\n        }),\n        TE.map(response => response.status),\n      );\n    });\n\n    this.authenticate = throwifyWithChecksFp(this.authenticateFp);\n    this.openSettings = throwifyWithChecksFp(this.openSettingsFp);\n    this.requestAccess = throwifyWithChecksFp(this.requestAccessFp);\n    this.updateToken = throwifyWithChecksFp(this.updateTokenFp);\n    this.mount = throwifyWithChecksFp(this.mountFp);\n  }\n\n  /**\n   * Signal indicating if biometry is available.\n   */\n  readonly isAvailable: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is supported.\n   */\n  readonly isSupported: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is mounted.\n   */\n  readonly isMounted: Computed<boolean>;\n\n  /**\n   * Complete component state.\n   */\n  readonly state: Computed<BiometryState>;\n\n  /**\n   * Attempts to authenticate a user using biometrics and fetch a previously stored secure token.\n   * @param options - method options.\n   * @since Mini Apps v7.2\n   * @returns Token from the local secure storage saved previously or undefined.\n   * @example\n   * const { status, token } = await biometry.authenticate({\n   *   reason: 'Authenticate to open wallet',\n   * });\n   */\n  readonly authenticateFp: WithChecksFp<(options?: BiometryAuthenticateOptions) => BiometryTask<{\n    /**\n     * Authentication status.\n     */\n    status: BiometryAuthRequestStatus;\n    /**\n     * Token from the local secure storage saved previously.\n     */\n    token?: string;\n  }>, true>;\n\n  /**\n   * @see authenticateFp\n   */\n  readonly authenticate: WithChecks<\n    (options?: BiometryAuthenticateOptions) => BetterPromise<AuthenticateResult>,\n    true\n  >;\n\n  /**\n   * Opens the biometric access settings for bots. Useful when you need to request biometrics\n   * access to users who haven't granted it yet.\n   *\n   * _Note that this method can be called only in response to user interaction with the Mini App\n   * interface (e.g. a click inside the Mini App or on the main button)_.\n   * @since Mini Apps v7.2\n   */\n  readonly openSettingsFp: WithChecksFp<() => E.Either<PostEventError, void>, true>;\n\n  /**\n   * @see openSettingsFp\n   */\n  readonly openSettings: WithChecks<() => void, true>;\n\n  /**\n   * Requests permission to use biometrics.\n   * @since Mini Apps v7.2\n   * @returns Promise with true, if access was granted.\n   * @example\n   * const accessGranted = await biometry.requestAccess({\n   *   reason: 'Authenticate to open wallet',\n   * });\n   */\n  readonly requestAccessFp: WithChecksFp<\n    (options?: BiometryRequestAccessOptions) => BiometryTask<boolean>,\n    true\n  >;\n\n  /**\n   * @see requestAccessFp\n   */\n  readonly requestAccess: WithChecks<\n    (options?: BiometryRequestAccessOptions) => BetterPromise<boolean>,\n    true\n  >;\n\n  /**\n   * Updates the biometric token in a secure storage on the device.\n   * @since Mini Apps v7.2\n   * @returns Promise with `true`, if token was updated.\n   * @example Setting a new token\n   * biometry.updateToken({\n   *   token: 'abcdef',\n   * })\n   * @example Deleting the token\n   * biometry.updateToken();\n   */\n  readonly updateTokenFp: WithChecksFp<\n    (options?: BiometryUpdateTokenOptions) => BiometryTask<BiometryTokenUpdateStatus>,\n    true\n  >;\n\n  /**\n   * @see updateTokenFp\n   */\n  readonly updateToken: WithChecks<\n    (options?: BiometryUpdateTokenOptions) => BetterPromise<BiometryTokenUpdateStatus>,\n    true\n  >;\n\n  /**\n   * Mounts the component restoring its state.\n   * @since Mini Apps v7.2\n   */\n  readonly mountFp: WithChecksFp<(options?: AsyncOptions) => BiometryTask<void>, true>;\n\n  /**\n   * @see mountFp\n   */\n  readonly mount: WithChecks<(options?: AsyncOptions) => BetterPromise<void>, true>;\n\n  /**\n   * Unmounts the component.\n   */\n  readonly unmount: () => void;\n}\n","import {\n  requestFp as _requestFp,\n  request2Fp as _request2Fp,\n  type RequestFpFn,\n  type RequestFn,\n  type Request2FpFn,\n  type Request2Fn,\n} from '@tma.js/bridge';\nimport { BetterPromise } from 'better-promises';\n\nimport { postEventFp } from '@/globals/postEvent.js';\n\n/**\n * @deprecated To be removed in the next major update. Use `request2fp` instead, it provides\n * a proper way of handling multiple events.\n */\nexport const requestFp: RequestFpFn = (method: any, events: any, options: any) => {\n  return _requestFp(method, events, {\n    postEvent: postEventFp,\n    ...options,\n  });\n};\n\nexport const request2Fp: Request2FpFn = (method: any, events: any, options: any) => {\n  return _request2Fp(method, events, {\n    postEvent: postEventFp,\n    ...options,\n  });\n};\n\n/**\n * @deprecated To be removed in the next major update. Use `request` instead, it provides\n * a proper way of handling multiple events.\n */\nexport const request: RequestFn = (...args: any[]) => {\n  return BetterPromise.fn(() => (requestFp as any)(...args)());\n};\n\nexport const request2: Request2Fn = (...args: any[]) => {\n  return BetterPromise.fn(() => (request2Fp as any)(...args)());\n};\n","import type { Request2FpFn } from '@tma.js/bridge';\n\nimport { createFnOption } from '@/fn-options/createFnOption.js';\nimport { request2Fp } from '@/globals/request.js';\n\nexport interface WithRequest {\n  /**\n   * A request function to use to call Mini Apps methods.\n   */\n  request: Request2FpFn;\n}\n\nexport const withRequest = createFnOption<WithRequest>({ request: request2Fp });\n","import { on, off } from '@tma.js/bridge';\nimport { function as fn } from 'fp-ts';\n\nimport { Biometry } from '@/features/Biometry/Biometry.js';\nimport type { BiometryState } from '@/features/Biometry/types.js';\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withRequest } from '@/fn-options/withRequest.js';\nimport { withStateRestore } from '@/fn-options/withStateRestore.js';\nimport { withVersion } from '@/fn-options/withVersion.js';\n\nfunction instantiate() {\n  return new Biometry({\n    ...fn.pipe(\n      sharedFeatureOptions(),\n      withPostEvent,\n      withVersion,\n      withRequest,\n      withStateRestore<BiometryState>('biometry'),\n    ),\n    offInfoReceived(listener) {\n      off('biometry_info_received', listener);\n    },\n    onInfoReceived(listener) {\n      return on('biometry_info_received', listener);\n    },\n  });\n}\n\nexport const biometry = /* @__PURE__*/ instantiate();\n","import type { PostEventError } from '@tma.js/bridge';\nimport type { Computed } from '@tma.js/signals';\nimport { either as E, function as fn } from 'fp-ts';\n\nimport { Mountable } from '@/composables/Mountable.js';\nimport { Stateful } from '@/composables/Stateful.js';\nimport type { SharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport type { WithPostEvent } from '@/fn-options/withPostEvent.js';\nimport type { WithStateRestore } from '@/fn-options/withStateRestore.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport {\n  createWithChecksFp,\n  type WithChecks,\n  type WithChecksFp,\n} from '@/with-checks/withChecksFp.js';\n\nexport interface ClosingBehaviorState {\n  isConfirmationEnabled: boolean;\n}\n\nexport interface ClosingBehaviorOptions\n  extends WithStateRestore<ClosingBehaviorState>,\n  WithPostEvent,\n  SharedFeatureOptions {\n}\n\nexport class ClosingBehavior {\n  constructor({ postEvent, storage, isTma, isPageReload }: ClosingBehaviorOptions) {\n    const stateful = new Stateful({\n      initialState: { isConfirmationEnabled: false },\n      onChange(state) {\n        storage.set(state);\n      },\n    });\n    const mountable = new Mountable({\n      onMounted: stateful.setState,\n      restoreState: storage.get,\n      initialState: { isConfirmationEnabled: false },\n      isPageReload,\n    });\n\n    const wrapOptions = { requires: 'web_app_setup_closing_behavior', isTma } as const;\n    const wrapSupportedPlain = createWithChecksFp({\n      ...wrapOptions,\n      returns: 'plain',\n    });\n    const wrapMountedEither = createWithChecksFp({\n      ...wrapOptions,\n      returns: 'either',\n      isMounted: mountable.isMounted,\n    });\n\n    const setClosingConfirmation = (isConfirmationEnabled: boolean) => {\n      if (isConfirmationEnabled === this.isConfirmationEnabled()) {\n        return E.right(undefined);\n      }\n      stateful.setState({ isConfirmationEnabled });\n      return postEvent('web_app_setup_closing_behavior', {\n        need_confirmation: isConfirmationEnabled,\n      });\n    };\n\n    this.isConfirmationEnabled = stateful.getter('isConfirmationEnabled');\n    this.isMounted = mountable.isMounted;\n\n    this.disableConfirmationFp = wrapMountedEither(() => {\n      return setClosingConfirmation(false);\n    });\n    this.enableConfirmationFp = wrapMountedEither(() => {\n      return setClosingConfirmation(true);\n    });\n    this.mountFp = wrapSupportedPlain(() => {\n      const nothing = () => undefined;\n      return fn.pipe(mountable.mount(), E.match(nothing, nothing));\n    });\n    this.unmount = mountable.unmount;\n\n    this.disableConfirmation = throwifyWithChecksFp(this.disableConfirmationFp);\n    this.enableConfirmation = throwifyWithChecksFp(this.enableConfirmationFp);\n    this.mount = throwifyWithChecksFp(this.mountFp);\n  }\n\n  /**\n   * Signal indicating if closing confirmation dialog is currently enabled.\n   */\n  readonly isConfirmationEnabled: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is currently mounted.\n   */\n  readonly isMounted: Computed<boolean>;\n\n  /**\n   * Mounts the component restoring its state.\n   */\n  readonly mountFp: WithChecksFp<() => void, false>;\n\n  /**\n   * @see mountFp\n   */\n  readonly mount: WithChecks<() => void, false>;\n\n  /**\n   * Unmounts the component.\n   */\n  readonly unmount: () => void;\n\n  /**\n   * Disables the closing confirmation dialog.\n   */\n  readonly disableConfirmationFp: WithChecksFp<() => E.Either<PostEventError, void>, false>;\n\n  /**\n   * @see disableConfirmationFp\n   */\n  readonly disableConfirmation: WithChecks<() => void, false>;\n\n  /**\n   * Enables the closing confirmation dialog.\n   */\n  readonly enableConfirmationFp: WithChecksFp<() => E.Either<PostEventError, void>, false>;\n\n  /**\n   * @see enableConfirmationFp\n   */\n  readonly enableConfirmation: WithChecks<() => void, false>;\n}\n","import { function as fn } from 'fp-ts';\n\nimport {\n  ClosingBehavior,\n  type ClosingBehaviorState,\n} from '@/features/ClosingBehavior/ClosingBehavior.js';\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withStateRestore } from '@/fn-options/withStateRestore.js';\n\nfunction instantiate() {\n  return new ClosingBehavior(fn.pipe(\n    sharedFeatureOptions(),\n    withStateRestore<ClosingBehaviorState>('closingBehavior'),\n    withPostEvent,\n  ));\n}\n\nexport const closingBehavior = /* @__PURE__*/ instantiate();\n","import type { InvokeCustomMethodFpOptions, RequestError } from '@tma.js/bridge';\nimport type { Computed } from '@tma.js/signals';\nimport { BetterPromise } from 'better-promises';\nimport { taskEither as TE, function as fn } from 'fp-ts';\nimport { array, parse, record, string } from 'valibot';\n\nimport type { SharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport type { WithInvokeCustomMethod } from '@/fn-options/withInvokeCustomMethod.js';\nimport type { WithVersion } from '@/fn-options/withVersion.js';\nimport { createIsSupportedSignal } from '@/helpers/createIsSupportedSignal.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { createWithChecksFp, type WithChecks, type WithChecksFp } from '@/with-checks/withChecksFp.js';\n\ntype CloudStorageTask<T> = TE.TaskEither<RequestError, T>;\n\nexport interface CloudStorageOptions extends WithVersion,\n  WithInvokeCustomMethod,\n  SharedFeatureOptions {\n}\n\n/**\n * @since Mini Apps v6.9\n */\nexport class CloudStorage {\n  constructor({ version, isTma, invokeCustomMethod }: CloudStorageOptions) {\n    const wrapSupportedTask = createWithChecksFp({\n      version,\n      requires: 'web_app_invoke_custom_method',\n      isTma,\n      returns: 'task',\n    });\n\n    this.isSupported = createIsSupportedSignal('web_app_invoke_custom_method', version);\n    this.deleteItemFp = wrapSupportedTask((keyOrKeys, options) => {\n      const keys = Array.isArray(keyOrKeys) ? keyOrKeys : [keyOrKeys];\n      return fn.pipe(\n        keys.length\n          ? invokeCustomMethod('deleteStorageValues', { keys }, options)\n          : TE.right(undefined),\n        TE.map(() => undefined),\n      );\n    });\n    this.getItemFp = wrapSupportedTask((key, options) => {\n      return fn.pipe(\n        this.getItemsFp([key], options),\n        TE.map(values => values[key] || ''),\n      );\n    });\n    this.getItemsFp = wrapSupportedTask((keys, options) => {\n      return fn.pipe(\n        keys.length ? invokeCustomMethod('getStorageValues', { keys }, options) : TE.right({}),\n        TE.map(data => {\n          return {\n            // Fulfill the response with probably missing keys.\n            ...keys.reduce<Record<string, string>>((acc, key) => {\n              acc[key] = '';\n              return acc;\n            }, {}),\n            ...parse(record(string(), string()), data),\n          };\n        }),\n      );\n    });\n    this.getKeysFp = wrapSupportedTask(options => {\n      return fn.pipe(\n        invokeCustomMethod('getStorageKeys', {}, options),\n        TE.map(data => parse(array(string()), data)),\n      );\n    });\n    this.setItemFp = wrapSupportedTask((key, value, options) => {\n      return fn.pipe(\n        invokeCustomMethod('saveStorageValue', { key, value }, options),\n        TE.map(() => undefined),\n      );\n    });\n    this.clearFp = wrapSupportedTask(options => {\n      return fn.pipe(this.getKeysFp(options), TE.chain(this.deleteItemFp));\n    });\n\n    this.deleteItem = throwifyWithChecksFp(this.deleteItemFp);\n    this.getItem = throwifyWithChecksFp(this.getItemFp);\n    this.getItems = throwifyWithChecksFp(this.getItemsFp);\n    this.getKeys = throwifyWithChecksFp(this.getKeysFp);\n    this.setItem = throwifyWithChecksFp(this.setItemFp);\n    this.clear = throwifyWithChecksFp(this.clearFp);\n  }\n\n  /**\n   * Signal indicating if the component is supported.\n   */\n  readonly isSupported: Computed<boolean>;\n\n  /**\n   * Deletes specified key or keys from the cloud storage.\n   * @param keyOrKeys - key or keys to delete.\n   * @param options - request execution options.\n   * @since Mini Apps v6.9\n   */\n  readonly deleteItemFp: WithChecksFp<\n    (keyOrKeys: string | string[], options?: InvokeCustomMethodFpOptions) => CloudStorageTask<void>,\n    true\n  >;\n\n  readonly deleteItem: WithChecks<\n    (keyOrKeys: string | string[], options?: InvokeCustomMethodFpOptions) => BetterPromise<void>,\n    true\n  >;\n\n  /**\n   * Gets a single key value from the cloud storage.\n   * @param key - a key to get.\n   * @param options - request execution options.\n   * @returns A key value as a string.\n   * @since Mini Apps v6.9\n   */\n  readonly getItemFp: WithChecksFp<\n    (key: string, options?: InvokeCustomMethodFpOptions) => CloudStorageTask<string>,\n    true\n  >;\n\n  /**\n   * @see getItemFp\n   */\n  readonly getItem: WithChecks<{\n    <K extends string>(\n      keys: K[],\n      options?: InvokeCustomMethodFpOptions,\n    ): BetterPromise<Record<K, string>>;\n    (key: string, options?: InvokeCustomMethodFpOptions): BetterPromise<string>;\n  }, true>;\n\n  /**\n   * Gets multiple keys' values from the cloud storage.\n   * @param keys - keys list.\n   * @param options - request execution options.\n   * @returns A map, where a key is one of the specified in the `keys` argument,\n   * and a value is a corresponding storage value if an array of keys was passed.\n   * @since Mini Apps v6.9\n   */\n  readonly getItemsFp: WithChecksFp<\n    <K extends string>(\n      keys: K[],\n      options?: InvokeCustomMethodFpOptions,\n    ) => CloudStorageTask<Record<K, string>>,\n    true\n  >;\n\n  /**\n   * @see getItemsFp\n   */\n  readonly getItems: WithChecks<\n    <K extends string>(\n      keys: K[],\n      options?: InvokeCustomMethodFpOptions,\n    ) => BetterPromise<Record<K, string>>,\n    true\n  >;\n\n  /**\n   * Returns a list of all keys presented in the cloud storage.\n   * @param options - request execution options.\n   * @since Mini Apps v6.9\n   */\n  readonly getKeysFp: WithChecksFp<\n    (options?: InvokeCustomMethodFpOptions) => CloudStorageTask<string[]>,\n    true\n  >;\n\n  /**\n   * @see getKeysFp\n   */\n  readonly getKeys: WithChecks<\n    (options?: InvokeCustomMethodFpOptions) => BetterPromise<string[]>,\n    true\n  >;\n\n  /**\n   * Saves the specified value by a key.\n   * @param key - storage key.\n   * @param value - storage value.\n   * @param options - request execution options.\n   * @since Mini Apps v6.9\n   */\n  readonly setItemFp: WithChecksFp<\n    (key: string, value: string, options?: InvokeCustomMethodFpOptions) => CloudStorageTask<void>,\n    true\n  >;\n\n  /**\n   * @see setItemFp\n   */\n  readonly setItem: WithChecks<\n    (key: string, value: string, options?: InvokeCustomMethodFpOptions) => BetterPromise<void>,\n    true\n  >;\n\n  /**\n   * Clears the cloud storage.\n   * @param options - additional options.\n   * @since Mini Apps v6.9\n   */\n  readonly clearFp: WithChecksFp<\n    (options?: InvokeCustomMethodFpOptions) => CloudStorageTask<void>,\n    true\n  >;\n\n  /**\n   * @see clearFp\n   */\n  readonly clear: WithChecks<(options?: InvokeCustomMethodFpOptions) => BetterPromise<void>, true>;\n}\n","import { createSignal } from '@/globals/signals-registry.js';\n\nconst lastRequestId = createSignal(0);\n\n/**\n * @returns A new request identifier.\n */\nexport function createRequestId(): string {\n  lastRequestId.set(lastRequestId() + 1);\n  return lastRequestId().toString();\n}\n","import {\n  type RequestError,\n  type CustomMethodName,\n  type CustomMethodParams,\n  type InvokeCustomMethodOptions,\n  invokeCustomMethodFp,\n} from '@tma.js/bridge';\nimport { taskEither as TE } from 'fp-ts';\n\nimport { createRequestId } from '@/globals/createRequestId.js';\nimport { postEventFp } from '@/globals/postEvent.js';\n\n/**\n * Invokes known custom method. Returns method execution result.\n * @param method - method name.\n * @param params - method parameters.\n * @param options - additional options.\n */\nexport function invokeCustomMethod<M extends CustomMethodName>(\n  method: M,\n  params: CustomMethodParams<M>,\n  options?: InvokeCustomMethodOptions,\n): TE.TaskEither<RequestError, unknown>;\n\n/**\n * Invokes unknown custom method. Returns method execution result.\n * @param method - method name.\n * @param params - method parameters.\n * @param options - additional options.\n */\nexport function invokeCustomMethod(\n  method: string,\n  params: object,\n  options?: InvokeCustomMethodOptions,\n): TE.TaskEither<RequestError, unknown>;\n\nexport function invokeCustomMethod(\n  method: string,\n  params: object,\n  options?: InvokeCustomMethodOptions,\n): TE.TaskEither<RequestError, unknown> {\n  return invokeCustomMethodFp(method, params, createRequestId(), {\n    ...options || {},\n    postEvent: postEventFp,\n  });\n}\n","import type {\n  CustomMethodParams,\n  CustomMethodName,\n  InvokeCustomMethodError,\n  InvokeCustomMethodFpOptions,\n  RequestError,\n} from '@tma.js/bridge';\nimport type * as TE from 'fp-ts/TaskEither';\n\nimport { createFnOption } from '@/fn-options/createFnOption.js';\nimport { invokeCustomMethod } from '@/globals/invokeCustomMethod.js';\n\nexport type { InvokeCustomMethodError };\n\nexport interface InvokeCustomMethodNoRequestIdFn {\n  <M extends CustomMethodName>(\n    this: void,\n    method: M,\n    params: CustomMethodParams<M>,\n    options?: InvokeCustomMethodFpOptions,\n  ): TE.TaskEither<InvokeCustomMethodError, unknown>;\n\n  (\n    this: void,\n    method: string,\n    params: object,\n    options?: InvokeCustomMethodFpOptions,\n  ): TE.TaskEither<RequestError, unknown>;\n}\n\nexport interface WithInvokeCustomMethod {\n  invokeCustomMethod: InvokeCustomMethodNoRequestIdFn;\n}\n\nexport const withInvokeCustomMethod = createFnOption<WithInvokeCustomMethod>({\n  invokeCustomMethod,\n});\n","import { function as fn } from 'fp-ts';\n\nimport { CloudStorage } from '@/features/CloudStorage/CloudStorage.js';\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withInvokeCustomMethod } from '@/fn-options/withInvokeCustomMethod.js';\nimport { withVersion } from '@/fn-options/withVersion.js';\n\nfunction instantiate() {\n  return new CloudStorage(fn.pipe(\n    sharedFeatureOptions(),\n    withVersion,\n    withInvokeCustomMethod,\n  ));\n}\n\nexport const cloudStorage = /* @__PURE__*/ instantiate();\n","import { EventPayload, type MethodParams, type Request2CaptureFn, RequestError } from '@tma.js/bridge';\nimport { taskEither as TE, function as fn } from 'fp-ts';\n\nimport { DeviceStorageMethodError } from '@/errors.js';\nimport type { SharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport type { WithCreateRequestId } from '@/fn-options/withCreateRequestId.js';\nimport type { WithRequest } from '@/fn-options/withRequest.js';\nimport type { WithVersion } from '@/fn-options/withVersion.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport {\n  createWithChecksFp,\n  type WithChecks,\n  type WithChecksFp,\n} from '@/with-checks/withChecksFp.js';\n\nexport type DeviceStorageError = RequestError | DeviceStorageMethodError;\n\nexport interface DeviceStorageOptions extends SharedFeatureOptions,\n  WithVersion,\n  WithRequest,\n  WithCreateRequestId {\n}\n\n/**\n * @since Mini Apps v9.0\n */\nexport class DeviceStorage {\n  constructor({ isTma, request, version, createRequestId }: DeviceStorageOptions) {\n    const wrapSupportedTask = createWithChecksFp({\n      version,\n      requires: 'web_app_device_storage_get_key',\n      isTma,\n      returns: 'task',\n    });\n\n    const invokeMethod = <\n      M extends (\n        | 'web_app_device_storage_save_key'\n        | 'web_app_device_storage_get_key'\n        | 'web_app_device_storage_save_key'\n        | 'web_app_device_storage_clear'\n      ),\n      E extends (\n        | 'device_storage_key_saved'\n        | 'device_storage_key_received'\n        | 'device_storage_cleared'\n      ),\n    >(\n      method: M,\n      event: E,\n      params: Omit<MethodParams<M>, 'req_id'>,\n    ): TE.TaskEither<DeviceStorageError, EventPayload<E>> => {\n      const requestId = createRequestId();\n      return fn.pipe(\n        request<M, ('device_storage_failed' | E)[]>(method, ['device_storage_failed', event], {\n          params: { ...params, req_id: requestId },\n          capture: (event => {\n            return 'payload' in event ? event.payload.req_id === requestId : true;\n          }) as Request2CaptureFn<('device_storage_failed' | E)[]>,\n        }),\n        TE.chain(response => (\n          response.event === 'device_storage_failed'\n            ? TE.left(new DeviceStorageMethodError(response.payload.error || 'UNKNOWN_ERROR'))\n            : TE.right(response.payload as EventPayload<E>)\n        )),\n      );\n    };\n\n    this.getItemFp = wrapSupportedTask(key => {\n      return fn.pipe(\n        invokeMethod('web_app_device_storage_get_key', 'device_storage_key_received', { key }),\n        TE.map(payload => payload.value),\n      );\n    });\n    this.setItemFp = wrapSupportedTask((key, value) => {\n      return fn.pipe(\n        invokeMethod('web_app_device_storage_save_key', 'device_storage_key_saved', { key, value }),\n        TE.map(() => undefined),\n      );\n    });\n    this.deleteItemFp = wrapSupportedTask(key => {\n      return this.setItemFp(key, null);\n    });\n    this.clearFp = wrapSupportedTask(() => {\n      return fn.pipe(\n        invokeMethod('web_app_device_storage_clear', 'device_storage_cleared', {}),\n        TE.map(() => undefined),\n      );\n    });\n\n    this.getItem = throwifyWithChecksFp(this.getItemFp);\n    this.setItem = throwifyWithChecksFp(this.setItemFp);\n    this.deleteItem = throwifyWithChecksFp(this.deleteItemFp);\n    this.clear = throwifyWithChecksFp(this.clearFp);\n  }\n\n  /**\n    * Retrieves an item using its key.\n    * @since Mini Apps v9.0\n    */\n  readonly getItemFp: WithChecksFp<\n    (key: string) => TE.TaskEither<DeviceStorageError, string | null>,\n    true\n  >;\n\n  /**\n   * @see getItemFp\n   */\n  readonly getItem: WithChecks<(key: string) => Promise<string | null>, true>;\n\n  /**\n    * Sets a new item in the storage.\n    * @since Mini Apps v9.0\n    */\n  readonly setItemFp: WithChecksFp<\n    (key: string, value: string | null) => TE.TaskEither<DeviceStorageError, void>,\n    true\n  >;\n\n  /**\n   * @see setItemFp\n   */\n  readonly setItem: WithChecks<(key: string, value: string | null) => Promise<void>, true>;\n\n  /**\n    * Removes a key from the storage.\n    * @since Mini Apps v9.0\n    */\n  readonly deleteItemFp: WithChecksFp<\n    (key: string) => TE.TaskEither<DeviceStorageError, void>,\n    true\n  >;\n\n  /**\n   * @see deleteItemFp\n   */\n  readonly deleteItem: WithChecks<(key: string) => Promise<void>, true>;\n\n  /**\n    * Removes all keys from the storage.\n    * @since Mini Apps v9.0\n    */\n  readonly clearFp: WithChecksFp<() => TE.TaskEither<DeviceStorageError, void>, true>;\n\n  /**\n   * @see clearFp\n   */\n  readonly clear: WithChecks<() => Promise<void>, true>;\n}\n","import { createFnOption } from '@/fn-options/createFnOption.js';\nimport { createRequestId } from '@/globals/createRequestId.js';\n\nexport interface WithCreateRequestId {\n  /**\n   * A function generating a request identifier.\n   */\n  createRequestId: () => string;\n}\n\nexport const withCreateRequestId = createFnOption<WithCreateRequestId>({ createRequestId });\n","import { function as fn } from 'fp-ts';\n\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withCreateRequestId } from '@/fn-options/withCreateRequestId.js';\nimport { withRequest } from '@/fn-options/withRequest.js';\nimport { withVersion } from '@/fn-options/withVersion.js';\n\nimport { DeviceStorage } from './DeviceStorage.js';\n\nfunction instantiate() {\n  return new DeviceStorage(fn.pipe(\n    sharedFeatureOptions(),\n    withVersion,\n    withRequest,\n    withCreateRequestId,\n  ));\n}\n\nexport const deviceStorage = /* @__PURE__*/ instantiate();\n","import type { EmojiStatusAccessRequestedStatus, RequestError } from '@tma.js/bridge';\nimport { taskEither as TE, function as fn } from 'fp-ts';\n\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withRequest, type WithRequest } from '@/fn-options/withRequest.js';\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithVersion, WithRequest {\n}\n\nfunction create({ request, ...rest }: CreateOptions) {\n  return withChecksFp((\n    options: AsyncOptions,\n  ): TE.TaskEither<RequestError, EmojiStatusAccessRequestedStatus> => {\n    return fn.pipe(\n      request('web_app_request_emoji_status_access', 'emoji_status_access_requested', options),\n      TE.map(response => response.status),\n    );\n  }, { ...rest, requires: 'web_app_request_emoji_status_access', returns: 'task' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(\n    sharedFeatureOptions(),\n    withVersion,\n    withRequest,\n  ));\n}\n\n/**\n * Shows a native popup requesting permission for the bot to manage user's emoji status.\n * @param options - additional options.\n * @returns Emoji status access status.\n * @since Mini Apps v8.0\n * @example\n * const status = await requestEmojiStatusAccess();\n */\nexport const requestEmojiStatusAccessFp = instantiate();\n\n/**\n * @see requestEmojiStatusAccessFp\n */\nexport const requestEmojiStatusAccess = throwifyWithChecksFp(requestEmojiStatusAccessFp);\n","import { RequestError } from '@tma.js/bridge';\nimport { taskEither as TE, function as fn } from 'fp-ts';\n\nimport { SetEmojiStatusError } from '@/errors.js';\nimport {\n  type SharedFeatureOptions,\n  sharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withRequest, type WithRequest } from '@/fn-options/withRequest.js';\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\nexport interface SetEmojiStatusOptions extends AsyncOptions {\n  duration?: number;\n}\n\ninterface CreateOptions extends SharedFeatureOptions, WithRequest, WithVersion {\n}\n\nfunction create({ request, ...rest }: CreateOptions) {\n  return withChecksFp((\n    customEmojiId: string,\n    options?: SetEmojiStatusOptions,\n  ): TE.TaskEither<RequestError | SetEmojiStatusError, void> => {\n    return fn.pipe(\n      request('web_app_set_emoji_status', ['emoji_status_set', 'emoji_status_failed'], {\n        params: {\n          custom_emoji_id: customEmojiId,\n          duration: (options || {}).duration,\n        },\n        ...options,\n      }),\n      TE.chainW(response => (\n        response.event === 'emoji_status_failed'\n          ? TE.left(new SetEmojiStatusError(response.payload.error))\n          : TE.right(undefined)\n      )),\n    );\n  }, {\n    ...rest,\n    requires: 'web_app_set_emoji_status',\n    returns: 'task',\n  });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(\n    sharedFeatureOptions(),\n    withRequest,\n    withVersion,\n  ));\n}\n\n/**\n * Opens a dialog allowing the user to set the specified custom emoji as their status.\n * @returns Nothing if status set was successful.\n * @param options - additional options.\n * @since Mini Apps v8.0\n * @example\n * fn.pipe(\n *   setEmojiStatusFp('5361800828313167608'),\n *   TE.match(error => {\n *     console.error('Error occurred', error);\n *   }, () => {\n *     console.log('Status set');\n *   }),\n * );\n * const statusSet = await setEmojiStatus('5361800828313167608');\n */\nexport const setEmojiStatusFp = instantiate();\n\n/**\n * @see setEmojiStatusFp\n */\nexport const setEmojiStatus = throwifyWithChecksFp(setEmojiStatusFp);\n","import type {\n  ImpactHapticFeedbackStyle,\n  NotificationHapticFeedbackType,\n  PostEventError,\n} from '@tma.js/bridge';\nimport type { Computed } from '@tma.js/signals';\nimport { either as E } from 'fp-ts';\n\nimport type { SharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport type { WithPostEvent } from '@/fn-options/withPostEvent.js';\nimport type { WithVersion } from '@/fn-options/withVersion.js';\nimport { createIsSupportedSignal } from '@/helpers/createIsSupportedSignal.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { createWithChecksFp, type WithChecksFp, type WithChecks } from '@/with-checks/withChecksFp.js';\n\ntype HapticFeedbackEither = E.Either<PostEventError, void>;\n\nexport interface HapticFeedbackOptions extends WithVersion, WithPostEvent, SharedFeatureOptions {\n}\n\n/**\n * @since Mini Apps v6.1\n */\nexport class HapticFeedback {\n  constructor({ postEvent, isTma, version }: HapticFeedbackOptions) {\n    const HAPTIC_METHOD_NAME = 'web_app_trigger_haptic_feedback';\n    const wrapSupported = createWithChecksFp({\n      requires: HAPTIC_METHOD_NAME,\n      isTma,\n      version,\n      returns: 'plain',\n    });\n\n    this.isSupported = createIsSupportedSignal(HAPTIC_METHOD_NAME, version);\n    this.impactOccurredFp = wrapSupported(style => {\n      return postEvent(HAPTIC_METHOD_NAME, { type: 'impact', impact_style: style });\n    });\n    this.notificationOccurredFp = wrapSupported(type => {\n      return postEvent(HAPTIC_METHOD_NAME, { type: 'notification', notification_type: type });\n    });\n    this.selectionChangedFp = wrapSupported(() => {\n      return postEvent(HAPTIC_METHOD_NAME, { type: 'selection_change' });\n    });\n\n    this.impactOccurred = throwifyWithChecksFp(this.impactOccurredFp);\n    this.notificationOccurred = throwifyWithChecksFp(this.notificationOccurredFp);\n    this.selectionChanged = throwifyWithChecksFp(this.selectionChangedFp);\n  }\n\n  /**\n   * Signal indicating if the component is supported.\n   */\n  readonly isSupported: Computed<boolean>;\n\n  /**\n   * A method that tells if an impact occurred. The Telegram app may play the\n   * appropriate haptics based on style value passed.\n   * @param style - impact style.\n   * @since Mini Apps v6.1\n   */\n  impactOccurredFp: WithChecksFp<(style: ImpactHapticFeedbackStyle) => HapticFeedbackEither, true>;\n\n  /**\n   * @see impactOccurredFp\n   */\n  impactOccurred: WithChecks<(style: ImpactHapticFeedbackStyle) => void, true>;\n\n  /**\n   * A method tells that a task or action has succeeded, failed, or produced\n   * a warning. The Telegram app may play the appropriate haptics based on type\n   * value passed.\n   * @param type - notification type.\n   * @since Mini Apps v6.1\n   */\n  notificationOccurredFp: WithChecksFp<\n    (type: NotificationHapticFeedbackType) => HapticFeedbackEither,\n    true\n  >;\n\n  /**\n   * @see notificationOccurredFp\n   */\n  notificationOccurred: WithChecks<(type: NotificationHapticFeedbackType) => void, true>;\n\n  /**\n   * A method tells that the user has changed a selection. The Telegram app may\n   * play the appropriate haptics.\n   *\n   * Do not use this feedback when the user makes or confirms a selection; use\n   * it only when the selection changes.\n   * @since Mini Apps v6.1\n   */\n  selectionChangedFp: WithChecksFp<() => HapticFeedbackEither, true>;\n\n  /**\n   * @see selectionChangedFp\n   */\n  selectionChanged: WithChecks<() => void, true>;\n}\n","import { function as fn } from 'fp-ts';\n\nimport { HapticFeedback } from '@/features/HapticFeedback/HapticFeedback.js';\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withVersion } from '@/fn-options/withVersion.js';\n\nfunction instantiate() {\n  return new HapticFeedback(fn.pipe(\n    sharedFeatureOptions(),\n    withPostEvent,\n    withVersion,\n  ));\n}\n\nexport const hapticFeedback = /* @__PURE__*/ instantiate();\n","import type { PostEventError } from '@tma.js/bridge';\nimport { function as fn } from 'fp-ts';\nimport type * as E from 'fp-ts/Either';\n\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent, type WithPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithPostEvent, WithVersion {\n}\n\nfunction create({ postEvent, ...rest }: CreateOptions) {\n  return withChecksFp((): E.Either<PostEventError, void> => {\n    return postEvent('web_app_add_to_home_screen');\n  }, { ...rest, requires: 'web_app_add_to_home_screen', returns: 'either' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(\n    sharedFeatureOptions(),\n    withVersion,\n    withPostEvent,\n  ));\n}\n\n/**\n * Prompts the user to add the Mini App to the home screen.\n * @since Mini Apps v8.0\n */\nexport const addToHomeScreenFp = instantiate();\n\n/**\n * @see addToHomeScreenFp\n */\nexport const addToHomeScreen = throwifyWithChecksFp(addToHomeScreenFp);\n","import type { HomeScreenStatus, RequestError } from '@tma.js/bridge';\nimport { taskEither as TE, function as fn } from 'fp-ts';\n\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withRequest, type WithRequest } from '@/fn-options/withRequest.js';\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithRequest, WithVersion {\n}\n\nfunction create({ request, ...rest }: CreateOptions) {\n  return withChecksFp((options?: AsyncOptions): TE.TaskEither<RequestError, HomeScreenStatus> => {\n    return fn.pipe(\n      request('web_app_check_home_screen', 'home_screen_checked', options),\n      TE.map(response => response.status || 'unknown'),\n    );\n  }, { ...rest, requires: 'web_app_check_home_screen', returns: 'task' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(\n    sharedFeatureOptions(),\n    withVersion,\n    withRequest,\n  ));\n}\n\n/**\n * Sends a request to the native Telegram application to check if the current mini\n * application is added to the device's home screen.\n * @param options - additional options.\n * @since Mini Apps v8.0\n */\nexport const checkHomeScreenStatusFp = instantiate();\n\n/**\n * @see checkHomeScreenStatusFp\n */\nexport const checkHomeScreenStatus = throwifyWithChecksFp(checkHomeScreenStatusFp);\n","import { computed, type Computed, signal } from '@tma.js/signals';\nimport { throwifyFpFn } from '@tma.js/toolkit';\nimport type { InitData as InitDataType } from '@tma.js/types';\nimport { either as E, option as O, function as fn } from 'fp-ts';\n\nexport interface InitDataOptions<Err> {\n  /**\n   * Retrieves init data from the current environment.\n   */\n  retrieveInitData: () => E.Either<Err, O.Option<{\n    raw: string;\n    obj: InitDataType;\n  }>>;\n}\n\nexport class InitData<Err extends Error> {\n  constructor({ retrieveInitData }: InitDataOptions<Err>) {\n    this.restoreFp = () => {\n      return fn.pipe(\n        retrieveInitData(),\n        E.map(O.match(() => undefined, ({ raw, obj }) => {\n          this._state.set(obj);\n          this._raw.set(raw);\n        })),\n      );\n    };\n    this.restore = throwifyFpFn(this.restoreFp);\n  }\n\n  private fromState<K extends keyof InitDataType>(key: K): Computed<InitDataType[K] | undefined> {\n    return computed(() => {\n      const s = this._state();\n      return s ? s[key] : undefined;\n    });\n  }\n\n  private readonly _state = signal<InitDataType>();\n\n  private readonly _raw = signal<string>();\n\n  /**\n   * Complete component state.\n   */\n  readonly state = computed(this._state);\n\n  /**\n   * @see InitDataType.auth_date\n   */\n  readonly authDate = this.fromState('auth_date');\n\n  /**\n   * @see InitDataType.can_send_after\n   */\n  readonly canSendAfter = this.fromState('can_send_after');\n\n  /**\n   * Date after which it is allowed to call\n   * the [answerWebAppQuery](https://core.telegram.org/bots/api#answerwebappquery) method.\n   */\n  readonly canSendAfterDate = computed(() => {\n    const authDateValue = this.authDate();\n    const canSendAfterValue = this.canSendAfter();\n\n    return canSendAfterValue && authDateValue\n      ? new Date(authDateValue.getTime() + (canSendAfterValue * 1000))\n      : undefined;\n  });\n\n  /**\n   * @see InitDataType.chat\n   */\n  readonly chat = this.fromState('chat');\n\n  /**\n   * @see InitDataType.chat_type\n   */\n  readonly chatType = this.fromState('chat_type');\n\n  /**\n   * @see InitDataType.chat_instance\n   */\n  readonly chatInstance = this.fromState('chat_instance');\n\n  /**\n   * @see InitDataType.hash\n   */\n  readonly hash = this.fromState('hash');\n\n  /**\n   * @see InitDataType.query_id\n   */\n  readonly queryId = this.fromState('query_id');\n\n  /**\n   * Raw representation of init data.\n   */\n  readonly raw = computed(this._raw);\n\n  /**\n   * @see InitDataType.receiver\n   */\n  readonly receiver = this.fromState('receiver');\n\n  /**\n   * @see InitDataType.signature\n   */\n  readonly signature = this.fromState('signature');\n\n  /**\n   * @see InitDataType.start_param\n   */\n  readonly startParam = this.fromState('start_param');\n\n  /**\n   * @see InitDataType.user\n   */\n  readonly user = this.fromState('user');\n\n  /**\n   * Restores the component state.\n   */\n  readonly restoreFp: () => E.Either<Err, void>;\n\n  /**\n   * @see restoreFp\n   */\n  readonly restore: () => void;\n}\n","import { retrieveRawInitDataFp, retrieveLaunchParamsFp } from '@tma.js/bridge';\nimport { either as E, function as fn, option as O } from 'fp-ts';\n\nimport { InitData } from '@/features/InitData/InitData.js';\n\nfunction instantiate() {\n  return new InitData({\n    retrieveInitData() {\n      return fn.pipe(\n        E.Do,\n        E.bindW('obj', () => fn.pipe(\n          retrieveLaunchParamsFp(),\n          E.map(({ tgWebAppData }) => {\n            return tgWebAppData ? O.some(tgWebAppData) : O.none;\n          }),\n        )),\n        E.bindW('raw', retrieveRawInitDataFp),\n        E.map(({ obj, raw }) => {\n          return fn.pipe(\n            O.Do,\n            O.bind('obj', () => obj),\n            O.bind('raw', () => raw),\n          );\n        }),\n      );\n    },\n  });\n}\n\nexport const initData = /* @__PURE__*/ instantiate();\n","import type { InvoiceStatus, RequestError } from '@tma.js/bridge';\nimport { computed, type Computed, signal } from '@tma.js/signals';\nimport { BetterPromise } from 'better-promises';\nimport { taskEither as TE, function as fn } from 'fp-ts';\n\nimport { ConcurrentCallError, InvalidArgumentsError } from '@/errors.js';\nimport type { SharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport type { WithRequest } from '@/fn-options/withRequest.js';\nimport type { WithVersion } from '@/fn-options/withVersion.js';\nimport { createIsSupportedSignal } from '@/helpers/createIsSupportedSignal.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { createWithChecksFp, type WithChecks, type WithChecksFp } from '@/with-checks/withChecksFp.js';\n\ntype InvoiceTask<E, T> = TE.TaskEither<RequestError | ConcurrentCallError | E, T>;\n\nexport interface InvoiceOptions extends WithVersion, WithRequest, SharedFeatureOptions {\n}\n\n/**\n * @since Mini Apps v6.1\n */\nexport class Invoice {\n  constructor({ version, request, isTma }: InvoiceOptions) {\n    const wrapSupportedTask = createWithChecksFp({\n      version,\n      isTma,\n      requires: 'web_app_open_invoice',\n      returns: 'task',\n    });\n\n    const isOpened = signal(false);\n    const toggleClosed = () => {\n      isOpened.set(false);\n    };\n\n    this.isSupported = createIsSupportedSignal('web_app_open_invoice', version);\n    this.isOpened = computed(isOpened);\n    this.openSlugFp = wrapSupportedTask((slug, options) => {\n      return fn.pipe(\n        this.isOpened()\n          ? TE.left(new ConcurrentCallError('Invoice is already opened'))\n          : TE.right(undefined as never),\n        TE.chain(() => {\n          isOpened.set(true);\n          return request('web_app_open_invoice', 'invoice_closed', {\n            ...options,\n            params: { slug },\n            capture: data => slug === data.slug,\n          });\n        }),\n        TE.mapBoth(err => {\n          toggleClosed();\n          return err;\n        }, data => {\n          toggleClosed();\n          return data.status;\n        }),\n      );\n    });\n    this.openUrlFp = wrapSupportedTask((url, options) => {\n      const { hostname, pathname } = new URL(url, window.location.href);\n      if (hostname !== 't.me') {\n        return TE.left(new InvalidArgumentsError(`Link has unexpected hostname: ${hostname}`));\n      }\n\n      // Valid examples:\n      // \"/invoice/my-slug\"\n      // \"/$my-slug\"\n      const match = pathname.match(/^\\/(\\$|invoice\\/)([A-Za-z0-9\\-_=]+)$/);\n      if (!match) {\n        return TE.left(new InvalidArgumentsError(\n          'Expected to receive a link with a pathname in format \"/invoice/{slug}\" or \"/${slug}\"',\n        ));\n      }\n      return this.openSlugFp(match[2], options);\n    });\n\n    this.openUrl = throwifyWithChecksFp(this.openUrlFp);\n    this.openSlug = throwifyWithChecksFp(this.openSlugFp);\n  }\n\n  /**\n   * Signal indicating if any invoice is currently opened.\n   */\n  readonly isOpened: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is supported.\n   */\n  readonly isSupported: Computed<boolean>;\n\n  /**\n   * Opens an invoice using its slug or URL.\n   * @param slug - invoice slug.\n   * @param options - additional options.\n   * @since Mini Apps v6.1\n   * @example\n   * const status = await invoice.openSlug('kJNFS331');\n   */\n  readonly openSlugFp: WithChecksFp<\n    (slug: string, options?: AsyncOptions) => InvoiceTask<never, InvoiceStatus>,\n    true\n  >;\n\n  /**\n   * @see openSlugFp\n   */\n  readonly openSlug: WithChecks<\n    (slug: string, options?: AsyncOptions) => BetterPromise<InvoiceStatus>,\n    true\n  >;\n\n  /**\n   * Opens an invoice using its URL.\n   * @param url - invoice URL.\n   * @param options - additional options.\n   * @since Mini Apps v6.1\n   * @example\n   * const status = await invoice.openUrl('https://t.me/$kJNFS331');\n   */\n  readonly openUrlFp: WithChecksFp<\n    (url: string, options?: AsyncOptions) => (\n      InvoiceTask<InvalidArgumentsError, InvoiceStatus>\n    ),\n    true\n  >;\n\n  /**\n   * @see openUrlFp\n   */\n  readonly openUrl: WithChecks<\n    (url: string, options?: AsyncOptions) => BetterPromise<InvoiceStatus>,\n    true\n  >;\n}\n","import { function as fn } from 'fp-ts';\n\nimport { Invoice } from '@/features/Invoice/Invoice.js';\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withRequest } from '@/fn-options/withRequest.js';\nimport { withVersion } from '@/fn-options/withVersion.js';\n\nfunction instantiate() {\n  return new Invoice(fn.pipe(sharedFeatureOptions(), withRequest, withVersion));\n}\n\nexport const invoice = /* @__PURE__*/ instantiate();\n","import type { OpenLinkBrowser, PostEventError } from '@tma.js/bridge';\nimport { either as E, function as fn } from 'fp-ts';\n\nimport { InvalidArgumentsError } from '@/errors.js';\nimport {\n  type SharedFeatureOptions,\n  sharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { type WithPostEvent, withPostEvent } from '@/fn-options/withPostEvent.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithPostEvent {\n}\n\nexport interface OpenLinkOptions {\n  /**\n   * Attempts to use the instant view mode.\n   */\n  tryInstantView?: boolean;\n  /**\n   * A preferred browser to open the link in.\n   */\n  tryBrowser?: OpenLinkBrowser;\n}\n\nexport type OpenLinkError = PostEventError | InvalidArgumentsError;\n\nfunction create({ postEvent, ...rest }: CreateOptions) {\n  return withChecksFp((\n    url: string | URL,\n    options: OpenLinkOptions = {},\n  ): E.Either<OpenLinkError, void> => {\n    if (typeof url === 'string') {\n      try {\n        url = new URL(url);\n      } catch (e) {\n        return E.left(new InvalidArgumentsError(`\"${url.toString()}\" is invalid URL`, e));\n      }\n    }\n    return postEvent('web_app_open_link', {\n      url: url.toString(),\n      try_browser: options.tryBrowser,\n      try_instant_view: options.tryInstantView,\n    });\n  }, { ...rest, returns: 'either' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(sharedFeatureOptions(), withPostEvent));\n}\n\n/**\n * Opens a link.\n *\n * The Mini App will not be closed.\n *\n * Note that this method can be called only in response to the user\n * interaction with the Mini App interface (e.g. click inside the Mini App or on the main button).\n * @param url - URL to be opened.\n * @param options - additional options.\n * @example\n * openLink('https://google.com', {\n *   tryInstantView: true,\n *   tryBrowser: 'chrome',\n * });\n */\nexport const openLinkFp = instantiate();\n\nexport const openLink = throwifyWithChecksFp(openLinkFp);\n","import { supports, type PostEventError } from '@tma.js/bridge';\nimport { either as E, function as fn } from 'fp-ts';\n\nimport { InvalidArgumentsError } from '@/errors.js';\nimport {\n  type SharedFeatureOptions,\n  sharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent, type WithPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport { access } from '@/helpers/access.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithPostEvent, WithVersion {\n}\n\nexport type OpenTelegramLinkError = PostEventError | InvalidArgumentsError;\n\nfunction create({ postEvent, version, ...rest }: CreateOptions) {\n  return withChecksFp((\n    url: string | URL,\n  ): E.Either<OpenTelegramLinkError, void> => {\n    const urlString = url.toString();\n    if (!urlString.match(/^https:\\/\\/t.me\\/.+/)) {\n      return E.left(new InvalidArgumentsError(`\"${urlString}\" is invalid URL`));\n    }\n\n    if (supports('web_app_open_tg_link', access(version))) {\n      url = new URL(url);\n      return postEvent('web_app_open_tg_link', { path_full: url.pathname + url.search });\n    }\n\n    window.location.href = urlString;\n    return E.right(undefined);\n  }, { ...rest, returns: 'either' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(\n    sharedFeatureOptions(),\n    withPostEvent,\n    withVersion,\n  ));\n}\n\n/**\n * Opens a Telegram link inside the Telegram app. The function expects passing a link in a full\n * format using the hostname \"t.me\".\n *\n * The Mini App will be closed.\n * @param url - URL to be opened.\n * @example\n * openTelegramLink('https://t.me/heyqbnk');\n */\nexport const openTelegramLinkFp = instantiate();\n\n/**\n * @see openTelegramLinkFp\n */\nexport const openTelegramLink = throwifyWithChecksFp(openTelegramLinkFp);\n","import type { PostEventError } from '@tma.js/bridge';\nimport type { either as E } from 'fp-ts';\n\nimport { openTelegramLinkFp } from '@/features/links/openTelegramLink.js';\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions {\n  openTelegramLink: (url: string) => E.Either<PostEventError, void>;\n}\n\nexport type ShareURLError = PostEventError;\n\nfunction create({ openTelegramLink, ...rest }: CreateOptions) {\n  return withChecksFp((url: string, text?: string): E.Either<ShareURLError, void> => {\n    return openTelegramLink(\n      'https://t.me/share/url?' + new URLSearchParams({ url, text: text || '' })\n        .toString()\n        // By default, URL search params encode spaces with \"+\".\n        // We are replacing them with \"%20\", because plus symbols are working incorrectly\n        // in Telegram.\n        .replace(/\\+/g, '%20'),\n    );\n  }, { ...rest, returns: 'either' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create({\n    ...sharedFeatureOptions(),\n    openTelegramLink: openTelegramLinkFp,\n  });\n}\n\n/**\n * Shares the specified URL with the passed to the chats, selected by user.\n * After being called, it closes the mini application.\n *\n * This method uses Telegram's Share Links.\n * @param url - URL to share.\n * @param text - text to append after the URL.\n * @see https://core.telegram.org/api/links#share-links\n * @see https://core.telegram.org/widgets/share#custom-buttons\n */\nexport const shareURLFp = instantiate();\n\n/**\n * @see shareURLFp\n */\nexport const shareURL = throwifyWithChecksFp(shareURLFp);\n","import type { EventPayload, RequestError, PostEventError } from '@tma.js/bridge';\nimport type { Computed } from '@tma.js/signals';\nimport type { Maybe } from '@tma.js/toolkit';\nimport { BetterPromise } from 'better-promises';\nimport { either as E, taskEither as TE, function as fn } from 'fp-ts';\n\nimport { AsyncMountable } from '@/composables/AsyncMountable.js';\nimport { Stateful } from '@/composables/Stateful.js';\nimport type {\n  LocationManagerOptions,\n  LocationManagerRequestLocationResponse,\n  LocationManagerState,\n} from '@/features/LocationManager/types.js';\nimport { createIsSupportedSignal } from '@/helpers/createIsSupportedSignal.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { createWithChecksFp, type WithChecks, type WithChecksFp } from '@/with-checks/withChecksFp.js';\n\nfunction eventToState(event: EventPayload<'location_checked'>): LocationManagerState {\n  let available = false;\n  let accessRequested: Maybe<boolean>;\n  let accessGranted: Maybe<boolean>;\n  if (event.available) {\n    available = true;\n    accessRequested = event.access_requested;\n    accessGranted = event.access_granted;\n  }\n  return {\n    available,\n    accessGranted: accessGranted || false,\n    accessRequested: accessRequested || false,\n  };\n}\n\n/**\n * @since Mini Apps v8.0\n */\nexport class LocationManager {\n  constructor({\n    version,\n    request,\n    postEvent,\n    storage,\n    isTma,\n    isPageReload,\n  }: LocationManagerOptions) {\n    const stateful = new Stateful({\n      initialState: {\n        available: false,\n        accessGranted: false,\n        accessRequested: false,\n      },\n      onChange: storage.set,\n    });\n    const mountable = new AsyncMountable<LocationManagerState, RequestError>({\n      isPageReload,\n      restoreState: storage.get,\n      onMounted: stateful.setState,\n      initialState(options) {\n        return fn.pipe(\n          request('web_app_check_location', 'location_checked', options),\n          TE.map(eventToState),\n        );\n      },\n    });\n\n    const wrapOptions = { version, requires: 'web_app_check_location', isTma } as const;\n    const wrapSupportedEither = createWithChecksFp({\n      ...wrapOptions,\n      returns: 'either',\n    });\n    const wrapSupportedTask = createWithChecksFp({\n      ...wrapOptions,\n      returns: 'task',\n    });\n    const wrapMountedTask = createWithChecksFp({\n      ...wrapOptions,\n      returns: 'task',\n      isMounted: mountable.isMounted,\n    });\n\n    this.isAvailable = stateful.getter('available');\n    this.isAccessRequested = stateful.getter('accessRequested');\n    this.isAccessGranted = stateful.getter('accessGranted');\n    this.isSupported = createIsSupportedSignal('web_app_check_location', version);\n    this.isMounted = mountable.isMounted;\n    this.state = stateful.state;\n\n    this.unmount = mountable.unmount;\n    this.mountFp = wrapSupportedTask(mountable.mount);\n    this.openSettingsFp = wrapSupportedEither(() => {\n      return postEvent('web_app_open_location_settings');\n    });\n    this.requestLocationFp = wrapMountedTask(options => {\n      return fn.pipe(\n        request('web_app_request_location', 'location_requested', options),\n        TE.map(response => {\n          if (!response.available) {\n            stateful.setState({ available: false });\n            return null;\n          }\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n          const { available, ...rest } = response;\n          return rest;\n        }),\n      );\n    });\n\n    this.mount = throwifyWithChecksFp(this.mountFp);\n    this.openSettings = throwifyWithChecksFp(this.openSettingsFp);\n    this.requestLocation = throwifyWithChecksFp(this.requestLocationFp);\n  }\n\n  /**\n   * Complete location manager state.\n   */\n  readonly state: Computed<LocationManagerState>;\n\n  /**\n   * Signal indicating whether the location data tracking is currently available.\n   */\n  readonly isAvailable: Computed<boolean>;\n\n  /**\n   * Signal indicating whether the user has granted the app permission to track location data.\n   */\n  readonly isAccessGranted: Computed<boolean>;\n\n  /**\n   * Signal indicating whether the app has previously requested permission to track location data.\n   */\n  readonly isAccessRequested: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is currently mounted.\n   */\n  readonly isMounted: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is supported.\n   */\n  readonly isSupported: Computed<boolean>;\n\n  /**\n   * Opens the location access settings for bots. Useful when you need to request location access\n   * from users who haven't granted it yet.\n   *\n   * Note that this method can be called only in response to user interaction with the Mini App\n   * interface (e.g., a click inside the Mini App or on the main button).\n   * @since Mini Apps v8.0\n   */\n  readonly openSettingsFp: WithChecksFp<() => E.Either<PostEventError, void>, true>;\n\n  /**\n   * @see openSettingsFp\n   */\n  readonly openSettings: WithChecks<() => void, true>;\n\n  /**\n   * Requests location data.\n   * @since Mini Apps v8.0\n   * @returns Promise with location data or null it access was not granted.\n   */\n  readonly requestLocationFp: WithChecksFp<\n    (options?: AsyncOptions) => (\n      TE.TaskEither<RequestError, LocationManagerRequestLocationResponse | null>\n    ),\n    true\n  >;\n\n  /**\n   * @see requestLocationFp\n   */\n  readonly requestLocation: WithChecks<\n    (options?: AsyncOptions) => BetterPromise<LocationManagerRequestLocationResponse | null>,\n    true\n  >;\n\n  /**\n   * Mounts the component restoring its state.\n   * @since Mini Apps v8.0\n   */\n  readonly mountFp: WithChecksFp<\n    (options?: AsyncOptions) => TE.TaskEither<RequestError, void>,\n    true\n  >;\n\n  /**\n   * @see mountFp\n   */\n  readonly mount: WithChecks<(options?: AsyncOptions) => BetterPromise<void>, true>;\n\n  /**\n   * Unmounts the component.\n   */\n  readonly unmount: () => void;\n}\n","import { function as fn } from 'fp-ts';\n\nimport { LocationManager } from '@/features/LocationManager/LocationManager.js';\nimport type { LocationManagerState } from '@/features/LocationManager/types.js';\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withRequest } from '@/fn-options/withRequest.js';\nimport { withStateRestore } from '@/fn-options/withStateRestore.js';\nimport { withVersion } from '@/fn-options/withVersion.js';\n\nfunction instantiate() {\n  return new LocationManager(fn.pipe(\n    sharedFeatureOptions(),\n    withPostEvent,\n    withVersion,\n    withRequest,\n    withStateRestore<LocationManagerState>('locationManager'),\n  ));\n}\n\nexport const locationManager = /* @__PURE__*/ instantiate();\n","import type { PostEventError } from '@tma.js/bridge';\nimport { computed, type Computed } from '@tma.js/signals';\nimport type { RGB } from '@tma.js/types';\nimport { either as E } from 'fp-ts';\n\nimport { Button, type ButtonOptions } from '@/composables/Button.js';\nimport { access } from '@/helpers/access.js';\nimport type { MaybeAccessor } from '@/types.js';\nimport type { WithChecks, WithChecksFp } from '@/with-checks/withChecksFp.js';\n\ntype MainButtonEither = E.Either<PostEventError, void>;\n\nexport interface MainButtonState {\n  isVisible: boolean;\n  bgColor?: RGB;\n  hasShineEffect: boolean;\n  isEnabled: boolean;\n  isLoaderVisible: boolean;\n  text: string;\n  textColor?: RGB;\n}\n\nexport interface MainButtonOptions extends Omit<\n  ButtonOptions<MainButtonState, 'web_app_setup_main_button'>,\n  'initialState' | 'method' | 'payload' | 'version'\n> {\n  /**\n   * Default values for different kinds of the button properties.\n   */\n  defaults: {\n    bgColor: MaybeAccessor<RGB>;\n    textColor: MaybeAccessor<RGB>;\n  };\n}\n\nexport class MainButton {\n  constructor({ defaults, ...options }: MainButtonOptions) {\n    const button = new Button({\n      ...options,\n      version: '100',\n      initialState: {\n        hasShineEffect: false,\n        isEnabled: true,\n        isLoaderVisible: false,\n        isVisible: false,\n        text: 'Continue',\n      },\n      method: 'web_app_setup_main_button',\n      payload: state => ({\n        has_shine_effect: state.hasShineEffect,\n        is_visible: state.isVisible,\n        is_active: state.isEnabled,\n        is_progress_visible: state.isLoaderVisible,\n        text: state.text,\n        color: state.bgColor,\n        text_color: state.textColor,\n      }),\n    });\n\n    const withDefault = (\n      field: 'bgColor' | 'textColor',\n      getDefault: MaybeAccessor<RGB>,\n    ) => {\n      const fromState = button.stateGetter(field);\n      return computed(() => fromState() || access(getDefault));\n    };\n\n    this.bgColor = withDefault('bgColor', defaults.bgColor);\n    this.textColor = withDefault('textColor', defaults.textColor);\n    this.hasShineEffect = button.stateGetter('hasShineEffect');\n    this.isEnabled = button.stateGetter('isEnabled');\n    this.isLoaderVisible = button.stateGetter('isLoaderVisible');\n    this.text = button.stateGetter('text');\n    this.isVisible = button.stateGetter('isVisible');\n    this.isMounted = button.isMounted;\n    this.state = button.state;\n\n    [this.setBgColor, this.setBgColorFp] = button.stateSetters('bgColor');\n    [this.setTextColor, this.setTextColorFp] = button.stateSetters('textColor');\n    [\n      [this.disableShineEffect, this.disableShineEffectFp],\n      [this.enableShineEffect, this.enableShineEffectFp],\n    ] = button.stateBoolSetters('hasShineEffect');\n    [\n      [this.disable, this.disableFp],\n      [this.enable, this.enableFp],\n    ] = button.stateBoolSetters('isEnabled');\n    [\n      [this.hideLoader, this.hideLoaderFp],\n      [this.showLoader, this.showLoaderFp],\n    ] = button.stateBoolSetters('isLoaderVisible');\n\n    [this.setText, this.setTextFp] = button.stateSetters('text');\n    [[this.hide, this.hideFp], [this.show, this.showFp]] = button.stateBoolSetters('isVisible');\n    this.setParams = button.setState;\n    this.setParamsFp = button.setStateFp;\n    this.onClick = button.onClick;\n    this.onClickFp = button.onClickFp;\n    this.offClick = button.offClick;\n    this.offClickFp = button.offClickFp;\n    this.mount = button.mount;\n    this.mountFp = button.mountFp;\n    this.unmount = button.unmount;\n  }\n\n  //#region Properties.\n  /**\n   * The button background color.\n   */\n  readonly bgColor: Computed<RGB>;\n\n  /**\n   * True if the button has a shining effect.\n   */\n  readonly hasShineEffect: Computed<boolean>;\n\n  /**\n   * True if the button is clickable.\n   */\n  readonly isEnabled: Computed<boolean>;\n\n  /**\n   * True if the button loader is visible.\n   */\n  readonly isLoaderVisible: Computed<boolean>;\n\n  /**\n   * True if the button is visible.\n   */\n  readonly isVisible: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is currently mounted.\n   */\n  readonly isMounted: Computed<boolean>;\n\n  /**\n   * The complete button state.\n   */\n  readonly state: Computed<MainButtonState>;\n\n  /**\n   * The button displayed text.\n   */\n  readonly text: Computed<string>;\n\n  /**\n   * The button text color.\n   *\n   * Note that this value is computed based on the external defaults. For\n   * example, if not explicitly set, this value may be equal to one of theme\n   * params colors.\n   */\n  readonly textColor: Computed<RGB>;\n  //#endregion\n\n  //#region Methods.\n  /**\n   * Shows the button.\n   */\n  readonly showFp: WithChecksFp<() => MainButtonEither, false>;\n\n  /**\n   * @see showFp\n   */\n  readonly show: WithChecks<() => void, false>;\n\n  /**\n   * Hides the button.\n   */\n  readonly hideFp: WithChecksFp<() => MainButtonEither, false>;\n\n  /**\n   * @see hideFp\n   */\n  readonly hide: WithChecks<() => void, false>;\n\n  /**\n   * Enables the button.\n   */\n  readonly enableFp: WithChecksFp<() => MainButtonEither, false>;\n\n  /**\n   * @see enableFp\n   */\n  readonly enable: WithChecks<() => void, false>;\n\n  /**\n   * Enables the button.\n   */\n  readonly enableShineEffectFp: WithChecksFp<() => MainButtonEither, false>;\n\n  /**\n   * @see enableShineEffectFp\n   */\n  readonly enableShineEffect: WithChecks<() => void, false>;\n\n  /**\n   * Disables the button.\n   */\n  readonly disableFp: WithChecksFp<() => MainButtonEither, false>;\n\n  /**\n   * @see disableFp\n   */\n  readonly disable: WithChecks<() => void, false>;\n\n  /**\n   * Enables the button.\n   */\n  readonly disableShineEffectFp: WithChecksFp<() => MainButtonEither, false>;\n\n  /**\n   * @see disableShineEffectFp\n   */\n  readonly disableShineEffect: WithChecks<() => void, false>;\n\n  /**\n   * Updates the button background color.\n   */\n  readonly setBgColorFp: WithChecksFp<(value: RGB) => MainButtonEither, false>;\n\n  /**\n   * @see setBgColorFp\n   */\n  readonly setBgColor: WithChecks<(value: RGB) => void, false>;\n\n  /**\n   * Updates the button text color.\n   */\n  readonly setTextColorFp: WithChecksFp<(value: RGB) => MainButtonEither, false>;\n\n  /**\n   * @see setTextColorFp\n   */\n  readonly setTextColor: WithChecks<(value: RGB) => void, false>;\n\n  /**\n   * Updates the button text.\n   */\n  readonly setTextFp: WithChecksFp<(value: string) => MainButtonEither, false>;\n\n  /**\n   * @see setTextFp\n   */\n  readonly setText: WithChecks<(value: string) => void, false>;\n\n  /**\n   * Shows the button loader.\n   */\n  readonly showLoaderFp: WithChecksFp<() => MainButtonEither, false>;\n\n  /**\n   * @see showLoaderFp\n   */\n  readonly showLoader: WithChecks<() => void, false>;\n\n  /**\n   * Hides the button loader.\n   */\n  readonly hideLoaderFp: WithChecksFp<() => MainButtonEither, false>;\n\n  /**\n   * @see hideLoaderFp\n   */\n  readonly hideLoader: WithChecks<() => void, false>;\n\n  /**\n   * Updates the button state.\n   * @param state - updates to apply.\n   * @example\n   * button.setParams({\n   *   text: 'Submit',\n   *   isEnabled: true,\n   *   hasShineEffect: true,\n   * });\n   */\n  readonly setParamsFp: WithChecksFp<(state: Partial<MainButtonState>) => MainButtonEither, false>;\n\n  readonly setParams: WithChecks<(state: Partial<MainButtonState>) => void, false>;\n\n  /**\n   * Mounts the component restoring its state.\n   */\n  readonly mountFp: WithChecksFp<() => void, false>;\n\n  /**\n   * @see mountFp\n   */\n  readonly mount: WithChecks<() => void, false>;\n\n  /**\n   * Unmounts the component.\n   */\n  readonly unmount: () => void;\n\n  /**\n   * Adds a new button listener.\n   * @param listener - event listener.\n   * @param once - should the listener be called only once.\n   * @returns A function to remove bound listener.\n   * @example\n   * const off = button.onClick(() => {\n   *   console.log('User clicked the button');\n   *   off();\n   * });\n   */\n  readonly onClickFp: WithChecksFp<(listener: VoidFunction, once?: boolean) => VoidFunction, false>;\n\n  /**\n   * @see onClickFp\n   */\n  readonly onClick: WithChecks<(listener: VoidFunction, once?: boolean) => VoidFunction, false>;\n\n  /**\n   * Removes the button click listener.\n   * @param listener - event listener.\n   * @param once - should the listener be called only once.\n   * @example\n   * function listener() {\n   *   console.log('User clicked the button');\n   *   button.offClick(listener);\n   * }\n   * button.onClick(listener);\n   */\n  readonly offClickFp: WithChecksFp<(listener: VoidFunction, once?: boolean) => void, false>;\n\n  /**\n   * @see offClickFp\n   */\n  readonly offClick: WithChecks<(listener: VoidFunction, once?: boolean) => void, false>;\n  //#endregion\n}\n","/**\n * Sets CSS variable globally.\n * @param name - variable name.\n * @param value - variable value.\n */\nexport function setCssVar(name: string, value: string | null): void {\n  document.documentElement.style.setProperty(name, value);\n}\n\n/**\n * Deletes specified CSS variable.\n * @param name - variable name.\n */\nexport function deleteCssVar(name: string): void {\n  document.documentElement.style.removeProperty(name);\n}\n","import { throwifyFpFn } from '@tma.js/toolkit';\nimport { toRGBFullFp } from '@tma.js/transformers';\nimport { either as E, function as fn } from 'fp-ts';\n\n/**\n * @param color - color in any format acceptable by the `toRGB` function.\n * @returns True if the color is recognized as dark.\n * @see toRGB\n */\nexport function isColorDarkFp(color: string): E.Either<Error, boolean> {\n  return fn.pipe(\n    toRGBFullFp(color),\n    E.map(rgb => {\n      // Actual formula: hsp = Math.sqrt(0.299 * r * r + 0.587 * g * g + 0.114 * b * b)\n      // See: https://stackoverflow.com/a/596243\n      return Math.sqrt(\n        [0.299, 0.587, 0.114].reduce<number>((acc, modifier, idx) => {\n          // Extract part of #RRGGBB pattern and convert it to DEC.\n          const dec = parseInt(rgb.slice(1 + (idx * 2), 1 + ((idx + 1) * 2)), 16);\n          return acc + (dec * dec * modifier);\n        }, 0),\n      ) < 120;\n    }),\n  );\n}\n\n/**\n * @see isColorDarkFp\n */\nexport const isColorDark = throwifyFpFn(isColorDarkFp);\n","import type { EventListener } from '@tma.js/bridge';\nimport { computed, type Computed, signal } from '@tma.js/signals';\nimport { snakeToKebab } from '@tma.js/toolkit';\nimport type { ThemeParams as ThemeParamsType, RGB } from '@tma.js/types';\nimport { either as E } from 'fp-ts';\n\nimport { Mountable } from '@/composables/Mountable.js';\nimport { Stateful } from '@/composables/Stateful.js';\nimport { CSSVarsBoundError } from '@/errors.js';\nimport type { SharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport type { WithStateRestore } from '@/fn-options/withStateRestore.js';\nimport { access } from '@/helpers/access.js';\nimport { deleteCssVar, setCssVar } from '@/helpers/css-vars.js';\nimport { isColorDark } from '@/helpers/isColorDark.js';\nimport type { MaybeAccessor } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport {\n  createWithChecksFp,\n  type WithChecks,\n  type WithChecksFp,\n} from '@/with-checks/withChecksFp.js';\n\nexport type ThemeParamsState = ThemeParamsType;\n\nexport interface ThemeParamsOptions extends WithStateRestore<ThemeParamsState>,\n  SharedFeatureOptions {\n  /**\n   * Removes a theme change listener.\n   * @param listener - a listener to remove.\n   */\n  offChange: (listener: EventListener<'theme_changed'>) => void;\n  /**\n   * Adds a theme change listener.\n   * @returns A function to remove listener.\n   * @param listener - a listener to add.\n   */\n  onChange: (listener: EventListener<'theme_changed'>) => void;\n  /**\n   * Theme parameters initial state.\n   */\n  initialState: MaybeAccessor<ThemeParamsType>;\n}\n\nexport interface ThemeParamsGetCssVarNameFn {\n  /**\n   * @param property - palette key.\n   * @returns Computed complete CSS variable name.\n   */\n  (property: Extract<keyof ThemeParamsType, string>): string;\n}\n\nexport class ThemeParams {\n  constructor({\n    initialState,\n    onChange,\n    offChange,\n    isTma,\n    storage,\n    isPageReload,\n  }: ThemeParamsOptions) {\n    const stateful = new Stateful<ThemeParamsState>({\n      initialState: {},\n      onChange: storage.set,\n    });\n    const listener: EventListener<'theme_changed'> = event => {\n      stateful.setState(event.theme_params);\n    };\n    const mountable = new Mountable<ThemeParamsType>({\n      initialState: () => E.right(access(initialState)),\n      isPageReload,\n      onMounted(state) {\n        stateful.setState(state);\n        onChange(listener);\n      },\n      onUnmounted() {\n        offChange(listener);\n      },\n      restoreState: storage.get,\n    });\n\n    const wrapOptions = { isTma, returns: 'either' } as const;\n    const wrapSupportedEither = createWithChecksFp(wrapOptions);\n    const wrapMountedEither = createWithChecksFp({\n      ...wrapOptions,\n      isMounted: mountable.isMounted,\n    });\n\n    // Colors.\n    this.accentTextColor = stateful.getter('accent_text_color');\n    this.bgColor = stateful.getter('bg_color');\n    this.buttonColor = stateful.getter('button_color');\n    this.buttonTextColor = stateful.getter('button_text_color');\n    this.bottomBarBgColor = stateful.getter('bottom_bar_bg_color');\n    this.destructiveTextColor = stateful.getter('destructive_text_color');\n    this.headerBgColor = stateful.getter('header_bg_color');\n    this.hintColor = stateful.getter('hint_color');\n    this.linkColor = stateful.getter('link_color');\n    this.secondaryBgColor = stateful.getter('secondary_bg_color');\n    this.sectionBgColor = stateful.getter('section_bg_color');\n    this.sectionHeaderTextColor = stateful.getter('section_header_text_color');\n    this.sectionSeparatorColor = stateful.getter('section_separator_color');\n    this.subtitleTextColor = stateful.getter('subtitle_text_color');\n    this.textColor = stateful.getter('text_color');\n\n    // Other public signals.\n    this.state = stateful.state;\n    this.isMounted = mountable.isMounted;\n    this.bindCssVarsFp = wrapMountedEither(getCSSVarName => {\n      if (this._isCssVarsBound()) {\n        return E.left(new CSSVarsBoundError());\n      }\n      getCSSVarName ||= prop => `--tg-theme-${snakeToKebab(prop)}`;\n\n      const forEachEntry = (fn: (key: string, value: RGB) => void): void => {\n        Object.entries(stateful.state()).forEach(([k, v]) => {\n          v && fn(k, v);\n        });\n      };\n\n      const actualize = (): void => {\n        forEachEntry((k, v) => {\n          setCssVar(getCSSVarName(k), v);\n        });\n      };\n\n      actualize();\n      stateful.state.sub(actualize);\n      this._isCssVarsBound.set(true);\n\n      return E.right(() => {\n        forEachEntry(deleteCssVar);\n        stateful.state.unsub(actualize);\n        this._isCssVarsBound.set(false);\n      });\n    });\n    this.mountFp = wrapSupportedEither(mountable.mount);\n    this.unmount = mountable.unmount;\n\n    this.bindCssVars = throwifyWithChecksFp(this.bindCssVarsFp);\n    this.mount = throwifyWithChecksFp(this.mountFp);\n  }\n\n  //#region Colors.\n  /**\n   * @since v6.10\n   */\n  readonly accentTextColor: Computed<RGB | undefined>;\n\n  readonly bgColor: Computed<RGB | undefined>;\n\n  readonly buttonColor: Computed<RGB | undefined>;\n\n  readonly buttonTextColor: Computed<RGB | undefined>;\n\n  /**\n   * @since v7.10\n   */\n  readonly bottomBarBgColor: Computed<RGB | undefined>;\n\n  readonly destructiveTextColor: Computed<RGB | undefined>;\n\n  /**\n   * @since v6.10\n   */\n  readonly headerBgColor: Computed<RGB | undefined>;\n\n  readonly hintColor: Computed<RGB | undefined>;\n\n  readonly linkColor: Computed<RGB | undefined>;\n\n  readonly secondaryBgColor: Computed<RGB | undefined>;\n\n  /**\n   * @since v6.10\n   */\n  readonly sectionBgColor: Computed<RGB | undefined>;\n\n  /**\n   * @since v6.10\n   */\n  readonly sectionHeaderTextColor: Computed<RGB | undefined>;\n\n  /**\n   * @since v7.6\n   */\n  readonly sectionSeparatorColor: Computed<RGB | undefined>;\n\n  /**\n   * @since v6.10\n   */\n  readonly subtitleTextColor: Computed<RGB | undefined>;\n\n  readonly textColor: Computed<RGB | undefined>;\n  //#endregion\n\n  //#region CSS variables.\n  private readonly _isCssVarsBound = signal(false);\n\n  /**\n   * True if CSS variables are currently bound.\n   */\n  readonly isCssVarsBound = computed(this._isCssVarsBound);\n\n  /**\n   * Creates CSS variables connected with the current theme parameters.\n   *\n   * By default, created CSS variables names are following the pattern \"--tg-theme-{name}\", where\n   * {name} is a theme parameters key name converted from snake case to kebab case.\n   *\n   * Default variables:\n   * - `--tg-theme-bg-color`\n   * - `--tg-theme-secondary-text-color`\n   *\n   * Variables are being automatically updated if theme parameters were changed.\n   *\n   * @param getCSSVarName - function, returning complete CSS variable name for the specified\n   * theme parameters key.\n   * @returns Function to stop updating variables.\n   * @throws {CSSVarsBoundError} CSS variables are already bound\n   * @example Using custom CSS vars generator\n   * themeParams.bindCssVars(key => `--my-prefix-${key}`);\n   */\n  readonly bindCssVarsFp: WithChecksFp<\n    (getCSSVarName?: ThemeParamsGetCssVarNameFn) => E.Either<CSSVarsBoundError, VoidFunction>,\n    false\n  >;\n\n  /**\n   * @see bindCssVarsFp\n   */\n  readonly bindCssVars: WithChecks<\n    (getCSSVarName?: ThemeParamsGetCssVarNameFn) => VoidFunction,\n    false\n  >;\n  //#endregion\n\n  //#region Other public signals.\n  /**\n   * Complete component state.\n   */\n  readonly state: Computed<ThemeParamsType>;\n\n  /**\n   * @returns True if the current color scheme is recognized as dark.\n   * This value is calculated based on the current theme's background color.\n   */\n  readonly isDark = computed(() => {\n    const color = this.bgColor();\n    return !color || isColorDark(color);\n  });\n  //#endregion\n\n  //#region Mounting.\n  /**\n   * Signal indicating if the component is currently mounted.\n   */\n  readonly isMounted: Computed<boolean>;\n\n  /**\n   * Mounts the component restoring its state.\n   */\n  readonly mountFp: WithChecksFp<() => E.Either<never, void>, false>;\n\n  /**\n   * @see mountFp\n   */\n  readonly mount: WithChecks<() => void, false>;\n\n  /**\n   * Unmounts the component.\n   */\n  readonly unmount: () => void;\n  //#endregion\n}\n","import type { ThemeParams } from '@tma.js/types';\n\nimport { createSignal } from '@/globals/signals-registry.js';\n\n/**\n * Mini application's theme parameters.\n */\nexport const themeParams = createSignal<ThemeParams>({});\n","import { on, off } from '@tma.js/bridge';\nimport { function as fn } from 'fp-ts';\n\nimport { ThemeParams, type ThemeParamsState } from '@/features/ThemeParams/ThemeParams.js';\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withStateRestore } from '@/fn-options/withStateRestore.js';\nimport { themeParams as globalThemeParams } from '@/globals/themeParams.js';\n\nfunction instantiate() {\n  return new ThemeParams({\n    ...fn.pipe(\n      sharedFeatureOptions(),\n      withStateRestore<ThemeParamsState>('themeParams'),\n    ),\n    offChange(listener) {\n      off('theme_changed', listener);\n    },\n    onChange(listener) {\n      on('theme_changed', listener);\n    },\n    initialState: globalThemeParams,\n  });\n}\n\nexport const themeParams = /* @__PURE__*/ instantiate();\n","import type { EventName } from '@tma.js/bridge';\nimport { function as fn } from 'fp-ts';\n\nimport { buttonOptions } from '@/fn-options/buttonOptions.js';\n\n// @__NO_SIDE_EFFECTS__\nexport function bottomButtonOptions<S, D>(\n  storageName: string,\n  trackedClickEvent: EventName,\n  defaults: D,\n) {\n  return fn.pipe(\n    buttonOptions<S>(storageName, trackedClickEvent),\n    obj => ({ ...obj, defaults }),\n  );\n}\n","import { computed } from '@tma.js/signals';\n\nimport { MainButton } from '@/features/MainButton/MainButton.js';\nimport { themeParams } from '@/features/ThemeParams/instance.js';\nimport { bottomButtonOptions } from '@/fn-options/bottomButtonOptions.js';\n\nexport const mainButton = /* @__PURE__*/ new MainButton(\n  bottomButtonOptions('mainButton', 'main_button_pressed', {\n    bgColor: computed(() => themeParams.buttonColor() || '#2481cc'),\n    textColor: computed(() => themeParams.buttonTextColor() || '#ffffff'),\n  }),\n);\n","import {\n  supports,\n  type PostEventError,\n  type EventPayload,\n  type EventListener,\n} from '@tma.js/bridge';\nimport { type Computed, computed } from '@tma.js/signals';\nimport { signal } from '@tma.js/signals';\nimport { createCbCollector, camelToKebab } from '@tma.js/toolkit';\nimport { isRGB } from '@tma.js/transformers';\nimport type { KnownThemeParamsKey, RGB, ThemeParams } from '@tma.js/types';\nimport { either as E, function as fn } from 'fp-ts';\n\nimport { Mountable } from '@/composables/Mountable.js';\nimport { Stateful } from '@/composables/Stateful.js';\nimport { CSSVarsBoundError, UnknownThemeParamsKeyError } from '@/errors.js';\nimport type { SharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport type { WithPostEvent } from '@/fn-options/withPostEvent.js';\nimport type { WithStateRestore } from '@/fn-options/withStateRestore.js';\nimport type { WithVersion } from '@/fn-options/withVersion.js';\nimport { access } from '@/helpers/access.js';\nimport { deleteCssVar, setCssVar } from '@/helpers/css-vars.js';\nimport { isColorDark } from '@/helpers/isColorDark.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport {\n  createWithChecksFp,\n  type WithChecks,\n  withChecksFp,\n  type WithChecksFp,\n} from '@/with-checks/withChecksFp.js';\n\ntype AnyColor = RGB | KnownThemeParamsKey | string;\n\nexport interface MiniAppState {\n  bgColor: AnyColor;\n  bottomBarColor: AnyColor;\n  headerColor: AnyColor;\n  isActive: boolean;\n}\n\nexport interface MiniAppGetCssVarNameFn {\n  /**\n   * @param property - mini app property.\n   * @returns Computed complete CSS variable name.\n   */\n  (property: 'bgColor' | 'bottomBarColor' | 'headerColor'): string;\n}\n\ntype WithListeners<Handlers extends string, Payload> = {\n  [K in Handlers]: (listener: (payload: Payload) => void) => void;\n};\n\nexport interface MiniAppOptions extends WithPostEvent,\n  WithVersion,\n  WithStateRestore<MiniAppState>,\n  WithListeners<'onVisibilityChanged' | 'offVisibilityChanged', EventPayload<'visibility_changed'>>,\n  SharedFeatureOptions {\n  /**\n   * The current theme parameters.\n   */\n  theme: Computed<ThemeParams>;\n}\n\n/**\n * @since Mini Apps v6.1\n */\nexport class MiniApp {\n  constructor({\n    storage,\n    isPageReload,\n    version,\n    postEvent,\n    isTma,\n    theme,\n    onVisibilityChanged,\n    offVisibilityChanged,\n  }: MiniAppOptions) {\n    //#region Mounting.\n    const visibilityChangedListener: EventListener<'visibility_changed'> = event => {\n      stateful.setState({ isActive: event.is_visible });\n    };\n    const themeChangedListener = (theme: ThemeParams) => {\n      // Sometimes we may have the following colors to be specified as some theme params keys.\n      // Due to the Mini Apps nature, we are not really allowed to do that, but we want to provide\n      // such an opportunity to developers.\n      //\n      // So if the developer specified some field as a reference to some theme params key, we\n      // should find an according RGB color for it and send it to the Telegram client. We have one\n      // exclusion here - the method 'web_app_set_header_color' may accept values 'bg_color'\n      // and 'secondary_bg_color'. Other methods accept only RGB values.\n      ([\n        [this.headerColor, 'web_app_set_header_color'],\n        [this.bgColor, 'web_app_set_background_color'],\n        [this.bottomBarColor, 'web_app_set_bottom_bar_color'],\n      ] as const).forEach(([signal, method]) => {\n        const color = signal();\n        // The value is already in RGB format, we have nothing to update here.\n        if (isRGB(color)) {\n          return;\n        }\n        // The real RGB value should only be extracted for the following methods:\n        // - 'web_app_set_background_color'\n        // - 'web_app_set_bottom_bar_color'\n        // We should also do it in case of the 'web_app_set_header_color' method, if the value\n        // specified is not 'bg_color' and 'secondary_bg_color' (unknown key to\n        // the Telegram client).\n        if (\n          method !== 'web_app_set_header_color'\n          || !['bg_color', 'secondary_bg_color'].includes(color)\n        ) {\n          const rgb = theme[color];\n          if (rgb) {\n            postEvent(method, { color: rgb });\n          }\n        }\n      });\n    };\n    const mountable = new Mountable({\n      initialState() {\n        return E.right({\n          bgColor: 'bg_color',\n          headerColor: 'header_bg_color',\n          bottomBarColor: 'bottom_bar_bg_color',\n          isActive: true,\n        });\n      },\n      isPageReload,\n      onMounted: state => {\n        onVisibilityChanged(visibilityChangedListener);\n        theme.sub(themeChangedListener);\n        stateful.setState(state);\n      },\n      onUnmounted() {\n        offVisibilityChanged(visibilityChangedListener);\n        theme.unsub(themeChangedListener);\n      },\n      restoreState: storage.get,\n    });\n    this.isMounted = mountable.isMounted;\n    this.mountFp = withChecksFp(() => {\n      const nothing = () => undefined;\n      return fn.pipe(mountable.mount(), E.match(nothing, nothing));\n    }, { isTma, returns: 'plain' });\n    this.mount = throwifyWithChecksFp(this.mountFp);\n    this.unmount = mountable.unmount;\n    //#endregion\n\n    //#region State.\n    const stateful = new Stateful({\n      initialState: {\n        bgColor: 'bg_color',\n        bottomBarColor: 'bottom_bar_bg_color',\n        headerColor: 'bg_color',\n        isActive: false,\n      },\n      onChange: storage.set,\n    });\n    this.state = stateful.state;\n\n    const rgbBasedOn = (color: AnyColor): RGB | undefined => {\n      return isRGB(color) ? color : access(theme)[color];\n    };\n    const computedRgbBasedOn = (signal: Computed<AnyColor>): Computed<RGB | undefined> => {\n      return computed(() => rgbBasedOn(signal()));\n    };\n    //#endregion\n\n    //#region Other properties.\n    this.isActive = stateful.getter('isActive');\n    this.isSupported = computed(() => {\n      return ([\n        'web_app_set_header_color',\n        'web_app_set_background_color',\n        'web_app_set_bottom_bar_color',\n      ] as const).some(method => supports(method, access(version)));\n    });\n    //#endregion\n\n    //#region Css vars.\n    const isCssVarsBound = signal(false);\n    this.isCssVarsBound = computed(isCssVarsBound);\n    this.bindCssVarsFp = withChecksFp(getCSSVarName => {\n      if (isCssVarsBound()) {\n        return E.left(new CSSVarsBoundError());\n      }\n      const [addCleanup, cleanup] = createCbCollector(() => {\n        isCssVarsBound.set(false);\n      });\n\n      const bind = (cssVar: string, signal: Computed<RGB | undefined>) => {\n        const update = () => {\n          setCssVar(cssVar, signal() || null);\n        };\n        update();\n        addCleanup(signal.sub(update), deleteCssVar.bind(null, cssVar));\n      };\n\n      getCSSVarName ||= prop => `--tg-${camelToKebab(prop)}`;\n      bind(getCSSVarName('bgColor'), this.bgColorRgb);\n      bind(getCSSVarName('bottomBarColor'), this.bottomBarColorRgb);\n      bind(getCSSVarName('headerColor'), this.headerColorRgb);\n\n      isCssVarsBound.set(true);\n\n      return E.right(cleanup);\n    }, { isTma, returns: 'either', isMounted: this.isMounted });\n    this.bindCssVars = throwifyWithChecksFp(this.bindCssVarsFp);\n    //#endregion\n\n    //#region Colors.\n    type GenColorToolsetResult<K extends Exclude<keyof MiniAppState, 'isActive'>> = [\n      rawColor: Computed<AnyColor>,\n      rgbColor: Computed<RGB | undefined>,\n      throwing: WithChecks<\n        (color: AnyColor) => void,\n        true,\n        K extends 'headerColor' ? 'rgb' : never\n      >,\n      fp: WithChecksFp<\n        (color: AnyColor) => E.Either<UnknownThemeParamsKeyError | PostEventError, void>,\n        true,\n        K extends 'headerColor' ? 'rgb' : never\n      >,\n    ];\n    const genColorToolset = <K extends Exclude<keyof MiniAppState, 'isActive'>>(\n      stateKey: K,\n    ): GenColorToolsetResult<K> => {\n      const rawColor = stateful.getter(stateKey);\n      const rgbColor = computedRgbBasedOn(rawColor);\n      const method = ({\n        headerColor: 'web_app_set_header_color',\n        bgColor: 'web_app_set_background_color',\n        bottomBarColor: 'web_app_set_bottom_bar_color',\n      } as const)[stateKey];\n\n      const fp = withChecksFp(\n        (color: AnyColor): E.Either<UnknownThemeParamsKeyError | PostEventError, void> => {\n          if (color === rawColor()) {\n            return E.right(undefined);\n          }\n          if (\n            method === 'web_app_set_header_color'\n            && (color === 'bg_color' || color === 'secondary_bg_color')\n          ) {\n            return fn.pipe(\n              postEvent('web_app_set_header_color', { color_key: color }),\n              E.map(() => {\n                stateful.setState({ [stateKey]: color });\n              }),\n            );\n          }\n          const rgb = rgbBasedOn(color);\n          return fn.pipe(\n            rgb\n              ? postEvent(method, { color: rgb })\n              : E.left(new UnknownThemeParamsKeyError(color)),\n            E.map(() => {\n              stateful.setState({ [stateKey]: color });\n            }),\n          );\n        },\n        {\n          isTma,\n          version,\n          requires: method,\n          isMounted: this.isMounted,\n          returns: 'either',\n          supports: stateKey === 'headerColor'\n            ? {\n              rgb: {\n                method: 'web_app_set_header_color',\n                param: 'color',\n                shouldCheck: isRGB,\n              },\n            }\n            : undefined,\n        },\n      );\n\n      return [rawColor, rgbColor, throwifyWithChecksFp(fp), fp] as GenColorToolsetResult<K>;\n    };\n    [\n      this.bgColor,\n      this.bgColorRgb,\n      this.setBgColor,\n      this.setBgColorFp,\n    ] = genColorToolset('bgColor');\n    [\n      this.headerColor,\n      this.headerColorRgb,\n      this.setHeaderColor,\n      this.setHeaderColorFp,\n    ] = genColorToolset('headerColor');\n    [\n      this.bottomBarColor,\n      this.bottomBarColorRgb,\n      this.setBottomBarColor,\n      this.setBottomBarColorFp,\n    ] = genColorToolset('bottomBarColor');\n    //#endregion\n\n    //#region Other methods.\n    const withBasicEither = createWithChecksFp({ isTma, returns: 'either' });\n    this.closeFp = withBasicEither(returnBack => {\n      return postEvent('web_app_close', { return_back: returnBack });\n    });\n    this.close = throwifyWithChecksFp(this.closeFp);\n\n    this.readyFp = withBasicEither(() => postEvent('web_app_ready'));\n    this.ready = throwifyWithChecksFp(this.readyFp);\n    //#endregion\n  }\n\n  //#region Other properties.\n  /**\n   * Signal indicating if the component is supported.\n   */\n  readonly isSupported: Computed<boolean>;\n\n  /**\n   * True if the current Mini App background color is recognized as dark.\n   */\n  readonly isDark = computed(() => {\n    const color = this.bgColorRgb();\n    return color ? isColorDark(color) : false;\n  });\n\n  /**\n   * Signal indicating if the mini app is currently active.\n   */\n  readonly isActive: Computed<boolean>;\n\n  /**\n   * Complete component state.\n   */\n  readonly state: Computed<MiniAppState>;\n  //#endregion\n\n  //#region CSS variables.\n  /**\n   * True if the CSS variables are currently bound.\n   */\n  readonly isCssVarsBound: Computed<boolean>;\n\n  /**\n   * Creates CSS variables connected with the mini app.\n   *\n   * Default variables:\n   * - `--tg-bg-color`\n   * - `--tg-header-color`\n   * - `--tg-bottom-bar-color`\n   *\n   * Variables are being automatically updated if theme parameters were changed.\n   *\n   * @param getCSSVarName - function, returning complete CSS variable name for the specified\n   * mini app key.\n   * @returns Function to stop updating variables.\n   * @example Using no arguments\n   * miniApp.bindCssVars();\n   * @example Using custom CSS vars generator\n   * miniApp.bindCssVars(key => `--my-prefix-${key}`);\n   */\n  readonly bindCssVarsFp: WithChecksFp<\n    (getCssVarName?: MiniAppGetCssVarNameFn) => E.Either<CSSVarsBoundError, VoidFunction>,\n    false\n  >;\n\n  readonly bindCssVars: WithChecks<(getCssVarName?: MiniAppGetCssVarNameFn) => VoidFunction, false>;\n  //#endregion\n\n  //#region Mounting.\n  /**\n   * Signal indicating if the component is mounted.\n   */\n  readonly isMounted: Computed<boolean>;\n\n  /**\n   * Mounts the component.\n   *\n   * This function restores the component state and is automatically saving it in the local storage\n   * if it changed.\n   * @since Mini Apps v6.1\n   */\n  readonly mountFp: WithChecksFp<() => void, false>;\n\n  /**\n   * @see mount\n   */\n  readonly mount: WithChecks<() => void, false>;\n\n  /**\n   * Unmounts the component.\n   */\n  readonly unmount: () => void;\n  //#endregion\n\n  //#region Background color.\n  /**\n   * The Mini App background color.\n   *\n   * Represents an RGB color, or theme parameters key, like \"bg_color\", \"secondary_bg_color\", etc.\n   *\n   * Note that using a theme parameters key, background color becomes bound to the current\n   * theme parameters, making it automatically being updated whenever theme parameters change.\n   * In order to remove this bind, use an explicit RGB color.\n   */\n  readonly bgColor: Computed<AnyColor>;\n\n  /**\n   * RGB representation of the background color.\n   *\n   * This value requires the Theme Params component to be mounted to extract a valid RGB value\n   * of the color key.\n   */\n  readonly bgColorRgb: Computed<RGB | undefined>;\n\n  /**\n   * Updates the mini app background color.\n   * @since Mini Apps v6.1\n   */\n  readonly setBgColorFp: WithChecksFp<\n    (color: AnyColor) => E.Either<PostEventError | UnknownThemeParamsKeyError, void>,\n    true\n  >;\n\n  /**\n   * @see setBgColorFp\n   */\n  readonly setBgColor: WithChecks<(color: AnyColor) => void, true>;\n  //#endregion\n\n  //#region Header color.\n  /**\n   * The Mini App header color.\n   */\n  readonly headerColor: Computed<AnyColor>;\n\n  /**\n   * RGB representation of the header color.\n   *\n   * This value requires the Theme Params component to be mounted to extract a valid RGB value\n   * of the color key.\n   */\n  readonly headerColorRgb: Computed<RGB | undefined>;\n\n  /**\n   * Updates the mini app header color.\n   * @since Mini Apps v6.1\n   */\n  readonly setHeaderColorFp: WithChecksFp<\n    (color: AnyColor) => E.Either<PostEventError | UnknownThemeParamsKeyError, void>,\n    true,\n    'rgb'\n  >;\n\n  /**\n   * @see setHeaderColorFp\n   */\n  readonly setHeaderColor: WithChecks<(color: AnyColor) => void, true, 'rgb'>;\n  //#endregion\n\n  //#region Bottom bar background color.\n  /**\n   * The Mini App bottom bar background color.\n   */\n  readonly bottomBarColor: Computed<AnyColor>;\n\n  /**\n   * RGB representation of the bottom bar background color.\n   *\n   * This value requires the Theme Params component to be mounted to extract a valid RGB value\n   * of the color key.\n   */\n  readonly bottomBarColorRgb: Computed<RGB | undefined>;\n\n  /**\n   * Updates the mini app bottom bar bg color.\n   * @since Mini Apps v7.10\n   */\n  readonly setBottomBarColorFp: WithChecksFp<\n    (color: AnyColor) => E.Either<PostEventError | UnknownThemeParamsKeyError, void>,\n    true\n  >;\n\n  /**\n   * @see setBottomBarColorFp\n   */\n  readonly setBottomBarColor: WithChecks<(color: AnyColor) => void, true>;\n  //#endregion\n\n  //#region Other methods.\n  /**\n   * Closes the Mini App.\n   * @param returnBack - should the client return to the previous activity.\n   */\n  readonly closeFp: WithChecksFp<(returnBack?: boolean) => E.Either<PostEventError, void>, false>;\n\n  /**\n   * @see closeFp\n   */\n  readonly close: WithChecks<(returnBack?: boolean) => void, false>;\n\n  /**\n   * Informs the Telegram app that the Mini App is ready to be displayed.\n   *\n   * It is recommended to call this method as early as possible, as soon as all\n   * essential interface elements loaded.\n   *\n   * Once this method is called, the loading placeholder is hidden and the Mini\n   * App shown.\n   *\n   * If the method is not called, the placeholder will be hidden only when the\n   * page was fully loaded.\n   */\n  readonly readyFp: WithChecksFp<() => E.Either<PostEventError, void>, false>;\n\n  /**\n   * @see readyFp\n   */\n  readonly ready: WithChecks<() => void, false>;\n  //#endregion\n}\n","import { on, off } from '@tma.js/bridge';\nimport { function as fn } from 'fp-ts';\n\nimport { MiniApp, type MiniAppState } from '@/features/MiniApp/MiniApp.js';\nimport { themeParams } from '@/features/ThemeParams/instance.js';\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withStateRestore } from '@/fn-options/withStateRestore.js';\nimport { withVersion } from '@/fn-options/withVersion.js';\n\nfunction instantiate() {\n  return new MiniApp({\n    ...fn.pipe(\n      sharedFeatureOptions(),\n      withPostEvent,\n      withVersion,\n      withStateRestore<MiniAppState>('miniApp'),\n    ),\n    offVisibilityChanged(listener) {\n      off('visibility_changed', listener);\n    },\n    onVisibilityChanged(listener) {\n      on('visibility_changed', listener);\n    },\n    theme: themeParams.state,\n  });\n}\n\nexport const miniApp = /* @__PURE__*/ instantiate();\n","import type { PopupParams, PopupButton } from '@tma.js/bridge';\nimport { either as E } from 'fp-ts';\n\nimport { InvalidArgumentsError } from '@/errors.js';\nimport type { ShowOptions } from '@/features/Popup/types.js';\n\n/**\n * Prepares popup parameters before sending them to native app.\n * @param params - popup parameters.\n */\nexport function prepareParams(params: ShowOptions): E.Either<InvalidArgumentsError, PopupParams> {\n  const message = params.message.trim();\n  const title = (params.title || '').trim();\n  const paramsButtons = params.buttons || [];\n\n  if (title.length > 64) {\n    return E.left(new InvalidArgumentsError(`Invalid title: ${title}`));\n  }\n  if (!message || message.length > 256) {\n    return E.left(new InvalidArgumentsError(`Invalid message: ${message}`));\n  }\n  if (paramsButtons.length > 3) {\n    return E.left(new InvalidArgumentsError(`Invalid buttons count: ${paramsButtons.length}`));\n  }\n\n  const buttons: PopupButton[] = [];\n  if (!paramsButtons.length) {\n    buttons.push({ type: 'close', id: '' });\n  } else {\n    for (let i = 0; i < paramsButtons.length; i++) {\n      const button = paramsButtons[i];\n      const id = button.id || '';\n      if (id.length > 64) {\n        return E.left(new InvalidArgumentsError(`Button with index ${i} has invalid id: ${id}`));\n      }\n\n      if (!button.type || button.type === 'default' || button.type === 'destructive') {\n        const text = button.text.trim();\n        if (!text || text.length > 64) {\n          return E.left(new InvalidArgumentsError(`Button with index ${i} has invalid text: ${text}`));\n        }\n        buttons.push({ type: button.type, text, id });\n      } else {\n        buttons.push({ type: button.type, id });\n      }\n    }\n  }\n\n  return E.right({ title, message, buttons });\n}\n","import type { RequestError } from '@tma.js/bridge';\nimport { type Computed, signal, computed } from '@tma.js/signals';\nimport type { BetterPromise } from 'better-promises';\nimport { taskEither as TE, function as fn } from 'fp-ts';\n\nimport { ConcurrentCallError, type InvalidArgumentsError } from '@/errors.js';\nimport { prepareParams } from '@/features/Popup/prepareParams.js';\nimport type { ShowOptions } from '@/features/Popup/types.js';\nimport type { SharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport type { WithRequest } from '@/fn-options/withRequest.js';\nimport type { WithVersion } from '@/fn-options/withVersion.js';\nimport { createIsSupportedSignal } from '@/helpers/createIsSupportedSignal.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { createWithChecksFp, type WithChecksFp, type WithChecks } from '@/with-checks/withChecksFp.js';\n\nexport interface PopupOptions extends SharedFeatureOptions, WithVersion, WithRequest {\n}\n\n/**\n * @since Mini Apps v6.2\n */\nexport class Popup {\n  constructor({ version, isTma, request }: PopupOptions) {\n    const isOpened = signal(false);\n    const toggleClosed = () => {\n      isOpened.set(false);\n    };\n\n    const wrapSupportedTask = createWithChecksFp({\n      version,\n      isTma,\n      requires: 'web_app_open_popup',\n      returns: 'task',\n    });\n\n    this.isSupported = createIsSupportedSignal('web_app_open_popup', version);\n    this.isOpened = computed(isOpened);\n    this.showFp = wrapSupportedTask(options => {\n      return fn.pipe(\n        this.isOpened()\n          ? TE.left(new ConcurrentCallError('A popup is already opened'))\n          : TE.right(undefined as never),\n        TE.chainW(() => TE.fromEither(prepareParams(options))),\n        TE.chain(preparedOptions => {\n          isOpened.set(true);\n          return request('web_app_open_popup', 'popup_closed', {\n            ...options,\n            params: preparedOptions,\n          });\n        }),\n        TE.mapBoth(\n          err => {\n            toggleClosed();\n            return err;\n          },\n          response => {\n            toggleClosed();\n            return response.button_id;\n          },\n        ),\n      );\n    });\n    this.show = throwifyWithChecksFp(this.showFp);\n  }\n\n  /**\n   * Signal indicating if any popup is currently opened.\n   */\n  readonly isOpened: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is supported.\n   */\n  readonly isSupported: Computed<boolean>;\n\n  /**\n   * A method that shows a native popup described by the `params` argument.\n   * The promise will be resolved when the popup is closed. Resolved value will have\n   * an identifier of the pressed button.\n   *\n   * If a user clicked outside the popup or clicked the top right popup close\n   * button, null will be resolved.\n   *\n   * @param options - popup parameters.\n   * @since Mini Apps v6.2\n   * @example\n   * fn.pipe(\n   *   popup.showFp({\n   *     title: 'Confirm action',\n   *     message: 'Do you really want to buy this burger?',\n   *     buttons: [\n   *       { id: 'yes', text: 'Yes' },\n   *       { id: 'no', type: 'destructive', text: 'No' },\n   *     ],\n   *   }),\n   *   TE.map(buttonId => {\n   *     console.log('User clicked a button with ID', buttonId);\n   *   }),\n   * );\n   */\n  readonly showFp: WithChecksFp<\n    (options: ShowOptions) => TE.TaskEither<\n      RequestError | InvalidArgumentsError | ConcurrentCallError,\n      string | undefined\n    >,\n    true\n  >;\n\n  /**\n   * @see showFp\n   */\n  readonly show: WithChecks<(options: ShowOptions) => BetterPromise<string | undefined>, true>;\n}\n","import { function as fn } from 'fp-ts';\n\nimport { Popup } from '@/features/Popup/Popup.js';\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withRequest } from '@/fn-options/withRequest.js';\nimport { withVersion } from '@/fn-options/withVersion.js';\n\nfunction instantiate() {\n  return new Popup(fn.pipe(sharedFeatureOptions(), withRequest, withVersion));\n}\n\nexport const popup = /* @__PURE__*/ instantiate();\n","import type { PhoneRequestedStatus, RequestError } from '@tma.js/bridge';\nimport { taskEither as TE, function as fn } from 'fp-ts';\n\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withRequest, type WithRequest } from '@/fn-options/withRequest.js';\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithRequest, WithVersion {\n}\n\nexport type RequestPhoneAccessError = RequestError;\n\nfunction create({ request, ...rest }: CreateOptions) {\n  return withChecksFp((\n    options?: AsyncOptions,\n  ): TE.TaskEither<RequestPhoneAccessError, PhoneRequestedStatus> => {\n    return fn.pipe(\n      request('web_app_request_phone', 'phone_requested', options),\n      TE.map(response => response.status),\n    );\n  }, { ...rest, requires: 'web_app_request_phone', returns: 'task' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(\n    sharedFeatureOptions(),\n    withVersion,\n    withRequest,\n  ));\n}\n\n/**\n * Requests current user phone access. Method returns promise, which resolves\n * status of the request. In case, user accepted the request, Mini App bot will receive\n * the according notification.\n *\n * To obtain the retrieved information instead, utilize the `requestContact` method.\n * @param options - additional options.\n * @since Mini Apps v6.9\n * @see requestContact\n */\nexport const requestPhoneAccessFp = instantiate();\n\n/**\n * @see requestPhoneAccessFp\n */\nexport const requestPhoneAccess = throwifyWithChecksFp(requestPhoneAccessFp);\n","import { PhoneRequestedStatus } from '@tma.js/bridge';\nimport { BetterTaskEither, type BetterTaskEitherError } from '@tma.js/toolkit';\nimport { pipeJsonToSchema, pipeQueryToSchema } from '@tma.js/transformers';\nimport { either as E, taskEither as TE, function as fn } from 'fp-ts';\nimport {\n  safeParse,\n  pipe as valiPipe,\n  date,\n  looseObject,\n  number,\n  optional,\n  string,\n  transform,\n} from 'valibot';\n\nimport { AccessDeniedError, ValidationError } from '@/errors.js';\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\n\nimport {\n  withInvokeCustomMethod,\n  type WithInvokeCustomMethod,\n  InvokeCustomMethodError,\n} from '@/fn-options/withInvokeCustomMethod.js';\n\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\n\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\nimport { type RequestPhoneAccessError, requestPhoneAccessFp } from './requestPhoneAccess.js';\n\n/**\n * Requested contact information.\n */\nexport interface RequestedContact {\n  contact: {\n    user_id: number;\n    phone_number: string;\n    first_name: string;\n    last_name?: string;\n    [key: string]: unknown;\n  };\n  auth_date: Date;\n  hash: string;\n  [key: string]: unknown;\n}\n\n/**\n * Requested contact complete data.\n */\nexport interface RequestedContactCompleteData {\n  /**\n   * Raw original representation of the contact data returned from the Telegram server.\n   */\n  raw: string;\n  /**\n   * Parsed representation of the contact data.\n   */\n  parsed: RequestedContact;\n}\n\ninterface CreateCompleteOptions extends SharedFeatureOptions, WithInvokeCustomMethod, WithVersion {\n  requestPhoneAccess: (options?: AsyncOptions) => (\n    TE.TaskEither<RequestPhoneAccessError, PhoneRequestedStatus>\n  );\n}\n\ninterface CreateParsedOptions extends SharedFeatureOptions, WithVersion {\n  requestContact: (options?: AsyncOptions) => TE.TaskEither<RequestContactError, RequestedContact>;\n}\n\nexport type RequestContactError =\n  | InvokeCustomMethodError\n  | AccessDeniedError\n  | ValidationError\n  | BetterTaskEitherError;\n\nfunction createComplete({\n  invokeCustomMethod,\n  requestPhoneAccess,\n  ...rest\n}: CreateCompleteOptions) {\n  type GetRequestedContactError = InvokeCustomMethodError | ValidationError;\n\n  // Attempts to get previously requested contact.\n  const getContact = (\n    options?: AsyncOptions,\n  ): TE.TaskEither<GetRequestedContactError, RequestedContactCompleteData | undefined> => {\n    return fn.pipe(\n      invokeCustomMethod('getRequestedContact', {}, {\n        ...options,\n        timeout: (options || {}).timeout || 5000,\n      }),\n      TE.chainW(response => {\n        const toStringResult = safeParse(string(), response);\n        if (!toStringResult.success) {\n          return TE.left(new ValidationError(response, toStringResult.issues));\n        }\n\n        if (!toStringResult.output) {\n          return TE.right(undefined);\n        }\n\n        const toParsedResult = safeParse(\n          pipeQueryToSchema(\n            looseObject({\n              contact: pipeJsonToSchema(looseObject({\n                user_id: number(),\n                phone_number: string(),\n                first_name: string(),\n                last_name: optional(string()),\n              })),\n              auth_date: valiPipe(\n                string(),\n                transform(input => new Date(Number(input) * 1000)),\n                date(),\n              ),\n              hash: string(),\n            }),\n          ),\n          toStringResult.output,\n        );\n        return toParsedResult.success\n          ? TE.right({ raw: toStringResult.output, parsed: toParsedResult.output })\n          : TE.left(new ValidationError(toStringResult.output, toParsedResult.issues));\n      }),\n    );\n  };\n\n  // Attempts to get previously requested contact, but ignores all errors except validation error.\n  const getContactWithErrorsIgnore = (\n    options?: AsyncOptions,\n  ): TE.TaskEither<ValidationError, RequestedContactCompleteData | undefined> => {\n    return fn.pipe(\n      getContact(options),\n      TE.match(\n        // All other errors except validation ones should be ignored. Receiving validation error\n        // means that we have some data, but we are unable to parse it properly. So, there is no\n        // need to make some more requests further, the problem is local.\n        error => (ValidationError.is(error) ? E.left(error) : E.right(undefined)),\n        contact => E.right(contact),\n      ),\n    );\n  };\n\n  // Polls previously requested contact with increasing timeout between requests.\n  const pollContact = (ctx: {\n    isRejected: boolean;\n    rejectReason: unknown;\n    abortSignal: AbortSignal;\n  }): TE.TaskEither<BetterTaskEitherError | ValidationError, RequestedContactCompleteData> => {\n    return BetterTaskEither<ValidationError, RequestedContactCompleteData>(\n      async (res, rej, context) => {\n        // Time to wait before executing the next request.\n        let sleepTime = 50;\n\n        // We are trying to retrieve the requested contact until the deadline was reached.\n        while (!context.isRejected) {\n          const result = await getContactWithErrorsIgnore(context)();\n          if (result._tag === 'Left') {\n            return rej(result.left);\n          }\n          if (result.right) {\n            return res(result.right);\n          }\n          await new Promise(resolve => setTimeout(resolve, sleepTime));\n          sleepTime += 50;\n        }\n      },\n      ctx,\n    );\n  };\n\n  return withChecksFp((\n    options?: AsyncOptions,\n  ): TE.TaskEither<RequestContactError, RequestedContactCompleteData> => {\n    return BetterTaskEither.fn(context => {\n      return fn.pipe(\n        // Try to get the requested contact. Probably, we already requested it before.\n        getContactWithErrorsIgnore(context),\n        TE.chain(contact => {\n          if (contact) {\n            return TE.right(contact);\n          }\n          return fn.pipe(\n            requestPhoneAccess(context),\n            TE.chainW(status => {\n              return status === 'sent'\n                ? pollContact(context)\n                : TE.left(new AccessDeniedError('User denied access'));\n            }),\n          );\n        }),\n      );\n    }, options);\n  }, { ...rest, returns: 'task', requires: 'web_app_request_phone' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiateComplete() {\n  return createComplete({\n    ...fn.pipe(sharedFeatureOptions(), withInvokeCustomMethod, withVersion),\n    requestPhoneAccess: requestPhoneAccessFp,\n  });\n}\n\nfunction createParsed({ requestContact, ...rest }: CreateParsedOptions) {\n  return withChecksFp(\n    requestContact,\n    { ...rest, returns: 'task', requires: 'web_app_request_phone' },\n  );\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiateParsed() {\n  return createParsed({\n    ...fn.pipe(sharedFeatureOptions(), withVersion),\n    requestContact(options) {\n      return fn.pipe(\n        requestContactCompleteFp(options),\n        TE.map(contact => contact.parsed),\n      );\n    },\n  });\n}\n\n/**\n * Requests current user contact information.\n *\n * This function returns an object, containing both raw and parsed representations of a response,\n * received from the Telegram client.\n * @param options - additional options.\n * @since Mini Apps v6.9\n */\nexport const requestContactCompleteFp = instantiateComplete();\n\n/**\n * @see requestContactCompleteFp\n */\nexport const requestContactComplete = throwifyWithChecksFp(requestContactCompleteFp);\n\n/**\n * Works the same way as the `requestContactCompleteFp` function, but returns only parsed\n * representation of the contact data.\n * @see requestContactCompleteFp\n * @param options - additional options.\n * @since Mini Apps v6.9\n */\nexport const requestContactFp = instantiateParsed();\n\n/**\n * @see requestContactFp\n */\nexport const requestContact = throwifyWithChecksFp(requestContactFp);\n","import type { WriteAccessRequestedStatus, RequestError } from '@tma.js/bridge';\nimport { taskEither as TE, function as fn } from 'fp-ts';\n\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withRequest, type WithRequest } from '@/fn-options/withRequest.js';\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithRequest, WithVersion {\n}\n\nexport type RequestWriteAccessError = RequestError;\n\nfunction create({ request, ...rest }: CreateOptions) {\n  return withChecksFp((\n    options?: AsyncOptions,\n  ): TE.TaskEither<RequestWriteAccessError, WriteAccessRequestedStatus> => {\n    return fn.pipe(\n      request('web_app_request_write_access', 'write_access_requested', options),\n      TE.map(response => response.status),\n    );\n  }, { ...rest, requires: 'web_app_request_write_access', returns: 'task' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(\n    sharedFeatureOptions(),\n    withVersion,\n    withRequest,\n  ));\n}\n\n/**\n * Requests write message access to the current user.\n * @param options - additional options.\n * @since Mini Apps v6.9\n */\nexport const requestWriteAccessFp = instantiate();\n\n/**\n * @see requestWriteAccessFp\n */\nexport const requestWriteAccess = throwifyWithChecksFp(requestWriteAccessFp);\n","import type { PostEventError } from '@tma.js/bridge';\nimport { computed, type Computed, signal } from '@tma.js/signals';\nimport { createCbCollector, BetterTaskEither, type BetterTaskEitherError } from '@tma.js/toolkit';\nimport { BetterPromise } from 'better-promises';\nimport { either as E, taskEither as TE, function as fn } from 'fp-ts';\n\nimport { ConcurrentCallError } from '@/errors.js';\nimport type { SharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport type { WithPostEvent } from '@/fn-options/withPostEvent.js';\nimport type { WithVersion } from '@/fn-options/withVersion.js';\nimport { createIsSupportedSignal } from '@/helpers/createIsSupportedSignal.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport {\n  createWithChecksFp,\n  type WithChecks,\n  type WithChecksFp,\n} from '@/with-checks/withChecksFp.js';\n\nexport interface QrScannerOptions extends WithVersion, WithPostEvent, SharedFeatureOptions {\n  /**\n   * A function to add a listener to the event determining if the QR scanner\n   * was closed.\n   * @param listener - a listener to add.\n   * @returns A function to remove the listener.\n   */\n  onClosed: (listener: VoidFunction) => VoidFunction;\n  /**\n   * A function to add a listener to the event containing a scanned QR content.\n   * @param listener - a listener to add.\n   * @returns A function to remove the listener.\n   */\n  onTextReceived: (listener: (data: string) => void) => VoidFunction;\n}\n\ninterface SharedOptions extends AsyncOptions {\n  /**\n   * Title to be displayed in the scanner.\n   */\n  text?: string;\n}\n\ninterface CaptureOptions extends SharedOptions {\n  /**\n   * @returns True if the passed QR code should be captured.\n   * @param qr - scanned QR content.\n   */\n  capture: (qr: string) => boolean;\n}\n\ninterface OpenOptions extends SharedOptions {\n  /**\n   * Function which will be called if a QR code was scanned.\n   * @param qr - scanned QR content.\n   */\n  onCaptured: (qr: string) => void;\n}\n\n/**\n * @since Mini Apps v6.4\n */\nexport class QrScanner {\n  constructor({\n    version,\n    onClosed,\n    onTextReceived,\n    isTma,\n    postEvent,\n  }: QrScannerOptions) {\n    const wrapOptions = { version, requires: 'web_app_open_scan_qr_popup', isTma } as const;\n    const wrapSupportedEither = createWithChecksFp({ ...wrapOptions, returns: 'either' });\n    const wrapSupportedTask = createWithChecksFp({ ...wrapOptions, returns: 'task' });\n\n    const isOpened = signal(false);\n    const setClosed = () => {\n      isOpened.set(false);\n    };\n\n    this.isSupported = createIsSupportedSignal('web_app_open_scan_qr_popup', version);\n    this.isOpened = computed(isOpened);\n\n    this.captureFp = wrapSupportedTask(options => {\n      let captured: string | undefined;\n      return fn.pipe(\n        this.openFp({\n          ...options,\n          onCaptured: qr => {\n            if (options.capture(qr)) {\n              captured = qr;\n              this.close();\n            }\n          },\n        }),\n        TE.map(() => captured),\n      );\n    });\n    this.closeFp = wrapSupportedEither(() => {\n      return fn.pipe(postEvent('web_app_close_scan_qr_popup'), E.map(setClosed));\n    });\n    this.openFp = wrapSupportedTask(options => {\n      return fn.pipe(\n        isOpened()\n          ? TE.left(new ConcurrentCallError('The QR Scanner is already opened'))\n          : async () => postEvent('web_app_open_scan_qr_popup', { text: options.text }),\n        TE.chainW(() => {\n          isOpened.set(true);\n          const [addToCleanup, cleanup] = createCbCollector();\n          const onSettled = <T>(value: T): T => {\n            cleanup();\n            isOpened.set(false);\n            return value;\n          };\n\n          return fn.pipe(\n            BetterTaskEither<never, void>(resolve => {\n              addToCleanup(\n                // The scanner was closed externally.\n                onClosed(resolve),\n                // The scanner was closed internally.\n                isOpened.sub(isOpenedValue => {\n                  if (!isOpenedValue) {\n                    resolve();\n                  }\n                }),\n                onTextReceived(options.onCaptured),\n              );\n            }, options),\n            TE.mapBoth(onSettled, onSettled),\n          );\n        }),\n      );\n    });\n\n    this.open = throwifyWithChecksFp(this.openFp);\n    this.capture = throwifyWithChecksFp(this.captureFp);\n    this.close = throwifyWithChecksFp(this.closeFp);\n  }\n\n  /**\n   * Signal indicating if the scanner is currently opened.\n   */\n  readonly isOpened: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is supported.\n   */\n  readonly isSupported: Computed<boolean>;\n\n  /**\n   * Opens the scanner and returns a task which will be completed with the QR content if the\n   * passed `capture` function returned true.\n   *\n   * Task may also be completed with undefined if the scanner was closed.\n   * @param options - method options.\n   * @returns A promise with QR content presented as string or undefined if the scanner was closed.\n   * @since Mini Apps v6.4\n   * @example\n   * fn.pipe(\n   *   qrScanner.captureFp({\n   *     capture(scannedQr) {\n   *       return scannedQr === 'any expected by me qr';\n   *     }\n   *   }),\n   *   TE.match(\n   *     error => {\n   *       console.error(error);\n   *     },\n   *     qr => {\n   *       console.log('My QR:'), qr;\n   *     }\n   *   ),\n   * );\n   */\n  readonly captureFp: WithChecksFp<\n    (options: CaptureOptions) => (\n      TE.TaskEither<PostEventError | BetterTaskEitherError, string | undefined>\n    ),\n    true\n  >;\n\n  /**\n   * @see captureFp\n   */\n  readonly capture: WithChecks<\n    (options: CaptureOptions) => BetterPromise<string | undefined>,\n    true\n  >;\n\n  /**\n   * Closes the scanner.\n   * @since Mini Apps v6.4\n   */\n  readonly closeFp: WithChecksFp<() => E.Either<PostEventError, void>, true>;\n\n  /**\n   * @see close\n   */\n  readonly close: WithChecks<() => void, true>;\n\n  /**\n   * Opens the scanner and returns a task which will be completed when the scanner was closed.\n   * @param options - method options.\n   * @since Mini Apps v6.4\n   * @example Without `capture` option\n   * if (qrScanner.open.isAvailable()) {\n   *   const qr = await qrScanner.open({ text: 'Scan any QR' });\n   * }\n   * @example\n   * fn.pipe(\n   *   qrScanner.openFp({\n   *     onCaptured(scannedQr) {\n   *       if (scannedQr === 'any expected by me qr') {\n   *         qrScanner.close();\n   *       }\n   *     }\n   *   }),\n   *   TE.match(\n   *     error => {\n   *       console.error(error);\n   *     },\n   *     () => {\n   *       console.log('The scanner was closed');\n   *     }\n   *   ),\n   * );\n   */\n  readonly openFp: WithChecksFp<\n    (options: OpenOptions) => TE.TaskEither<PostEventError, void>,\n    true\n  >;\n\n  /**\n   * @see openFp\n   */\n  readonly open: WithChecks<(options: OpenOptions) => BetterPromise<void>, true>;\n}\n","import { on } from '@tma.js/bridge';\nimport { function as fn } from 'fp-ts';\n\nimport { QrScanner } from '@/features/QrScanner/QrScanner.js';\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withVersion } from '@/fn-options/withVersion.js';\n\nfunction instantiate() {\n  return new QrScanner({\n    ...fn.pipe(sharedFeatureOptions(), withPostEvent, withVersion),\n    onClosed(listener) {\n      return on('scan_qr_popup_closed', listener);\n    },\n    onTextReceived(listener) {\n      return on('qr_text_received', event => {\n        listener(event.data);\n      });\n    },\n  });\n}\n\nexport const qrScanner = /* @__PURE__*/ instantiate();\n","import type { PostEventError, SecondaryButtonPosition } from '@tma.js/bridge';\nimport { computed, type Computed } from '@tma.js/signals';\nimport type { RGB } from '@tma.js/types';\nimport { either as E } from 'fp-ts';\n\nimport { Button, type ButtonOptions } from '@/composables/Button.js';\nimport { access } from '@/helpers/access.js';\nimport { createIsSupportedSignal } from '@/helpers/createIsSupportedSignal.js';\nimport type { MaybeAccessor } from '@/types.js';\nimport type { WithChecks, WithChecksFp } from '@/with-checks/withChecksFp.js';\n\ntype SecondaryButtonEither = E.Either<PostEventError, void>;\n\nexport interface SecondaryButtonState {\n  isVisible: boolean;\n  bgColor?: RGB;\n  hasShineEffect: boolean;\n  isEnabled: boolean;\n  isLoaderVisible: boolean;\n  text: string;\n  textColor?: RGB;\n  position: SecondaryButtonPosition;\n}\n\nexport interface SecondaryButtonOptions extends Omit<\n  ButtonOptions<SecondaryButtonState, 'web_app_setup_secondary_button'>,\n  'initialState' | 'method' | 'payload'\n> {\n  /**\n   * Default values for different kinds of the button properties.\n   */\n  defaults: {\n    bgColor: MaybeAccessor<RGB>;\n    textColor: MaybeAccessor<RGB>;\n  };\n}\n\n/**\n * @since Mini Apps v7.10\n */\nexport class SecondaryButton {\n  constructor({ defaults, ...options }: SecondaryButtonOptions) {\n    const button = new Button({\n      ...options,\n      initialState: {\n        hasShineEffect: false,\n        isEnabled: true,\n        isLoaderVisible: false,\n        isVisible: false,\n        text: 'Cancel',\n        position: 'left',\n      },\n      method: 'web_app_setup_secondary_button',\n      payload: state => ({\n        has_shine_effect: state.hasShineEffect,\n        is_visible: state.isVisible,\n        is_active: state.isEnabled,\n        is_progress_visible: state.isLoaderVisible,\n        text: state.text,\n        color: state.bgColor,\n        text_color: state.textColor,\n        position: state.position,\n      }),\n    });\n\n    const withDefault = (\n      field: 'bgColor' | 'textColor',\n      getDefault: MaybeAccessor<RGB>,\n    ) => {\n      const fromState = button.stateGetter(field);\n      return computed(() => fromState() || access(getDefault));\n    };\n\n    this.isSupported = createIsSupportedSignal('web_app_setup_secondary_button', options.version);\n    this.bgColor = withDefault('bgColor', defaults.bgColor);\n    this.textColor = withDefault('textColor', defaults.textColor);\n    this.position = button.stateGetter('position');\n    this.hasShineEffect = button.stateGetter('hasShineEffect');\n    this.isEnabled = button.stateGetter('isEnabled');\n    this.isLoaderVisible = button.stateGetter('isLoaderVisible');\n    this.text = button.stateGetter('text');\n    this.isVisible = button.stateGetter('isVisible');\n    this.isMounted = button.isMounted;\n    this.state = button.state;\n\n    [this.setPosition, this.setPositionFp] = button.stateSetters('position');\n    [this.setBgColor, this.setBgColorFp] = button.stateSetters('bgColor');\n    [this.setTextColor, this.setTextColorFp] = button.stateSetters('textColor');\n    [\n      [this.disableShineEffect, this.disableShineEffectFp],\n      [this.enableShineEffect, this.enableShineEffectFp],\n    ] = button.stateBoolSetters('hasShineEffect');\n    [\n      [this.disable, this.disableFp],\n      [this.enable, this.enableFp],\n    ] = button.stateBoolSetters('isEnabled');\n    [\n      [this.hideLoader, this.hideLoaderFp],\n      [this.showLoader, this.showLoaderFp],\n    ] = button.stateBoolSetters('isLoaderVisible');\n\n    [this.setText, this.setTextFp] = button.stateSetters('text');\n    [[this.hide, this.hideFp], [this.show, this.showFp]] = button.stateBoolSetters('isVisible');\n    this.setParams = button.setState;\n    this.setParamsFp = button.setStateFp;\n    this.onClick = button.onClick;\n    this.onClickFp = button.onClickFp;\n    this.offClick = button.offClick;\n    this.offClickFp = button.offClickFp;\n    this.mount = button.mount;\n    this.mountFp = button.mountFp;\n    this.unmount = button.unmount;\n  }\n\n  //#region Properties.\n  /**\n   * Signal indicating if the component is supported.\n   */\n  readonly isSupported: Computed<boolean>;\n\n  /**\n   * The button position relative to the main one.\n   */\n  readonly position: Computed<SecondaryButtonPosition>;\n\n  /**\n   * The button background color.\n   */\n  readonly bgColor: Computed<RGB>;\n\n  /**\n   * True if the button has a shining effect.\n   */\n  readonly hasShineEffect: Computed<boolean>;\n\n  /**\n   * True if the button is clickable.\n   */\n  readonly isEnabled: Computed<boolean>;\n\n  /**\n   * True if the button loader is visible.\n   */\n  readonly isLoaderVisible: Computed<boolean>;\n\n  /**\n   * True if the button is visible.\n   */\n  readonly isVisible: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is currently mounted.\n   */\n  readonly isMounted: Computed<boolean>;\n\n  /**\n   * The complete button state.\n   */\n  readonly state: Computed<SecondaryButtonState>;\n\n  /**\n   * The button displayed text.\n   */\n  readonly text: Computed<string>;\n\n  /**\n   * The button text color.\n   *\n   * Note that this value is computed based on the external defaults. For\n   * example, if not explicitly set, this value may be equal to one of theme\n   * params colors.\n   */\n  readonly textColor: Computed<RGB>;\n  //#endregion\n\n  //#region Methods.\n  /**\n   * Shows the button.\n   * @since Mini Apps v7.10\n   */\n  readonly showFp: WithChecksFp<() => SecondaryButtonEither, true>;\n\n  /**\n   * @see showFp\n   */\n  readonly show: WithChecks<() => void, true>;\n\n  /**\n   * Hides the button.\n   * @since Mini Apps v7.10\n   */\n  readonly hideFp: WithChecksFp<() => SecondaryButtonEither, true>;\n\n  /**\n   * @see hideFp\n   */\n  readonly hide: WithChecks<() => void, true>;\n\n  /**\n   * Enables the button.\n   * @since Mini Apps v7.10\n   */\n  readonly enableFp: WithChecksFp<() => SecondaryButtonEither, true>;\n\n  /**\n   * @see enableFp\n   */\n  readonly enable: WithChecks<() => void, true>;\n\n  /**\n   * Enables the button.\n   * @since Mini Apps v7.10\n   */\n  readonly enableShineEffectFp: WithChecksFp<() => SecondaryButtonEither, true>;\n\n  /**\n   * @see enableShineEffectFp\n   */\n  readonly enableShineEffect: WithChecks<() => void, true>;\n\n  /**\n   * Disables the button.\n   * @since Mini Apps v7.10\n   */\n  readonly disableFp: WithChecksFp<() => SecondaryButtonEither, true>;\n\n  /**\n   * @see disableFp\n   */\n  readonly disable: WithChecks<() => void, true>;\n\n  /**\n   * Enables the button.\n   * @since Mini Apps v7.10\n   */\n  readonly disableShineEffectFp: WithChecksFp<() => SecondaryButtonEither, true>;\n\n  /**\n   * @see disableShineEffectFp\n   */\n  readonly disableShineEffect: WithChecks<() => void, true>;\n\n  /**\n   * Updates the button background color.\n   * @since Mini Apps v7.10\n   */\n  readonly setBgColorFp: WithChecksFp<(value: RGB) => SecondaryButtonEither, true>;\n\n  /**\n   * @see setBgColorFp\n   */\n  readonly setBgColor: WithChecks<(value: RGB) => void, true>;\n\n  /**\n   * Updates the button text color.\n   * @since Mini Apps v7.10\n   */\n  readonly setTextColorFp: WithChecksFp<(value: RGB) => SecondaryButtonEither, true>;\n\n  /**\n   * @see setTextColorFp\n   */\n  readonly setTextColor: WithChecks<(value: RGB) => void, true>;\n\n  /**\n   * Updates the button text.\n   * @since Mini Apps v7.10\n   */\n  readonly setTextFp: WithChecksFp<(value: string) => SecondaryButtonEither, true>;\n\n  /**\n   * @see setTextFp\n   */\n  readonly setText: WithChecks<(value: string) => void, true>;\n\n  /**\n   * Updates the button position.\n   * @since Mini Apps v7.10\n   */\n  readonly setPositionFp: WithChecksFp<\n    (position: SecondaryButtonPosition) => SecondaryButtonEither,\n    true\n  >;\n\n  /**\n   * @see setPositionFp\n   */\n  readonly setPosition: WithChecks<(position: SecondaryButtonPosition) => void, true>;\n\n  /**\n   * Shows the button loader.\n   * @since Mini Apps v7.10\n   */\n  readonly showLoaderFp: WithChecksFp<() => SecondaryButtonEither, true>;\n\n  /**\n   * @see showLoaderFp\n   */\n  readonly showLoader: WithChecks<() => void, true>;\n\n  /**\n   * Hides the button loader.\n   * @since Mini Apps v7.10\n   */\n  readonly hideLoaderFp: WithChecksFp<() => SecondaryButtonEither, true>;\n\n  /**\n   * @see hideLoaderFp\n   */\n  readonly hideLoader: WithChecks<() => void, true>;\n\n  /**\n   * Updates the button state.\n   * @param state - updates to apply.\n   * @since Mini Apps v7.10\n   * @example\n   * button.setParams({\n   *   text: 'Submit',\n   *   isEnabled: true,\n   *   hasShineEffect: true,\n   * });\n   */\n  readonly setParamsFp: WithChecksFp<\n    (state: Partial<SecondaryButtonState>) => SecondaryButtonEither,\n    true\n  >;\n\n  /**\n   * @see setParamsFp\n   */\n  readonly setParams: WithChecks<(state: Partial<SecondaryButtonState>) => void, true>;\n\n  /**\n   * Mounts the component restoring its state.\n   * @since Mini Apps v7.10\n   */\n  readonly mountFp: WithChecksFp<() => void, true>;\n\n  /**\n   * @see mountFp\n   */\n  readonly mount: WithChecks<() => void, true>;\n\n  /**\n   * Unmounts the component.\n   */\n  readonly unmount: () => void;\n\n  /**\n   * Adds a new button listener.\n   * @param listener - event listener.\n   * @param once - should the listener be called only once.\n   * @returns A function to remove bound listener.\n   * @since Mini Apps v7.10\n   * @example\n   * const off = button.onClick(() => {\n   *   console.log('User clicked the button');\n   *   off();\n   * });\n   */\n  readonly onClickFp: WithChecksFp<(listener: VoidFunction, once?: boolean) => VoidFunction, true>;\n\n  /**\n   * @see onClick\n   */\n  readonly onClick: WithChecks<(listener: VoidFunction, once?: boolean) => VoidFunction, true>;\n\n  /**\n   * Removes the button click listener.\n   * @param listener - event listener.\n   * @param once - should the listener be called only once.\n   * @since Mini Apps v7.10\n   * @example\n   * function listener() {\n   *   console.log('User clicked the button');\n   *   button.offClick(listener);\n   * }\n   * button.onClick(listener);\n   */\n  readonly offClickFp: WithChecksFp<(listener: VoidFunction, once?: boolean) => void, true>;\n\n  /**\n   * @see offClick\n   */\n  readonly offClick: WithChecks<(listener: VoidFunction, once?: boolean) => void, true>;\n  //#endregion\n}\n","import { computed } from '@tma.js/signals';\n\nimport { miniApp } from '@/features/MiniApp/instance.js';\nimport { SecondaryButton } from '@/features/SecondaryButton/SecondaryButton.js';\nimport { themeParams } from '@/features/ThemeParams/instance.js';\nimport { bottomButtonOptions } from '@/fn-options/bottomButtonOptions.js';\n\nfunction instantiate() {\n  return new SecondaryButton(\n    bottomButtonOptions('secondaryButton', 'secondary_button_pressed', {\n      bgColor: computed(() => miniApp.bottomBarColorRgb() || '#000000'),\n      textColor: computed(() => themeParams.buttonColor() || '#2481cc'),\n    }),\n  );\n}\n\nexport const secondaryButton = /* @__PURE__*/ instantiate();\n","import { EventPayload, type MethodParams, type Request2CaptureFn, RequestError } from '@tma.js/bridge';\nimport { taskEither as TE, function as fn } from 'fp-ts';\n\nimport { SecureStorageMethodError } from '@/errors.js';\nimport type { SharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport type { WithCreateRequestId } from '@/fn-options/withCreateRequestId.js';\nimport type { WithRequest } from '@/fn-options/withRequest.js';\nimport type { WithVersion } from '@/fn-options/withVersion.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport {\n  createWithChecksFp,\n  type WithChecks,\n  type WithChecksFp,\n} from '@/with-checks/withChecksFp.js';\n\nexport type SecureStorageError = RequestError | SecureStorageMethodError;\n\nexport interface SecureStorageOptions extends SharedFeatureOptions,\n  WithVersion,\n  WithRequest,\n  WithCreateRequestId {\n}\n\n/**\n * @since Mini Apps v9.0\n */\nexport class SecureStorage {\n  constructor({ isTma, request, version, createRequestId }: SecureStorageOptions) {\n    const wrapSupportedTask = createWithChecksFp({\n      version,\n      requires: 'web_app_secure_storage_get_key',\n      isTma,\n      returns: 'task',\n    });\n\n    const invokeMethod = <\n      M extends (\n        | 'web_app_secure_storage_save_key'\n        | 'web_app_secure_storage_get_key'\n        | 'web_app_secure_storage_restore_key'\n        | 'web_app_secure_storage_save_key'\n        | 'web_app_secure_storage_clear'\n      ),\n      E extends (\n        | 'secure_storage_key_saved'\n        | 'secure_storage_key_received'\n        | 'secure_storage_key_restored'\n        | 'secure_storage_cleared'\n      ),\n    >(\n      method: M,\n      event: E,\n      params: Omit<MethodParams<M>, 'req_id'>,\n    ): TE.TaskEither<SecureStorageError, EventPayload<E>> => {\n      const requestId = createRequestId();\n      return fn.pipe(\n        request<M, ('secure_storage_failed' | E)[]>(method, ['secure_storage_failed', event], {\n          params: { ...params, req_id: requestId },\n          capture: (event => {\n            return 'payload' in event ? event.payload.req_id === requestId : true;\n          }) as Request2CaptureFn<('secure_storage_failed' | E)[]>,\n        }),\n        TE.chain(response => (\n          response.event === 'secure_storage_failed'\n            ? TE.left(new SecureStorageMethodError(response.payload.error || 'UNKNOWN_ERROR'))\n            : TE.right(response.payload as EventPayload<E>)\n        )),\n      );\n    };\n\n    this.getItemFp = wrapSupportedTask(key => {\n      return fn.pipe(\n        invokeMethod('web_app_secure_storage_get_key', 'secure_storage_key_received', { key }),\n        TE.map(payload => ({\n          value: payload.value,\n          canRestore: !!payload.can_restore,\n        })),\n      );\n    });\n    this.setItemFp = wrapSupportedTask((key, value) => {\n      return fn.pipe(\n        invokeMethod('web_app_secure_storage_save_key', 'secure_storage_key_saved', { key, value }),\n        TE.map(() => undefined),\n      );\n    });\n    this.deleteItemFp = wrapSupportedTask(key => {\n      return this.setItemFp(key, null);\n    });\n    this.clearFp = wrapSupportedTask(() => {\n      return fn.pipe(\n        invokeMethod('web_app_secure_storage_clear', 'secure_storage_cleared', {}),\n        TE.map(() => undefined),\n      );\n    });\n    this.restoreItemFp = wrapSupportedTask(key => {\n      return fn.pipe(\n        invokeMethod('web_app_secure_storage_restore_key', 'secure_storage_key_restored', { key }),\n        TE.map(payload => payload.value),\n      );\n    });\n\n    this.getItem = throwifyWithChecksFp(this.getItemFp);\n    this.setItem = throwifyWithChecksFp(this.setItemFp);\n    this.deleteItem = throwifyWithChecksFp(this.deleteItemFp);\n    this.clear = throwifyWithChecksFp(this.clearFp);\n    this.restoreItem = throwifyWithChecksFp(this.restoreItemFp);\n  }\n\n  /**\n    * Retrieves an item using its key.\n    * @since Mini Apps v9.0\n    */\n  readonly getItemFp: WithChecksFp<\n    (key: string) => TE.TaskEither<SecureStorageError, {\n      value: string | null;\n      canRestore: boolean;\n    }>,\n    true\n  >;\n\n  /**\n   * @see getItemFp\n   */\n  readonly getItem: WithChecks<\n    (key: string) => Promise<{ value: string | null; canRestore: boolean }>,\n    true\n  >;\n\n  /**\n   * Restores an item from the storage.\n   * @since Mini Apps v9.0\n   */\n  readonly restoreItemFp: WithChecksFp<\n    (key: string) => TE.TaskEither<SecureStorageError, string | null>,\n    true\n  >;\n\n  /**\n   * @see restoreItemFp\n   */\n  readonly restoreItem: WithChecks<(key: string) => Promise<string | null>, true>;\n\n  /**\n    * Sets a new item in the storage.\n    * @since Mini Apps v9.0\n    */\n  readonly setItemFp: WithChecksFp<\n    (key: string, value: string | null) => TE.TaskEither<SecureStorageError, void>,\n    true\n  >;\n\n  /**\n   * @see setItemFp\n   */\n  readonly setItem: WithChecks<(key: string, value: string | null) => Promise<void>, true>;\n\n  /**\n    * Removes a key from the storage.\n    * @since Mini Apps v9.0\n    */\n  readonly deleteItemFp: WithChecksFp<\n    (key: string) => TE.TaskEither<SecureStorageError, void>,\n    true\n  >;\n\n  /**\n   * @see deleteItemFp\n   */\n  readonly deleteItem: WithChecks<(key: string) => Promise<void>, true>;\n\n  /**\n    * Removes all keys from the storage.\n    * @since Mini Apps v9.0\n    */\n  readonly clearFp: WithChecksFp<() => TE.TaskEither<SecureStorageError, void>, true>;\n\n  /**\n   * @see clearFp\n   */\n  readonly clear: WithChecks<() => Promise<void>, true>;\n}\n","import { function as fn } from 'fp-ts';\n\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withCreateRequestId } from '@/fn-options/withCreateRequestId.js';\nimport { withRequest } from '@/fn-options/withRequest.js';\nimport { withVersion } from '@/fn-options/withVersion.js';\n\nimport { SecureStorage } from './SecureStorage.js';\n\nfunction instantiate() {\n  return new SecureStorage(fn.pipe(\n    sharedFeatureOptions(),\n    withVersion,\n    withRequest,\n    withCreateRequestId,\n  ));\n}\n\nexport const secureStorage = /* @__PURE__*/ instantiate();\n","import type { PostEventError } from '@tma.js/bridge';\nimport type { Computed } from '@tma.js/signals';\nimport { either as E } from 'fp-ts';\n\nimport { Button, type ButtonOptions } from '@/composables/Button.js';\nimport type { WithChecksFp, WithChecks } from '@/with-checks/withChecksFp.js';\n\nexport interface SettingsButtonState {\n  isVisible: boolean;\n}\n\nexport type SettingsButtonOptions = Omit<\n  ButtonOptions<SettingsButtonState, 'web_app_setup_settings_button'>,\n  'method' | 'payload' | 'initialState'\n>;\n\n/**\n * @since Mini Apps v6.10\n */\nexport class SettingsButton {\n  constructor(options: SettingsButtonOptions) {\n    const button = new Button({\n      ...options,\n      method: 'web_app_setup_settings_button',\n      payload: state => ({ is_visible: state.isVisible }),\n      initialState: { isVisible: false },\n    });\n\n    this.isVisible = button.stateGetter('isVisible');\n    this.isMounted = button.isMounted;\n    this.isSupported = button.isSupported;\n    [[this.hide, this.hideFp], [this.show, this.showFp]] = button.stateBoolSetters('isVisible');\n    this.onClick = button.onClick;\n    this.onClickFp = button.onClickFp;\n    this.offClick = button.offClick;\n    this.offClickFp = button.offClickFp;\n    this.mount = button.mount;\n    this.mountFp = button.mountFp;\n    this.unmount = button.unmount;\n  }\n\n  /**\n   * Signal indicating if the component is currently visible.\n   */\n  readonly isVisible: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is currently mounted.\n   */\n  readonly isMounted: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is supported.\n   */\n  readonly isSupported: Computed<boolean>;\n\n  /**\n   * Hides the button.\n   * @since Mini Apps v6.10\n   */\n  readonly hideFp: WithChecksFp<() => E.Either<PostEventError, void>, true>;\n\n  /**\n   * @see hideFp\n   */\n  readonly hide: WithChecks<() => void, true>;\n\n  /**\n   * Shows the button.\n   * @since Mini Apps v6.10\n   */\n  readonly showFp: WithChecksFp<() => E.Either<PostEventError, void>, true>;\n\n  /**\n   * @see showFp\n   */\n  readonly show: WithChecks<() => void, true>;\n\n  /**\n   * Adds a new button listener.\n   * @param listener - event listener.\n   * @param once - should the listener be called only once.\n   * @returns A function to remove bound listener.\n   * @since Mini Apps v6.10\n   * @example\n   * const off = button.onClick(() => {\n   *   console.log('User clicked the button');\n   *   off();\n   * });\n   */\n  readonly onClickFp: WithChecksFp<\n    (listener: VoidFunction, once?: boolean) => VoidFunction,\n    true\n  >;\n\n  /**\n   * @see onClickFp\n   */\n  readonly onClick: WithChecks<(listener: VoidFunction, once?: boolean) => VoidFunction, true>;\n\n  /**\n   * Removes the button click listener.\n   * @param listener - event listener.\n   * @param once - should the listener be called only once.\n   * @since Mini Apps v6.10\n   * @example\n   * function listener() {\n   *   console.log('User clicked the button');\n   *   button.offClick(listener);\n   * }\n   * button.onClick(listener);\n   */\n  readonly offClickFp: WithChecksFp<\n    (listener: VoidFunction, once?: boolean) => void,\n    true\n  >;\n\n  /**\n   * @see offClickFp\n   */\n  readonly offClick: WithChecks<(listener: VoidFunction, once?: boolean) => void, true>;\n\n  /**\n   * Mounts the component restoring its state.\n   * @since Mini Apps v6.10\n   */\n  readonly mountFp: WithChecksFp<() => void, true>;\n\n  /**\n   * @see mountFp\n   */\n  readonly mount: WithChecks<() => void, true>;\n\n  /**\n   * Unmounts the component.\n   *\n   * Note that this function does not remove listeners added via the `onClick`\n   * function, so you have to remove them on your own.\n   * @see onClick\n   */\n  readonly unmount: () => void;\n}\n","import { SettingsButton } from '@/features/SettingsButton/SettingsButton.js';\nimport { buttonOptions } from '@/fn-options/buttonOptions.js';\n\nexport const settingsButton = /* @__PURE__*/ new SettingsButton(\n  buttonOptions('settingsButton', 'settings_button_pressed'),\n);\n","import type { PostEventError } from '@tma.js/bridge';\nimport type { Computed } from '@tma.js/signals';\nimport { either as E, function as fn } from 'fp-ts';\n\nimport { Mountable } from '@/composables/Mountable.js';\nimport { Stateful } from '@/composables/Stateful.js';\nimport type { SharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport type { WithPostEvent } from '@/fn-options/withPostEvent.js';\nimport type { WithStateRestore } from '@/fn-options/withStateRestore.js';\nimport type { WithVersion } from '@/fn-options/withVersion.js';\nimport { createIsSupportedSignal } from '@/helpers/createIsSupportedSignal.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { createWithChecksFp, type WithChecks, type WithChecksFp } from '@/with-checks/withChecksFp.js';\n\nexport interface SwipeBehaviorState {\n  isVerticalEnabled: boolean;\n}\n\nexport interface SwipeBehaviorOptions\n  extends WithStateRestore<SwipeBehaviorState>,\n  WithVersion,\n  WithPostEvent,\n  SharedFeatureOptions {\n}\n\n/**\n * @since Mini Apps v7.7\n */\nexport class SwipeBehavior {\n  constructor({ postEvent, storage, isTma, isPageReload, version }: SwipeBehaviorOptions) {\n    const initialState = { isVerticalEnabled: true };\n    const stateful = new Stateful({\n      initialState,\n      onChange(state) {\n        storage.set(state);\n      },\n    });\n    const mountable = new Mountable({\n      initialState,\n      isPageReload,\n      onMounted: stateful.setState,\n      restoreState: storage.get,\n    });\n\n    const wrapOptions = { requires: 'web_app_setup_swipe_behavior', isTma, version } as const;\n    const wrapSupportedPlain = createWithChecksFp({\n      ...wrapOptions,\n      returns: 'plain',\n    });\n    const wrapMountedEither = createWithChecksFp({\n      ...wrapOptions,\n      isMounted: mountable.isMounted,\n      returns: 'either',\n    });\n\n    const setVerticalEnabled = (isVerticalEnabled: boolean) => {\n      const update = { isVerticalEnabled };\n      if (!stateful.hasDiff(update)) {\n        return E.right(undefined);\n      }\n      return fn.pipe(\n        postEvent('web_app_setup_swipe_behavior', { allow_vertical_swipe: isVerticalEnabled }),\n        E.map(() => {\n          stateful.setState(update);\n        }),\n      );\n    };\n\n    this.isSupported = createIsSupportedSignal('web_app_setup_swipe_behavior', version);\n    this.isVerticalEnabled = stateful.getter('isVerticalEnabled');\n    this.isMounted = mountable.isMounted;\n    this.disableVerticalFp = wrapMountedEither(() => {\n      return setVerticalEnabled(false);\n    });\n    this.enableVerticalFp = wrapMountedEither(() => {\n      return setVerticalEnabled(true);\n    });\n    this.mountFp = wrapSupportedPlain(() => {\n      const nothing = () => undefined;\n      return fn.pipe(mountable.mount(), E.match(nothing, nothing));\n    });\n    this.unmount = mountable.unmount;\n\n    this.disableVertical = throwifyWithChecksFp(this.disableVerticalFp);\n    this.enableVertical = throwifyWithChecksFp(this.enableVerticalFp);\n    this.mount = throwifyWithChecksFp(this.mountFp);\n  }\n\n  /**\n   * Signal indicating if the component is supported.\n   */\n  readonly isSupported: Computed<boolean>;\n\n  /**\n   * Signal indicating if vertical swipes are enabled.\n   */\n  readonly isVerticalEnabled: Computed<boolean>;\n\n  /**\n   * Signal indicating if the component is currently mounted.\n   */\n  readonly isMounted: Computed<boolean>;\n\n  /**\n   * Mounts the component restoring its state.\n   * @since Mini Apps v7.7\n   */\n  readonly mountFp: WithChecksFp<() => void, true>;\n\n  /**\n   * @see mountFp\n   */\n  readonly mount: WithChecks<() => void, true>;\n\n  /**\n   * Unmounts the component.\n   */\n  readonly unmount: () => void;\n\n  /**\n   * Disables the closing confirmation dialog.\n   * @since Mini Apps v7.7\n   */\n  readonly disableVerticalFp: WithChecksFp<() => E.Either<PostEventError, void>, true>;\n\n  /**\n   * @see disableVerticalFp\n   */\n  readonly disableVertical: WithChecks<() => void, true>;\n\n  /**\n   * Enables the closing confirmation dialog.\n   * @since Mini Apps v7.7\n   */\n  readonly enableVerticalFp: WithChecksFp<() => E.Either<PostEventError, void>, true>;\n\n  /**\n   * @see enableVerticalFp\n   */\n  readonly enableVertical: WithChecks<() => void, true>;\n}\n","import { function as fn } from 'fp-ts';\n\nimport { SwipeBehavior, type SwipeBehaviorState } from '@/features/SwipeBehavior/SwipeBehavior.js';\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withStateRestore } from '@/fn-options/withStateRestore.js';\nimport { withVersion } from '@/fn-options/withVersion.js';\n\nfunction instantiate() {\n  return new SwipeBehavior(fn.pipe(\n    sharedFeatureOptions(),\n    withPostEvent,\n    withVersion,\n    withStateRestore<SwipeBehaviorState>('swipeBehavior'),\n  ));\n}\n\nexport const swipeBehavior = /* @__PURE__*/ instantiate();\n","/**\n * Copies specified text to the clipboard.\n * @param text - text to copy.\n */\nexport async function copyTextToClipboard(text: string): Promise<void> {\n  try {\n    const { clipboard } = navigator;\n    if (clipboard) {\n      return await clipboard.writeText(text);\n    }\n  } catch {\n  }\n  const textArea = document.createElement('textarea');\n  textArea.value = text;\n\n  // Avoid scrolling to bottom\n  textArea.style.top = '0';\n  textArea.style.left = '0';\n  textArea.style.position = 'fixed';\n\n  document.body.appendChild(textArea);\n  textArea.focus();\n  textArea.select();\n\n  try {\n    document.execCommand('copy');\n  } finally {\n    document.body.removeChild(textArea);\n  }\n}\n","import { RequestError } from '@tma.js/bridge';\nimport { taskEither as TE, function as fn } from 'fp-ts';\n\nimport { AccessDeniedError } from '@/errors.js';\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withRequest, type WithRequest } from '@/fn-options/withRequest.js';\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithRequest, WithVersion {\n}\n\nexport type DownloadFileError = RequestError | AccessDeniedError;\n\nfunction create({ request, ...rest }: CreateOptions) {\n  return withChecksFp((\n    url: string,\n    fileName: string,\n    options?: AsyncOptions,\n  ): TE.TaskEither<DownloadFileError, void> => {\n    return fn.pipe(\n      request(\n        'web_app_request_file_download',\n        'file_download_requested',\n        { ...options, params: { url, file_name: fileName } },\n      ),\n      TE.chain(response => {\n        return response.status === 'downloading'\n          ? TE.right(undefined)\n          : TE.left(new AccessDeniedError('User denied the action'));\n      }),\n    );\n  }, { ...rest, requires: 'web_app_request_file_download', returns: 'task' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(\n    sharedFeatureOptions(),\n    withRequest,\n    withVersion,\n  ));\n}\n\n/**\n * Displays a native popup prompting the user to download a file.\n * @param url - the HTTPS URL of the file to be downloaded.\n * @param file - the suggested name for the downloaded file.\n * @param options - additional request execution options.\n * @since Mini Apps v8.0\n * @example\n * fn.pipe(\n *   downloadFileFp('https://telegram.org/js/telegram-web-app.js', 'telegram-sdk.js'),\n *   TE.map(() => {\n *     console.log('Downloading');\n *   })\n * )\n */\nexport const downloadFileFp = instantiate();\n\nexport const downloadFile = throwifyWithChecksFp(downloadFileFp);\n","import { taskEither as TE, function as fn } from 'fp-ts';\nimport { date, integer, number, transform, pipe as valiPipe, safeParse } from 'valibot';\n\nimport { ValidationError } from '@/errors.js';\nimport {\n  type SharedFeatureOptions,\n  sharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport {\n  type WithInvokeCustomMethod,\n  withInvokeCustomMethod,\n  type InvokeCustomMethodError,\n} from '@/fn-options/withInvokeCustomMethod.js';\nimport { type WithVersion, withVersion } from '@/fn-options/withVersion.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithInvokeCustomMethod, WithVersion {\n}\n\nexport type GetCurrentTimeError = InvokeCustomMethodError | ValidationError;\n\nfunction create({ invokeCustomMethod, ...rest }: CreateOptions) {\n  return withChecksFp((options?: AsyncOptions): TE.TaskEither<GetCurrentTimeError, Date> => {\n    return fn.pipe(\n      invokeCustomMethod('getCurrentTime', {}, options),\n      TE.chain(response => {\n        const parsed = safeParse(\n          valiPipe(number(), integer(), transform(v => new Date(v * 1000)), date()),\n          response,\n        );\n        return parsed.success\n          ? TE.right(parsed.output)\n          : TE.left(new ValidationError(response, parsed.issues));\n      }),\n    );\n  }, { ...rest, requires: 'web_app_invoke_custom_method', returns: 'task' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(\n    sharedFeatureOptions(),\n    withInvokeCustomMethod,\n    withVersion,\n  ));\n}\n\n/**\n * @returns The current time according to the Telegram server time.\n * @param options - additional options.\n * @since Mini Apps v6.9\n */\nexport const getCurrentTimeFp = instantiate();\n\n/**\n * @see getCurrentTimeFp\n */\nexport const getCurrentTime = throwifyWithChecksFp(getCurrentTimeFp);\n","import type { PostEventError } from '@tma.js/bridge';\nimport { either as E, function as fn } from 'fp-ts';\n\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent, type WithPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithPostEvent, WithVersion {\n}\n\nexport type HideKeyboardError = PostEventError;\n\nfunction create({ postEvent, ...rest }: CreateOptions) {\n  return withChecksFp((): E.Either<HideKeyboardError, void> => {\n    return postEvent('web_app_hide_keyboard');\n  }, { ...rest, returns: 'either', requires: 'web_app_hide_keyboard' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(\n    sharedFeatureOptions(),\n    withPostEvent,\n    withVersion,\n  ));\n}\n\n/**\n * Hides the on-screen keyboard, if it is currently visible. Does nothing if the keyboard is\n * not active.\n * @since Mini Apps v9.1\n */\nexport const hideKeyboardFp = instantiate();\n\n/**\n * @see hideKeyboardFp\n */\nexport const hideKeyboard = throwifyWithChecksFp(hideKeyboardFp);\n","import { captureSameReq, type RequestError } from '@tma.js/bridge';\nimport { taskEither as TE, function as fn } from 'fp-ts';\n\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withRequest, type WithRequest } from '@/fn-options/withRequest.js';\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport { createRequestId } from '@/globals/createRequestId.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithVersion, WithRequest {\n  createRequestId: () => string;\n}\n\nexport type ReadTextFromClipboardError = RequestError;\n\nfunction create({ request, createRequestId, ...rest }: CreateOptions) {\n  return withChecksFp((\n    options?: AsyncOptions,\n  ): TE.TaskEither<ReadTextFromClipboardError, string | null> => {\n    const reqId = createRequestId();\n    return fn.pipe(\n      request('web_app_read_text_from_clipboard', 'clipboard_text_received', {\n        ...options,\n        params: { req_id: reqId },\n        capture: captureSameReq(reqId),\n      }),\n      TE.map(({ data = null }) => data),\n    );\n  }, { ...rest, requires: 'web_app_read_text_from_clipboard', returns: 'task' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create({\n    ...fn.pipe(\n      sharedFeatureOptions(),\n      withVersion,\n      withRequest,\n    ),\n    createRequestId,\n  });\n}\n\n/**\n * Reads a text from the clipboard and returns a `string` or `null`. `null` is returned\n * in one of the following cases:\n * - A value in the clipboard is not a text.\n * - Access to the clipboard is not granted.\n * @since Mini Apps v6.4\n */\nexport const readTextFromClipboardFp = instantiate();\n\nexport const readTextFromClipboard = throwifyWithChecksFp(readTextFromClipboardFp);\n","export interface AndroidDeviceData {\n  appVersion?: string;\n  manufacturer?: string;\n  model?: string;\n  androidVersion?: string;\n  sdkVersion?: number;\n  performanceClass?: 'LOW' | 'AVERAGE' | 'HIGH' | string;\n}\n\n/**\n * Retrieves Android device data from the specified User Agent.\n * @see https://core.telegram.org/bots/webapps#additional-data-in-user-agent\n * @param userAgent - user agent.\n */\nexport function retrieveAndroidDeviceDataFrom(userAgent: string): AndroidDeviceData {\n  const result: AndroidDeviceData = {};\n  const match = userAgent.match(/Telegram-Android(?:\\/([^ ]+))?(?: (\\([^)]+\\))?|$)/);\n  if (match) {\n    const [, appVersion, systemInfo] = match;\n    appVersion && (result.appVersion = appVersion);\n    systemInfo && systemInfo\n      .slice(1, systemInfo.length - 1)\n      .split(';')\n      .forEach(item => {\n        const [key, value] = item.trim().split(' ');\n        if (key === 'Android') {\n          result.androidVersion = value;\n        } else if (key === 'SDK') {\n          const parsed = parseInt(value, 10);\n          parsed && (result.sdkVersion = parsed);\n        } else if (value) {\n          result.manufacturer = key;\n          result.model = value;\n        } else {\n          result.performanceClass = key;\n        }\n      });\n  }\n  return result;\n}\n","import {\n  type AndroidDeviceData,\n  retrieveAndroidDeviceDataFrom,\n} from './retrieveAndroidDeviceDataFrom.js';\n\n/**\n * Retrieves Android device data from the navigator.userAgent.\n * @see https://core.telegram.org/bots/webapps#additional-data-in-user-agent\n */\nexport function retrieveAndroidDeviceData(): AndroidDeviceData {\n  return retrieveAndroidDeviceDataFrom(navigator.userAgent);\n}\n","import type { PostEventError } from '@tma.js/bridge';\nimport { either as E, function as fn } from 'fp-ts';\n\nimport { InvalidArgumentsError } from '@/errors.js';\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent, type WithPostEvent } from '@/fn-options/withPostEvent.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithPostEvent {\n}\n\nexport type SendDataError = PostEventError | InvalidArgumentsError;\n\nfunction create({ postEvent, ...rest }: CreateOptions) {\n  return withChecksFp((data: string): E.Either<SendDataError, void> => {\n    const { size } = new Blob([data]);\n    if (!size || size > 4096) {\n      return E.left(\n        new InvalidArgumentsError(size\n          ? 'Maximum size of data to send is 4096 bytes'\n          : 'Attempted to send empty data'),\n      );\n    }\n    return postEvent('web_app_data_send', { data });\n  }, { ...rest, returns: 'either' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(sharedFeatureOptions(), withPostEvent));\n}\n\n/**\n * Sends data to the bot.\n *\n * When this method called, a service message sent to the bot containing the data of the length\n * up to 4096 bytes, and the Mini App closed.\n *\n * See the field `web_app_data` in the class [Message](https://core.telegram.org/bots/api#message).\n *\n * This method is only available for Mini Apps launched via a Keyboard button.\n * @param data - data to send to bot.\n */\nexport const sendDataFp = instantiate();\n\n/**\n * @see sendDataFp\n */\nexport const sendData = throwifyWithChecksFp(sendDataFp);\n","import { RequestError } from '@tma.js/bridge';\nimport { taskEither as TE, function as fn } from 'fp-ts';\n\nimport { ShareMessageError } from '@/errors.js';\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withRequest, type WithRequest } from '@/fn-options/withRequest.js';\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport type { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithRequest, WithVersion {\n}\n\nexport type ShareMessageFnError = RequestError | ShareMessageError;\n\nfunction create({ request, ...rest }: CreateOptions) {\n  return withChecksFp((\n    messageId: string,\n    options?: AsyncOptions,\n  ): TE.TaskEither<ShareMessageFnError, void> => {\n    return fn.pipe(\n      request(\n        'web_app_send_prepared_message',\n        ['prepared_message_failed', 'prepared_message_sent'],\n        {\n          ...options,\n          params: { id: messageId },\n        },\n      ),\n      TE.chain(response => (\n        response.event === 'prepared_message_failed'\n          ? TE.left(new ShareMessageError(response.payload.error))\n          : TE.right(undefined)\n      )),\n    );\n  }, { ...rest, requires: 'web_app_send_prepared_message', returns: 'task' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(\n    sharedFeatureOptions(),\n    withRequest,\n    withVersion,\n  ));\n}\n\n/**\n * Opens a dialog allowing the user to share a message provided by the bot.\n * @since Mini Apps v8.0\n */\nexport const shareMessageFp = instantiate();\n\n/**\n * @see shareMessageFp\n */\nexport const shareMessage = throwifyWithChecksFp(shareMessageFp);\n","import type { PostEventError } from '@tma.js/bridge';\nimport { either as E, function as fn } from 'fp-ts';\n\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent, type WithPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithPostEvent, WithVersion {\n}\n\nexport interface ShareStoryOptions {\n  /**\n   * The caption to be added to the media.\n   * 0-200 characters for regular users and 0-2048 characters for premium subscribers.\n   * @see https://telegram.org/faq_premium#telegram-premium\n   */\n  text?: string;\n  /**\n   * An object that describes a widget link to be included in the story.\n   * Note that only premium subscribers can post stories with links.\n   * @see https://telegram.org/faq_premium#telegram-premium\n   */\n  widgetLink?: {\n    /**\n     * The URL to be included in the story.\n     */\n    url: string;\n    /**\n     * The name to be displayed for the widget link, 0-48 characters.\n     */\n    name?: string;\n  };\n}\n\nexport type ShareStoryError = PostEventError;\n\nfunction create({ postEvent, ...rest }: CreateOptions) {\n  return withChecksFp((\n    mediaUrl: string,\n    options: ShareStoryOptions = {},\n  ): E.Either<ShareStoryError, void> => {\n    return postEvent('web_app_share_to_story', {\n      text: options.text,\n      media_url: mediaUrl,\n      widget_link: options.widgetLink,\n    });\n  }, { ...rest, requires: 'web_app_share_to_story', returns: 'either' });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create(fn.pipe(\n    sharedFeatureOptions(),\n    withPostEvent,\n    withVersion,\n  ));\n}\n\n/**\n * Opens the native story editor.\n * @since Mini Apps v7.8\n * @example\n * fn.pipe(\n *   shareStory('https://example.com/background.png', {\n *     text: 'Look at this cool group!',\n *     widgetLink: {\n *       url: 'https://t.me/heyqbnk',\n *       name: 'Vlad\\'s community',\n *     },\n *   }),\n *   TE.match(error => {\n *     console.error('Something went wrong', error);\n *   }, () => {\n *     console.log('Call was successful');\n *   }),\n * );\n */\nexport const shareStoryFp = instantiate();\n\n/**\n * @see shareStoryFp\n */\nexport const shareStory = throwifyWithChecksFp(shareStoryFp);\n","import { createSignal } from '@/globals/signals-registry.js';\n\n/**\n * True if the application is launched in inline mode.\n */\nexport const isInlineMode = createSignal(false);\n","import type { PostEventError, SwitchInlineQueryChatType } from '@tma.js/bridge';\nimport { either as E, function as fn } from 'fp-ts';\n\nimport {\n  sharedFeatureOptions,\n  type SharedFeatureOptions,\n} from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent, type WithPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withVersion, type WithVersion } from '@/fn-options/withVersion.js';\nimport { isInlineMode } from '@/globals/isInlineMode.js';\nimport { access } from '@/helpers/access.js';\nimport type { MaybeAccessor } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { withChecksFp } from '@/with-checks/withChecksFp.js';\n\ninterface CreateOptions extends SharedFeatureOptions, WithPostEvent, WithVersion {\n  isInlineMode: MaybeAccessor<boolean>;\n}\n\nexport type SwitchInlineQueryError = PostEventError;\n\nfunction create({ isInlineMode, postEvent, ...rest }: CreateOptions) {\n  return withChecksFp((\n    query: string,\n    chatTypes?: SwitchInlineQueryChatType[],\n  ): E.Either<SwitchInlineQueryError, void> => {\n    return postEvent('web_app_switch_inline_query', {\n      query: query,\n      chat_types: chatTypes || [],\n    });\n  }, {\n    ...rest,\n    requires: {\n      every: ['web_app_switch_inline_query', () => {\n        return access(isInlineMode)\n          ? undefined\n          : 'The application must be launched in the inline mode';\n      }],\n    },\n    returns: 'either',\n  });\n}\n\n// #__NO_SIDE_EFFECTS__\nfunction instantiate() {\n  return create({\n    ...fn.pipe(\n      sharedFeatureOptions(),\n      withPostEvent,\n      withVersion,\n    ),\n    isInlineMode,\n  });\n}\n\n/**\n * Inserts the bot's username and the specified inline query in the current chat's input field.\n * Query may be empty, in which case only the bot's username will be inserted. The client prompts\n * the user to choose a specific chat, then opens that chat and inserts the bot's username and\n * the specified inline query in the input field.\n * @param query - text which should be inserted in the input after the current bot name. Max\n * length is 256 symbols.\n * @param chatTypes - List of chat types which could be chosen to send the message. Could be an\n * empty list.\n * @since Mini Apps v6.7\n * @example\n * fn.pipe(\n *   switchInlineQuery('my query goes here', ['users']),\n *   E.match(error => {\n *     console.error('Something went wrong', error);\n *   }, () => {\n *     console.log('Call was successful');\n *   }),\n * );\n */\nexport const switchInlineQueryFp = instantiate();\n\n/**\n * @see switchInlineQueryFp\n */\nexport const switchInlineQuery = throwifyWithChecksFp(switchInlineQueryFp);\n","import {\n  type SafeAreaInsets,\n  type EventListener,\n  supports,\n  type RequestError,\n  type PostEventError,\n} from '@tma.js/bridge';\nimport { Computed, computed, signal } from '@tma.js/signals';\nimport { camelToKebab } from '@tma.js/toolkit';\nimport { BetterPromise } from 'better-promises';\nimport { either as E, taskEither as TE, function as fn } from 'fp-ts';\n\nimport { AsyncMountable } from '@/composables/AsyncMountable.js';\nimport { Stateful } from '@/composables/Stateful.js';\nimport { CSSVarsBoundError, FullscreenFailedError } from '@/errors.js';\nimport { SharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { WithPostEvent } from '@/fn-options/withPostEvent.js';\nimport { WithRequest } from '@/fn-options/withRequest.js';\nimport { WithStateRestore } from '@/fn-options/withStateRestore.js';\nimport { WithVersion } from '@/fn-options/withVersion.js';\nimport { access } from '@/helpers/access.js';\nimport { deleteCssVar, setCssVar } from '@/helpers/css-vars.js';\nimport { AsyncOptions } from '@/types.js';\nimport { throwifyWithChecksFp } from '@/with-checks/throwifyWithChecksFp.js';\nimport { createWithChecksFp, WithChecks, WithChecksFp } from '@/with-checks/withChecksFp.js';\n\ntype FullscreenError = FullscreenFailedError | RequestError;\ntype ViewportChangedEventListener = EventListener<'viewport_changed'>;\ntype FullscreenChangedEventListener = EventListener<'fullscreen_changed'>;\ntype SafeAreaInsetsChangedEventListener = EventListener<'safe_area_changed'>;\ntype SafeAreaInsetCSSVarKey = `safeAreaInset${Capitalize<keyof SafeAreaInsets>}`;\n\nexport type GetCSSVarNameKey =\n  | 'width'\n  | 'height'\n  | 'stableHeight'\n  | SafeAreaInsetCSSVarKey\n  | `content${Capitalize<SafeAreaInsetCSSVarKey>}`;\n\nexport type GetCSSVarNameFn = (key: GetCSSVarNameKey) => string | null | undefined | false;\n\nexport interface ViewportState {\n  contentSafeAreaInsets: SafeAreaInsets;\n  height: number;\n  isExpanded: boolean;\n  isFullscreen: boolean;\n  safeAreaInsets: SafeAreaInsets;\n  stableHeight: number;\n  width: number;\n}\n\ntype WithListeners<On extends string, Off extends string, L> = {\n  [K in On | Off]: (listener: L) => void;\n};\n\nexport interface ViewportOptions<EViewportStable, EFullscreen>\n  extends WithStateRestore<ViewportState>,\n  WithVersion,\n  WithRequest,\n  WithPostEvent,\n  WithListeners<'onViewportChanged', 'offViewportChanged', ViewportChangedEventListener>,\n  WithListeners<'onFullscreenChanged', 'offFullscreenChanged', FullscreenChangedEventListener>,\n  WithListeners<'onSafeAreaInsetsChanged', 'offSafeAreaInsetsChanged', SafeAreaInsetsChangedEventListener>,\n  WithListeners<'onContentSafeAreaInsetsChanged', 'offContentSafeAreaInsetsChanged', SafeAreaInsetsChangedEventListener>,\n  SharedFeatureOptions {\n  /**\n   * True if the viewport is stable.\n   */\n  isViewportStable: boolean | (() => E.Either<EViewportStable, boolean>);\n  /**\n   * True if the application was opened in fullscreen initially.\n   */\n  isFullscreen: boolean | (() => E.Either<EFullscreen, boolean>);\n}\n\nexport class Viewport<EViewportStable, EFullscreen> {\n  constructor({\n    storage,\n    isPageReload,\n    onContentSafeAreaInsetsChanged,\n    onSafeAreaInsetsChanged,\n    onViewportChanged,\n    onFullscreenChanged,\n    offContentSafeAreaInsetsChanged,\n    offFullscreenChanged,\n    offSafeAreaInsetsChanged,\n    offViewportChanged,\n    request,\n    isViewportStable,\n    isFullscreen,\n    isTma,\n    version,\n    postEvent,\n  }: ViewportOptions<EViewportStable, EFullscreen>) {\n    const initialInsets: SafeAreaInsets = { top: 0, right: 0, left: 0, bottom: 0 };\n    const stateful = new Stateful<ViewportState>({\n      initialState: {\n        contentSafeAreaInsets: initialInsets,\n        height: 0,\n        isExpanded: false,\n        isFullscreen: false,\n        safeAreaInsets: initialInsets,\n        stableHeight: 0,\n        width: 0,\n      },\n      onChange: storage.set,\n    });\n\n    const viewportChangedListener: ViewportChangedEventListener = event => {\n      stateful.setState({\n        isExpanded: event.is_expanded,\n        height: event.height,\n        width: event.width,\n        stableHeight: event.is_state_stable ? event.height : undefined,\n      });\n    };\n    const fullscreenChangedListener: FullscreenChangedEventListener = event => {\n      stateful.setState({ isFullscreen: event.is_fullscreen });\n    };\n    const safeAreaInsetsChangedListener: SafeAreaInsetsChangedEventListener = event => {\n      stateful.setState({ safeAreaInsets: event });\n    };\n    const contentSafeAreaInsetsChangedListener: SafeAreaInsetsChangedEventListener = event => {\n      stateful.setState({ contentSafeAreaInsets: event });\n    };\n\n    const mountable = new AsyncMountable({\n      initialState(options) {\n        const genRequestInsets = (kind: 'safe-area' | 'content-safe-area') => {\n          return () => {\n            const [method, event] = kind === 'safe-area'\n              ? ['web_app_request_safe_area', 'safe_area_changed'] as const\n              : ['web_app_request_content_safe_area', 'content_safe_area_changed'] as const;\n\n            if (!supports(method, access(version))) {\n              return TE.right({ top: 0, left: 0, right: 0, bottom: 0 });\n            }\n            return request(method, event, options);\n          };\n        };\n        const genFlag = <E>(flag: boolean | (() => E.Either<E, boolean>)) => {\n          return () => (\n            typeof flag === 'boolean'\n              ? TE.right(flag)\n              : TE.fromEither(flag())\n          );\n        };\n\n        return fn.pipe(\n          TE.Do,\n          TE.bindW('safeAreaInsets', genRequestInsets('safe-area')),\n          TE.bindW('contentSafeAreaInsets', genRequestInsets('content-safe-area')),\n          TE.bindW('isFullscreen', genFlag(isFullscreen)),\n          TE.bindW('isViewportStable', genFlag(isViewportStable)),\n          TE.chainW(({ isViewportStable, ...shared }) => {\n            if (isViewportStable) {\n              return TE.right({\n                ...shared,\n                height: window.innerHeight,\n                isExpanded: true,\n                stableHeight: window.innerHeight,\n                width: window.innerWidth,\n              });\n            }\n            return fn.pipe(\n              request('web_app_request_viewport', 'viewport_changed', options),\n              TE.map(viewport => ({\n                ...shared,\n                height: viewport.height,\n                isExpanded: viewport.is_expanded,\n                stableHeight: viewport.is_state_stable ? viewport.height : 0,\n                width: viewport.width,\n              })),\n            );\n          }),\n        );\n      },\n      isPageReload,\n      onMounted(state) {\n        onViewportChanged(viewportChangedListener);\n        onFullscreenChanged(fullscreenChangedListener);\n        onSafeAreaInsetsChanged(safeAreaInsetsChangedListener);\n        onContentSafeAreaInsetsChanged(contentSafeAreaInsetsChangedListener);\n        stateful.setState(state);\n      },\n      onUnmounted() {\n        offViewportChanged(viewportChangedListener);\n        offFullscreenChanged(fullscreenChangedListener);\n        offSafeAreaInsetsChanged(safeAreaInsetsChangedListener);\n        offContentSafeAreaInsetsChanged(contentSafeAreaInsetsChangedListener);\n      },\n      restoreState: storage.get,\n    });\n\n    const saBased = <K extends keyof SafeAreaInsets>(key: K) => {\n      return computed(() => this.safeAreaInsets()[key]);\n    };\n    const csaBased = <K extends keyof SafeAreaInsets>(key: K) => {\n      return computed(() => this.contentSafeAreaInsets()[key]);\n    };\n\n    this.state = stateful.state;\n    this.height = stateful.getter('height');\n    this.stableHeight = stateful.getter('stableHeight');\n    this.width = stateful.getter('width');\n    this.isExpanded = stateful.getter('isExpanded');\n    this.safeAreaInsets = stateful.getter('safeAreaInsets');\n    this.safeAreaInsetTop = saBased('top');\n    this.safeAreaInsetBottom = saBased('bottom');\n    this.safeAreaInsetLeft = saBased('left');\n    this.safeAreaInsetRight = saBased('right');\n    this.contentSafeAreaInsets = stateful.getter('contentSafeAreaInsets');\n    this.contentSafeAreaInsetTop = csaBased('top');\n    this.contentSafeAreaInsetBottom = csaBased('bottom');\n    this.contentSafeAreaInsetLeft = csaBased('left');\n    this.contentSafeAreaInsetRight = csaBased('right');\n\n    const wrapTask = createWithChecksFp({ isTma, returns: 'task' });\n    const wrapMountedEither = createWithChecksFp({\n      isTma,\n      returns: 'either',\n    });\n    const wrapFullscreenTask = createWithChecksFp({\n      isTma,\n      requires: 'web_app_request_fullscreen',\n      version,\n      returns: 'task',\n    });\n    const genFullscreenFn = (enable: boolean) => {\n      return wrapFullscreenTask((options?: AsyncOptions) => {\n        return fn.pipe(\n          request(\n            enable ? 'web_app_request_fullscreen' : 'web_app_exit_fullscreen',\n            ['fullscreen_changed', 'fullscreen_failed'],\n            options,\n          ),\n          TE.chain(response => {\n            if (\n              response.event === 'fullscreen_failed'\n              && response.payload.error !== 'ALREADY_FULLSCREEN'\n            ) {\n              return TE.left(new FullscreenFailedError(response.payload.error));\n            }\n            stateful.setState({\n              isFullscreen: 'is_fullscreen' in response.payload\n                ? response.payload.is_fullscreen\n                : true,\n            });\n            return TE.right(undefined);\n          }),\n        );\n      });\n    };\n\n    // Mount.\n    this.isMounted = mountable.isMounted;\n    this.mountFp = wrapTask(mountable.mount);\n    this.mount = throwifyWithChecksFp(this.mountFp);\n\n    // Fullscreen.\n    this.isFullscreen = stateful.getter('isFullscreen');\n    this.requestFullscreenFp = genFullscreenFn(true);\n    this.requestFullscreen = throwifyWithChecksFp(this.requestFullscreenFp);\n    this.exitFullscreenFp = genFullscreenFn(false);\n    this.exitFullscreen = throwifyWithChecksFp(this.exitFullscreenFp);\n\n    // CSS vars.\n    const isCssVarsBound = signal(false);\n    this.isCssVarsBound = computed(isCssVarsBound);\n    this.bindCssVarsFp = wrapMountedEither(\n      (getCSSVarName?: GetCSSVarNameFn) => {\n        if (isCssVarsBound()) {\n          return E.left(new CSSVarsBoundError());\n        }\n        getCSSVarName ||= prop => `--tg-viewport-${camelToKebab(prop)}`;\n\n        const settings = ([\n          ['height', this.height],\n          ['stableHeight', this.stableHeight],\n          ['width', this.width],\n          ['safeAreaInsetTop', this.safeAreaInsetTop],\n          ['safeAreaInsetBottom', this.safeAreaInsetBottom],\n          ['safeAreaInsetLeft', this.safeAreaInsetLeft],\n          ['safeAreaInsetRight', this.safeAreaInsetRight],\n          ['contentSafeAreaInsetTop', this.contentSafeAreaInsetTop],\n          ['contentSafeAreaInsetBottom', this.contentSafeAreaInsetBottom],\n          ['contentSafeAreaInsetLeft', this.contentSafeAreaInsetLeft],\n          ['contentSafeAreaInsetRight', this.contentSafeAreaInsetRight],\n        ] as const).reduce<{\n          update: VoidFunction;\n          removeListener: VoidFunction;\n          cssVar: string;\n        }[]>((acc, [key, signal]) => {\n          const cssVar = getCSSVarName(key);\n          if (cssVar) {\n            const update = () => {\n              setCssVar(cssVar, `${signal()}px`);\n            };\n            acc.push({ update, removeListener: signal.sub(update), cssVar });\n          }\n          return acc;\n        }, []);\n\n        settings.forEach(setting => {\n          setting.update();\n        });\n        isCssVarsBound.set(true);\n\n        return E.right(() => {\n          settings.forEach(s => {\n            s.removeListener();\n            deleteCssVar(s.cssVar);\n          });\n          isCssVarsBound.set(false);\n        });\n      },\n    );\n    this.bindCssVars = throwifyWithChecksFp(this.bindCssVarsFp);\n\n    // Other methods.\n    this.expandFp = wrapMountedEither(() => postEvent('web_app_expand'));\n    this.expand = throwifyWithChecksFp(this.expandFp);\n  }\n\n  //#region Other properties.\n  /**\n   * Complete component state.\n   */\n  readonly state: Computed<ViewportState>;\n\n  /**\n   * Signal containing the current height of the **visible area** of the Mini App.\n   *\n   * The application can display just the top part of the Mini App, with its\n   * lower part remaining outside the screen area. From this position, the user\n   * can \"pull\" the Mini App to its maximum height, while the bot can do the same\n   * by calling `expand` method. As the position of the Mini App changes, the\n   * current height value of the visible area will be updated  in real time.\n   *\n   * Please note that the refresh rate of this value is not sufficient to\n   * smoothly follow the lower border of the window. It should not be used to pin\n   * interface elements to the bottom of the visible area. It's more appropriate\n   * to use the value of the `stableHeight` field for this purpose.\n   *\n   * @see stableHeight\n   */\n  readonly height: Computed<number>;\n\n  /**\n   * Signal containing the height of the visible area of the Mini App in its last stable state.\n   *\n   * The application can display just the top part of the Mini App, with its\n   * lower part remaining outside the screen area. From this position, the user\n   * can \"pull\" the Mini App to its maximum height, while the application can do\n   * the same by calling `expand` method.\n   *\n   * Unlike the value of `height`, the value of `stableHeight` does not change as\n   * the position of the Mini App changes with user gestures or during\n   * animations. The value of `stableHeight` will be updated after all gestures\n   * and animations are completed and the Mini App reaches its final size.\n   *\n   * @see height\n   */\n  readonly stableHeight: Computed<number>;\n\n  /**\n   * Signal containing the currently visible area width.\n   */\n  readonly width: Computed<number>;\n\n  /**\n   * Signal indicating if the Mini App is expanded to the maximum available height. Otherwise,\n   * if the Mini App occupies part of the screen and can be expanded to the full\n   * height using the `expand` method.\n   */\n  readonly isExpanded: Computed<boolean>;\n\n  /**\n   * Signal indicating if the current viewport height is stable and is not going to change in\n   * the next moment.\n   */\n  readonly isStable = computed(() => this.height() === this.stableHeight());\n  //#endregion\n\n  //#region Content safe area insets.\n  /**\n   * Signal containing content safe area insets.\n   */\n  readonly contentSafeAreaInsets: Computed<SafeAreaInsets>;\n\n  /**\n   * Signal containing top content safe area inset.\n   */\n  readonly contentSafeAreaInsetTop: Computed<number>;\n\n  /**\n   * Signal containing left content safe area inset.\n   */\n  readonly contentSafeAreaInsetLeft: Computed<number>;\n\n  /**\n   * Signal containing right content safe area inset.\n   */\n  readonly contentSafeAreaInsetRight: Computed<number>;\n\n  /**\n   * Signal containing bottom content safe area inset.\n   */\n  readonly contentSafeAreaInsetBottom: Computed<number>;\n  //#endregion\n\n  //#region Safe area insets.\n  /**\n   * Signal containing safe area insets.\n   */\n  readonly safeAreaInsets: Computed<SafeAreaInsets>;\n\n  /**\n   * Signal containing top safe area inset.\n   */\n  readonly safeAreaInsetTop: Computed<number>;\n\n  /**\n   * Signal containing left safe area inset.\n   */\n  readonly safeAreaInsetLeft: Computed<number>;\n\n  /**\n   * Signal containing right safe area inset.\n   */\n  readonly safeAreaInsetRight: Computed<number>;\n\n  /**\n   * Signal containing bottom safe area inset.\n   */\n  readonly safeAreaInsetBottom: Computed<number>;\n  //#endregion\n\n  //#region Fullscreen.\n  /**\n   * Signal indicating if the viewport is currently in fullscreen mode.\n   */\n  readonly isFullscreen: Computed<boolean>;\n\n  /**\n   * Requests fullscreen mode for the mini application.\n   * @since Mini Apps v8.0\n   */\n  readonly requestFullscreenFp: WithChecksFp<\n    (options?: AsyncOptions) => TE.TaskEither<FullscreenError, void>,\n    true\n  >;\n\n  /**\n   * @see requestFullscreenFp\n   */\n  readonly requestFullscreen: WithChecks<(options?: AsyncOptions) => BetterPromise<void>, true>;\n\n  /**\n   * Exits mini application from the fullscreen mode.\n   * @since Mini Apps v8.0\n   */\n  readonly exitFullscreenFp: WithChecksFp<\n    (options?: AsyncOptions) => TE.TaskEither<FullscreenError, void>,\n    true\n  >;\n\n  /**\n   * @see exitFullscreenFp\n   */\n  readonly exitFullscreen: WithChecks<(options?: AsyncOptions) => BetterPromise<void>, true>;\n  //#endregion\n\n  //#region CSS Vars.\n  /**\n   * Signal indicating if CSS variables are bound.\n   */\n  readonly isCssVarsBound: Computed<boolean>;\n\n  /**\n   * Creates CSS variables connected with the current viewport.\n   *\n   * By default, created CSS variables names are following the pattern \"--tg-theme-{name}\", where\n   * {name} is a viewport property name converted from camel case to kebab case.\n   *\n   * Default variables:\n   * - `--tg-viewport-height`\n   * - `--tg-viewport-width`\n   * - `--tg-viewport-stable-height`\n   * - `--tg-viewport-content-safe-area-inset-top`\n   * - `--tg-viewport-content-safe-area-inset-bottom`\n   * - `--tg-viewport-content-safe-area-inset-left`\n   * - `--tg-viewport-content-safe-area-inset-right`\n   * - `--tg-viewport-safe-area-inset-top`\n   * - `--tg-viewport-safe-area-inset-bottom`\n   * - `--tg-viewport-safe-area-inset-left`\n   * - `--tg-viewport-safe-area-inset-right`\n   *\n   * Variables are being automatically updated if the viewport was changed.\n   *\n   * @param getCSSVarName - function, returning computed complete CSS variable name. The CSS\n   * variable will only be defined if the function returned non-empty string value.\n   * @returns Function to stop updating variables.\n   * @example Using no arguments\n   * bindCssVarsFp();\n   * @example Using custom CSS vars generator\n   * bindCssVarsFp(key => `--my-prefix-${key}`);\n   */\n  readonly bindCssVarsFp: WithChecksFp<(getCSSVarName?: GetCSSVarNameFn) => (\n    E.Either<CSSVarsBoundError, VoidFunction>\n  ), false>;\n\n  /**\n   * @see bindCssVarsFp\n   */\n  readonly bindCssVars: WithChecks<(getCSSVarName?: GetCSSVarNameFn) => VoidFunction, false>;\n  //#endregion\n\n  //#region Mount.\n  /**\n   * Signal indicating if the component is currently mounted.\n   */\n  readonly isMounted: Computed<boolean>;\n\n  /**\n   * Mounts the component.\n   */\n  readonly mountFp: WithChecksFp<(options?: AsyncOptions) => (\n    TE.TaskEither<EFullscreen | EViewportStable | RequestError, void>\n  ), false>;\n\n  /**\n   * @see mountFp\n   */\n  readonly mount: WithChecks<(options?: AsyncOptions) => BetterPromise<void>, false>;\n  //#endregion\n\n  //#region Other methods.\n  /**\n   * A method that expands the Mini App to the maximum available height. To find\n   * out if the Mini App is expanded to the maximum height, refer to the value of\n   * the `isExpanded`.\n   */\n  readonly expandFp: WithChecksFp<() => E.Either<PostEventError, void>, false>;\n\n  /**\n   * @see expandFp\n   */\n  readonly expand: WithChecks<() => void, false>;\n  //#endregion\n}\n","import { retrieveLaunchParamsFp, on, off, type EventName, EventListener } from '@tma.js/bridge';\nimport { either as E, function as fn } from 'fp-ts';\n\nimport { Viewport, type ViewportState } from '@/features/Viewport/Viewport.js';\nimport { sharedFeatureOptions } from '@/fn-options/sharedFeatureOptions.js';\nimport { withPostEvent } from '@/fn-options/withPostEvent.js';\nimport { withRequest } from '@/fn-options/withRequest.js';\nimport { withStateRestore } from '@/fn-options/withStateRestore.js';\nimport { withVersion } from '@/fn-options/withVersion.js';\n\nfunction create() {\n  const createListeners = <E extends EventName>(event: E) => {\n    return {\n      on: (listener: EventListener<E>) => {\n        on(event, listener);\n      },\n      off: (listener: EventListener<E>) => {\n        off(event, listener);\n      },\n    };\n  };\n  const viewportListeners = createListeners('viewport_changed');\n  const fullscreenListeners = createListeners('fullscreen_changed');\n  const safeAreaListeners = createListeners('safe_area_changed');\n  const contentSafeAreaListeners = createListeners('content_safe_area_changed');\n\n  return new Viewport({\n    ...fn.pipe(\n      sharedFeatureOptions(),\n      withStateRestore<ViewportState>('viewport'),\n      withVersion,\n      withPostEvent,\n      withRequest,\n    ),\n    isFullscreen() {\n      return fn.pipe(retrieveLaunchParamsFp(), E.map(lp => !!lp.tgWebAppFullscreen));\n    },\n    isViewportStable() {\n      return fn.pipe(retrieveLaunchParamsFp(), E.map(lp => {\n        return ['macos', 'tdesktop', 'unigram', 'webk', 'weba', 'web'].includes(lp.tgWebAppPlatform);\n      }));\n    },\n    offContentSafeAreaInsetsChanged: contentSafeAreaListeners.off,\n    offFullscreenChanged: fullscreenListeners.off,\n    offSafeAreaInsetsChanged: safeAreaListeners.off,\n    offViewportChanged: viewportListeners.off,\n    onContentSafeAreaInsetsChanged: contentSafeAreaListeners.on,\n    onFullscreenChanged: fullscreenListeners.on,\n    onSafeAreaInsetsChanged: safeAreaListeners.on,\n    onViewportChanged: viewportListeners.on,\n  });\n}\n\nexport const viewport = /* @__PURE__*/ create();\n","import {\n  on,\n  logger,\n  retrieveLaunchParamsFp,\n  type RetrieveLaunchParamsError,\n  type PostEventError,\n  type PostEventFpFn,\n} from '@tma.js/bridge';\nimport { createCbCollector, throwifyFpFn } from '@tma.js/toolkit';\nimport type { Version, ThemeParams } from '@tma.js/types';\nimport { either as E, function as fn } from 'fp-ts';\n\nimport { isInlineMode } from '@/globals/isInlineMode.js';\nimport { postEventFpSignal, postEventFp, postEvent } from '@/globals/postEvent.js';\nimport { themeParams } from '@/globals/themeParams.js';\nimport { version } from '@/globals/version.js';\n\nexport interface InitOptions {\n  /**\n   * True if SDK should accept styles sent from the Telegram application.\n   * @default true\n   */\n  acceptCustomStyles?: boolean;\n  /**\n   * True if the application is launched in inline mode.\n   * @default Will be calculated based on the launch parameters' tgWebAppBotInline field.\n   */\n  isInlineMode?: boolean;\n  /**\n   * A custom `postEvent` function to use across the package.\n   * @default tma.js/bridge's postEventFp function will be used.\n   */\n  postEvent?: PostEventFpFn;\n  /**\n   * Mini application theme parameters.\n   * @default Will be calculated based on the launch parameters' tgWebAppThemeParams field.\n   */\n  themeParams?: ThemeParams;\n  /**\n   * Telegram Mini Apps version supported by the Telegram client.\n   * @default Will be calculated based on the launch parameters' tgWebAppVersion field.\n   */\n  version?: Version;\n}\n\n/**\n * Initializes the SDK allowing it to properly handle events, sent from the native Telegram\n * application. This function also configure the package's global dependencies (functions,\n * variables used across the package).\n * @param options - function options.\n * @returns A function, to perform a cleanup.\n */\nexport function initFp(\n  options: InitOptions = {},\n): E.Either<RetrieveLaunchParamsError | PostEventError, VoidFunction> {\n  const {\n    version: optionsVersion,\n    isInlineMode: optionsInlineMode,\n    themeParams: optionsThemeParams,\n  } = options;\n\n  if (optionsVersion && typeof optionsInlineMode === 'boolean' && optionsThemeParams) {\n    version.set(optionsVersion);\n    isInlineMode.set(optionsInlineMode);\n    themeParams.set(optionsThemeParams);\n  } else {\n    const error = fn.pipe(retrieveLaunchParamsFp(), E.matchW(\n      err => err,\n      lp => {\n        version.set(optionsVersion || lp.tgWebAppVersion);\n        isInlineMode.set(typeof optionsInlineMode === 'boolean'\n          ? optionsInlineMode\n          : !!lp.tgWebAppBotInline);\n        themeParams.set(optionsThemeParams || lp.tgWebAppThemeParams);\n      },\n    ));\n    if (error) {\n      return E.left(error);\n    }\n  }\n  if (options.postEvent) {\n    postEventFpSignal.set(options.postEvent);\n  }\n\n  const [addCleanup, cleanup] = createCbCollector(\n    on('reload_iframe', () => {\n      logger().log('Received a request to reload the page');\n      postEvent('iframe_will_reload');\n      window.location.reload();\n    }),\n  );\n\n  const { acceptCustomStyles = true } = options;\n  if (acceptCustomStyles) {\n    const style = document.createElement('style');\n    style.id = 'telegram-custom-styles';\n    document.head.appendChild(style);\n\n    addCleanup(\n      on('set_custom_style', html => {\n        // It is safe to use innerHTML here as long as style tag has a special behavior related\n        // to the specified content.\n        // In case any script will be passed here, it will not be executed, so XSS is not possible.\n        style.innerHTML = html;\n      }),\n      () => {\n        document.head.removeChild(style);\n      },\n    );\n  }\n\n  // Notify Telegram that the application is ready.\n  //\n  // This will result in sending style tag html content from the Telegram web application.\n  // We should call this method also to start receiving \"reload_iframe\" events from the Telegram\n  // application.\n  //\n  // It really has no effect outside non-Telegram web environment.\n  return fn.pipe(\n    postEventFp('iframe_ready', { reload_supported: true }),\n    E.map(() => {\n      logger().log('The package was initialized');\n      return cleanup;\n    }),\n  );\n}\n\n/**\n * @see initFp\n */\nexport const init = throwifyFpFn(initFp);\n"],"names":["access","value","Mountable","onMounted","restoreState","initialState","onUnmounted","isPageReload","__publicField","signal","computed","E","restored","state","fn","s","batch","removeUndefined","result","k","v","shallowEqual","a","b","aKeys","bKeys","aKey","Stateful","onChange","nextState","key","createIsSupportedSignal","method","version","supports","throwifyWithChecksFp","fn_","throwifyFpFn","args","O","data","throwifyAnyEither","msgToTuple","message","ValidationError","errorClassWithData","input","issues","CSSVarsBoundError","errorClass","DeviceStorageMethodError","error","SecureStorageMethodError","NotAvailableError","InvalidEnvError","FunctionUnavailableError","InvalidArgumentsError","cause","ConcurrentCallError","SetEmojiStatusError","AccessDeniedError","FullscreenFailedError","ShareMessageError","UnknownThemeParamsKeyError","withChecksFp","options","isTma","optionsIsSupported","returns","isSupportedSimplified","isOptionSupported","optionName","optionSettings","calculateSupportError","mode","requirements","i","requirement","calculateOptionSupportError","isSupported","isInitialized","isMounted","isAvailable","wrapError","err","TE","call","e","errMessagePrefix","supportErr","supportsOptionErr","_a","createWithChecksFp","Button","storage","onClick","offClick","postEvent","payload","stateful","mountable","wrapOptions","wrapSupportedPlain","wrapMountedEither","nothing","wrapped","setFp","setFalse","setTrue","BackButton","button","sharedFeatureOptions","isTMAFp","createFnOption","mix","obj","createSignal","initialValue","postEventFpSignal","_postEventFp","postEventFp","withPostEvent","createComponentSessionStorage","getStorageValue","setStorageValue","getFirstNavigationEntry","entry","withStateRestore","storageName","withVersion","buttonOptions","trackedClickEvent","listener","once","on","off","backButton","AsyncMountable","createNotAvailableError","eventToState","event","available","tokenSaved","deviceId","accessRequested","type","accessGranted","Biometry","request","onInfoReceived","offInfoReceived","wrapSupportedEither","wrapSupportedTask","wrapMountedTask","response","requestFp","events","_requestFp","request2Fp","_request2Fp","BetterPromise","request2","withRequest","instantiate","biometry","ClosingBehavior","setClosingConfirmation","isConfirmationEnabled","closingBehavior","CloudStorage","invokeCustomMethod","keyOrKeys","keys","values","acc","parse","record","string","array","lastRequestId","createRequestId","params","invokeCustomMethodFp","withInvokeCustomMethod","cloudStorage","DeviceStorage","invokeMethod","requestId","withCreateRequestId","deviceStorage","create","rest","requestEmojiStatusAccessFp","requestEmojiStatusAccess","customEmojiId","setEmojiStatusFp","setEmojiStatus","HapticFeedback","HAPTIC_METHOD_NAME","wrapSupported","style","hapticFeedback","addToHomeScreenFp","addToHomeScreen","checkHomeScreenStatusFp","checkHomeScreenStatus","InitData","retrieveInitData","authDateValue","canSendAfterValue","raw","retrieveLaunchParamsFp","tgWebAppData","retrieveRawInitDataFp","initData","Invoice","isOpened","toggleClosed","slug","url","hostname","pathname","match","invoice","openLinkFp","openLink","urlString","openTelegramLinkFp","openTelegramLink","text","shareURLFp","shareURL","LocationManager","locationManager","MainButton","defaults","withDefault","field","getDefault","fromState","setCssVar","name","deleteCssVar","isColorDarkFp","color","toRGBFullFp","rgb","modifier","idx","dec","isColorDark","ThemeParams","offChange","getCSSVarName","prop","snakeToKebab","forEachEntry","actualize","themeParams","globalThemeParams","bottomButtonOptions","mainButton","MiniApp","theme","onVisibilityChanged","offVisibilityChanged","visibilityChangedListener","themeChangedListener","isRGB","rgbBasedOn","computedRgbBasedOn","isCssVarsBound","addCleanup","cleanup","createCbCollector","bind","cssVar","update","camelToKebab","genColorToolset","stateKey","rawColor","rgbColor","fp","withBasicEither","returnBack","miniApp","prepareParams","title","paramsButtons","buttons","id","Popup","preparedOptions","popup","requestPhoneAccessFp","requestPhoneAccess","createComplete","getContact","toStringResult","safeParse","toParsedResult","pipeQueryToSchema","looseObject","pipeJsonToSchema","number","optional","valiPipe","transform","date","getContactWithErrorsIgnore","contact","pollContact","ctx","BetterTaskEither","res","rej","context","sleepTime","resolve","status","instantiateComplete","createParsed","requestContact","instantiateParsed","requestContactCompleteFp","requestContactComplete","requestContactFp","requestWriteAccessFp","requestWriteAccess","QrScanner","onClosed","onTextReceived","setClosed","captured","qr","addToCleanup","onSettled","isOpenedValue","qrScanner","SecondaryButton","secondaryButton","SecureStorage","secureStorage","SettingsButton","settingsButton","SwipeBehavior","setVerticalEnabled","isVerticalEnabled","swipeBehavior","copyTextToClipboard","clipboard","textArea","fileName","downloadFileFp","downloadFile","parsed","integer","getCurrentTimeFp","getCurrentTime","hideKeyboardFp","hideKeyboard","reqId","captureSameReq","readTextFromClipboardFp","readTextFromClipboard","retrieveAndroidDeviceDataFrom","userAgent","appVersion","systemInfo","item","retrieveAndroidDeviceData","size","sendDataFp","sendData","messageId","shareMessageFp","shareMessage","mediaUrl","shareStoryFp","shareStory","isInlineMode","query","chatTypes","switchInlineQueryFp","switchInlineQuery","Viewport","onContentSafeAreaInsetsChanged","onSafeAreaInsetsChanged","onViewportChanged","onFullscreenChanged","offContentSafeAreaInsetsChanged","offFullscreenChanged","offSafeAreaInsetsChanged","offViewportChanged","isViewportStable","isFullscreen","initialInsets","viewportChangedListener","fullscreenChangedListener","safeAreaInsetsChangedListener","contentSafeAreaInsetsChangedListener","genRequestInsets","kind","genFlag","flag","shared","viewport","saBased","csaBased","wrapTask","wrapFullscreenTask","genFullscreenFn","enable","settings","setting","createListeners","viewportListeners","fullscreenListeners","safeAreaListeners","contentSafeAreaListeners","lp","initFp","optionsVersion","optionsInlineMode","optionsThemeParams","logger","acceptCustomStyles","html","init"],"mappings":"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"}