{"version":3,"file":"index.js","sources":["../src/transformers.ts","../src/pipes.ts","../src/rgb.ts","../src/structures.ts","../src/parsers.ts","../src/serializers.ts"],"sourcesContent":["import {\n  type BaseIssue,\n  type BaseSchema,\n  check,\n  type CheckAction,\n  type InferOutput,\n  instance,\n  type InstanceSchema,\n  parse,\n  pipe,\n  type SchemaWithPipe,\n  string,\n  type StringSchema,\n  transform,\n  type TransformAction,\n  union,\n  type UnionSchema,\n} from 'valibot';\n\ntype RequiredSchema = BaseSchema<any, any, BaseIssue<any>>;\n\nexport type TransformJsonToSchemaAction<Schema extends RequiredSchema> = SchemaWithPipe<readonly [\n  StringSchema<any>,\n  CheckAction<string, string>,\n  TransformAction<string, unknown>,\n  Schema,\n]>;\n\nexport type TransformQueryToSchemaAction<Schema extends RequiredSchema> = SchemaWithPipe<readonly [\n  UnionSchema<[\n    StringSchema<undefined>,\n    InstanceSchema<typeof URLSearchParams, undefined>,\n  ], undefined>,\n  CheckAction<string | URLSearchParams, string>,\n  TransformAction<string | URLSearchParams, InferOutput<Schema>>,\n]>;\n\nexport function transformQueryToSchema<Schema extends RequiredSchema>(\n  schema: Schema,\n): TransformQueryToSchemaAction<Schema> {\n  const transformer = (input: string | URLSearchParams) => {\n    const result: Record<string, string | string[]> = {};\n\n    new URLSearchParams(input).forEach((value, key) => {\n      const accValue = result[key];\n      if (Array.isArray(accValue)) {\n        accValue.push(value);\n      } else if (accValue === undefined) {\n        result[key] = value;\n      } else {\n        result[key] = [accValue, value];\n      }\n    });\n\n    return parse(schema, result);\n  };\n\n  return pipe(\n    union([string(), instance(URLSearchParams)]),\n    check(input => {\n      try {\n        transformer(input);\n        return true;\n      } catch {\n        return false;\n      }\n    }, 'The value doesn\\'t match required schema'),\n    transform(transformer),\n  );\n}\n\n/**\n * @returns A transformer applying `JSON.parse` to the input.\n */\nexport function transformJsonToSchema<Schema extends RequiredSchema>(\n  schema: Schema,\n): TransformJsonToSchemaAction<Schema> {\n  return pipe(\n    string(),\n    check(input => {\n      try {\n        JSON.parse(input);\n        return true;\n      } catch {\n        return false;\n      }\n    }, 'Input is not a valid JSON value'),\n    transform(JSON.parse),\n    schema,\n  );\n}\n","import {\n  type BaseIssue,\n  type BaseSchema,\n  instance,\n  type InstanceSchema,\n  pipe,\n  type SchemaWithPipe,\n  string,\n  type StringSchema,\n  union,\n  type UnionSchema,\n} from 'valibot';\n\nimport {\n  transformJsonToSchema,\n  type TransformJsonToSchemaAction,\n  transformQueryToSchema,\n  type TransformQueryToSchemaAction,\n} from './transformers.js';\n\ntype RequiredSchema = BaseSchema<any, any, BaseIssue<any>>;\n\nexport type JsonToSchemaPipe<Schema extends RequiredSchema> = SchemaWithPipe<readonly [\n  StringSchema<undefined>,\n  TransformJsonToSchemaAction<Schema>,\n]>;\n\nexport type QueryToSchemaPipe<Schema extends RequiredSchema> = SchemaWithPipe<readonly [\n  UnionSchema<[\n    StringSchema<undefined>,\n    InstanceSchema<typeof URLSearchParams, undefined>,\n  ], undefined>,\n  TransformQueryToSchemaAction<Schema>,\n]>;\n\nexport function pipeJsonToSchema<Schema extends RequiredSchema>(\n  schema: Schema,\n): JsonToSchemaPipe<Schema> {\n  return pipe(string(), transformJsonToSchema(schema));\n}\n\nexport function pipeQueryToSchema<Schema extends RequiredSchema>(\n  schema: Schema,\n): QueryToSchemaPipe<Schema> {\n  return pipe(\n    union([string(), instance(URLSearchParams)]),\n    transformQueryToSchema(schema),\n  );\n}\n","import { throwifyFpFn } from '@tma.js/toolkit';\nimport type { RGB } from '@tma.js/types';\nimport { either as E, function as fn } from 'fp-ts';\n\nfunction guardBasedOn(re: RegExp) {\n  return (value: string): value is RGB => re.test(value);\n}\n\n/**\n * @returns True if the value has the #RGB format.\n */\nexport const isRGBShort = guardBasedOn(/^#[\\da-f]{3}$/i);\n\n/**\n * @returns True if the value has the #RGBA format.\n */\nexport const isRGBAShort = guardBasedOn(/^#[\\da-f]{4}$/i);\n\n/**\n * @returns True if the value has the #RRGGBB format.\n */\nexport const isRGB = guardBasedOn(/^#[\\da-f]{6}$/i);\n\n/**\n * @returns True if the value has the #RRGGBBAA format.\n */\nexport const isRGBA = guardBasedOn(/^#[\\da-f]{8}$/i);\n\n/**\n * @returns True if the value has any known RGB format.\n * @param value - value to check.\n */\nexport function isAnyRGB(value: string): value is RGB {\n  return [isRGB, isRGBA, isRGBShort, isRGBAShort].some(fn => fn(value));\n}\n\n/**\n * Converts a short version of RGB (#RGB) to a complete one (#RRGGBB).\n * @param value\n */\nfunction expandRgb(value: RGB): RGB {\n  let color: RGB = '#';\n  for (let i = 0; i < value.length - 1; i += 1) {\n    color += value[1 + i].repeat(2);\n  }\n  return color;\n}\n\n/**\n * Converts passed value to #RRGGBBAA format. Accepts the following color formats:\n * - `#RGB`\n * - `#RGBA`\n * - `#RRGGBB`\n * - `#RRGGBBAA`\n * - `rgb(1,2,3)`\n * - `rgba(1,2,3,4)`\n * @param value - a value to convert.\n * @returns A value in the #RRGGBBAA format.\n */\nexport function toRGBFullFp(value: string): E.Either<Error, RGB> {\n  const clean = value.replace(/\\s/g, '').toLowerCase();\n  if (/^#[\\da-f]{3}$/i.test(clean)) {\n    return E.right(expandRgb(clean.toLowerCase() + 'f' as RGB));\n  }\n\n  if (/^#[\\da-f]{4}$/i.test(clean)) {\n    return E.right(expandRgb(clean.toLowerCase() as RGB));\n  }\n\n  if (/^#[\\da-f]{6}$/i.test(clean)) {\n    return E.right(clean.toLowerCase() + 'ff' as RGB);\n  }\n\n  if (/^#[\\da-f]{8}$/i.test(clean)) {\n    return E.right(clean.toLowerCase() as RGB);\n  }\n\n  // Example valid values: rgb(0,3,10) rgba(32,114,8,0)\n  const match = clean.match(/^rgb\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3})\\)$/)\n    || clean.match(/^rgba\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3}),(\\d{1,3})\\)$/);\n\n  // If this didn't work as well, we can't extract RGB color from passed text.\n  if (!match) {\n    return E.left(new Error(`Value \"${value}\" does not satisfy any of known RGB formats.`));\n  }\n\n  // Otherwise, take R, G and B components, convert to hex and create #RRGGBB string.\n  return E.right(\n    match\n      .slice(1)\n      .reduce(\n        (acc, component) => {\n          return acc + parseInt(component, 10)\n            .toString(16)\n            .padStart(2, '0');\n        }, '#',\n      )\n      // We are adding f-s here to match the pattern: #RRGGBBAA\n      .padEnd(9, 'f') as RGB,\n  );\n}\n\n/**\n * Converts passed value to #RRGGBB format. Accepts the following color formats:\n * - `#RGB`\n * - `#RGBA`\n * - `#RRGGBB`\n * - `#RRGGBBAA`\n * - `rgb(1,2,3)`\n * - `rgba(1,2,3,4)`\n * @param value - a value to convert.\n * @returns A value in the #RRGGBB format.\n * @deprecated This function cuts the RGB's alpha channel. Use the `toRGBFullFp` function instead.\n */\nexport function toRGBFp(value: string): E.Either<Error, RGB> {\n  return fn.pipe(\n    toRGBFullFp(value),\n    E.map(rgb => rgb.slice(0, 7) as RGB),\n  );\n}\n\n/**\n * @see toRGBFp\n * @deprecated This function cuts the RGB's alpha channel. Use the `toRGBFull` function instead.\n */\nexport const toRGB = throwifyFpFn(toRGBFp);\n\n/**\n * @see toRGBFullFp\n */\nexport const toRGBFull = throwifyFpFn(toRGBFullFp);\n","import type {\n  Chat,\n  InitData,\n  KnownThemeParamsKey,\n  LaunchParams,\n  RGB,\n  User,\n} from '@tma.js/types';\nimport {\n  type BaseSchema,\n  boolean,\n  check,\n  type CheckAction,\n  date,\n  type InferOutput,\n  integer,\n  is,\n  looseObject,\n  number,\n  type NumberSchema,\n  optional,\n  pipe,\n  record,\n  type RecordSchema,\n  type SchemaWithPipe,\n  string,\n  type StringSchema,\n  transform,\n  type TransformAction,\n  union,\n  type UnionSchema,\n  unknown,\n} from 'valibot';\n\nimport { pipeJsonToSchema, pipeQueryToSchema } from './pipes.js';\nimport { isAnyRGB } from './rgb.js';\n\nexport type InitDataGenSchema = ReturnType<typeof initData>;\nexport type InitDataGenType = InferOutput<InitDataGenSchema>;\n\nexport type LaunchParamsGenSchema = ReturnType<typeof launchParams>;\nexport type LaunchParamsGenType = InferOutput<LaunchParamsGenSchema>;\n\nexport type MiniAppsMessageGenSchema = ReturnType<typeof miniAppsMessage>;\nexport type MiniAppsMessageGenType = InferOutput<MiniAppsMessageGenSchema>;\n\nexport function initDataChat() {\n  return looseObject({\n    id: number(),\n    photo_url: optional(string()),\n    type: string(),\n    title: string(),\n    username: optional(string()),\n  } satisfies { [K in keyof Chat]-?: BaseSchema<unknown, Chat[K], any> });\n}\n\nexport function initDataUser() {\n  return looseObject({\n    added_to_attachment_menu: optional(boolean()),\n    allows_write_to_pm: optional(boolean()),\n    first_name: string(),\n    id: number(),\n    is_bot: optional(boolean()),\n    is_premium: optional(boolean()),\n    last_name: optional(string()),\n    language_code: optional(string()),\n    photo_url: optional(string()),\n    username: optional(string()),\n  } satisfies { [K in keyof User]-?: BaseSchema<unknown, User[K], any> });\n}\n\nexport function initData() {\n  return looseObject({\n    auth_date: pipe(\n      string(),\n      transform(input => new Date(Number(input) * 1000)),\n      date(),\n    ),\n    can_send_after: optional(pipe(string(), transform(Number), integer())),\n    chat: optional(pipeJsonToSchema(initDataChat())),\n    chat_type: optional(string()),\n    chat_instance: optional(string()),\n    hash: string(),\n    query_id: optional(string()),\n    receiver: optional(pipeJsonToSchema(initDataUser())),\n    start_param: optional(string()),\n    signature: string(),\n    user: optional(pipeJsonToSchema(initDataUser())),\n  } satisfies { [K in keyof InitData]-?: unknown });\n}\n\nexport function initDataQuery() {\n  return pipeQueryToSchema(initData());\n}\n\nexport function themeParams() {\n  return record(\n    string(),\n    pipe(\n      union([string(), number()]),\n      transform(value => {\n        return typeof value === 'number'\n          ? `#${(value & 0x00FFFFFF).toString(16).padStart(6, '0')}`\n          : value;\n      }),\n      check(isAnyRGB),\n    ),\n  ) as RecordSchema<\n    SchemaWithPipe<[\n      StringSchema<undefined>,\n      TransformAction<string, KnownThemeParamsKey>,\n    ]>,\n    SchemaWithPipe<[\n      UnionSchema<[StringSchema<undefined>, NumberSchema<undefined>], any>,\n      TransformAction<string | number, string>,\n      CheckAction<RGB, undefined>,\n    ]>,\n    undefined\n  >;\n}\n\nexport function launchParams() {\n  const optBool = optional(pipe(string(), transform(v => v === '1')));\n\n  return looseObject({\n    tgWebAppBotInline: optBool,\n    tgWebAppData: optional(initDataQuery()),\n    tgWebAppDefaultColors: optional(pipeJsonToSchema(themeParams())),\n    tgWebAppFullscreen: optBool,\n    tgWebAppPlatform: string(),\n    tgWebAppShowSettings: optBool,\n    tgWebAppStartParam: optional(string()),\n    tgWebAppThemeParams: pipeJsonToSchema(themeParams()),\n    tgWebAppVersion: string(),\n  } satisfies { [K in keyof LaunchParams]-?: BaseSchema<any, LaunchParams[K], any> });\n}\n\nexport function launchParamsQuery() {\n  return pipeQueryToSchema(launchParams());\n}\n\n/**\n * @returns True if the passed value contains valid launch parameters query.\n */\nexport function isLaunchParamsQuery(value: string | URLSearchParams): boolean {\n  try {\n    return is(launchParamsQuery(), value);\n  } catch {\n    return false;\n  }\n}\n\nexport function miniAppsMessage() {\n  return looseObject({\n    eventType: string(),\n    eventData: optional(unknown()),\n  });\n}\n","import { throwifyFpFn } from '@tma.js/toolkit';\nimport { either as E } from 'fp-ts';\nimport { parse, type ValiError } from 'valibot';\n\nimport {\n  type InitDataGenSchema,\n  type InitDataGenType,\n  initDataQuery,\n  type LaunchParamsGenSchema,\n  type LaunchParamsGenType,\n  launchParamsQuery,\n} from './structures.js';\n\nexport type ParseInitDataQueryError = ValiError<InitDataGenSchema>;\nexport type ParseLaunchParamsQueryError = ValiError<LaunchParamsGenSchema>;\n\nexport function parseInitDataQueryFp(value: string | URLSearchParams): E.Either<\n  ParseInitDataQueryError,\n  InitDataGenType\n> {\n  return E.tryCatch(\n    () => parse(initDataQuery(), value),\n    e => e as ValiError<InitDataGenSchema>,\n  );\n}\n\nexport function parseLaunchParamsQueryFp(value: string | URLSearchParams): E.Either<\n  ParseLaunchParamsQueryError,\n  LaunchParamsGenType\n> {\n  return E.tryCatch(\n    () => parse(launchParamsQuery(), value),\n    e => e as ValiError<LaunchParamsGenSchema>,\n  );\n}\n\nexport const parseInitDataQuery = throwifyFpFn(parseInitDataQueryFp);\nexport const parseLaunchParamsQuery = throwifyFpFn(parseLaunchParamsQueryFp);\n","import type { InitData, LaunchParams } from '@tma.js/types';\nimport type { InferOutput } from 'valibot';\n\nimport type { initData, launchParams } from './structures.js';\n\nexport type InitDataLike = Partial<InferOutput<ReturnType<typeof initData>> | InitData>;\nexport type LaunchParamsLike = Partial<InferOutput<ReturnType<typeof launchParams>> | LaunchParams>;\n\n/**\n * Converts the passed object to query parameters.\n * @param value - value to serialize.\n * @param onObject - function returning serialized object value.\n */\nfunction serializeToQuery(\n  value: object,\n  onObject?: (key: string, value: object) => string,\n): string {\n  onObject ||= (_, value) => JSON.stringify(value);\n\n  return new URLSearchParams(\n    Object\n      .entries(value)\n      .reduce<[string, string][]>((acc, [key, value]) => {\n        if (Array.isArray(value)) {\n          acc.push(...value.map(v => [key, String(v)] as [string, string]));\n        } else {\n          if (value !== null && value !== undefined) {\n            acc.push([\n              key,\n              value instanceof Date\n                ? (value.getTime() / 1000 | 0).toString()\n                : typeof value === 'string' || typeof value === 'number'\n                  ? String(value)\n                  : typeof value === 'boolean'\n                    ? value ? '1' : '0'\n                    : onObject(key, value),\n            ]);\n          }\n        }\n        return acc;\n      }, []),\n  ).toString();\n}\n\n/**\n * Serializes the InitDataQuery shape.\n * @param value - value to serialize.\n */\nexport function serializeInitDataQuery(value: InitDataLike): string {\n  return serializeToQuery(value);\n}\n\n/**\n * Serializes the LaunchParamsQuery shape.\n * @param value - value to serialize.\n */\nexport function serializeLaunchParamsQuery(value: LaunchParamsLike): string {\n  return serializeToQuery(value, (k, v) => {\n    return k === 'tgWebAppData' ? serializeInitDataQuery(v as any) : JSON.stringify(v);\n  });\n}\n"],"names":["transformQueryToSchema","schema","transformer","input","result","value","key","accValue","parse","pipe","union","string","instance","check","transform","transformJsonToSchema","pipeJsonToSchema","pipeQueryToSchema","guardBasedOn","re","isRGBShort","isRGBAShort","isRGB","isRGBA","isAnyRGB","fn","expandRgb","color","i","toRGBFullFp","clean","E","match","acc","component","toRGBFp","rgb","toRGB","throwifyFpFn","toRGBFull","initDataChat","looseObject","number","optional","initDataUser","boolean","initData","date","integer","initDataQuery","themeParams","record","launchParams","optBool","v","launchParamsQuery","isLaunchParamsQuery","is","miniAppsMessage","unknown","parseInitDataQueryFp","e","parseLaunchParamsQueryFp","parseInitDataQuery","parseLaunchParamsQuery","serializeToQuery","onObject","_","serializeInitDataQuery","serializeLaunchParamsQuery","k"],"mappings":"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"}