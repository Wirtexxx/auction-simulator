# –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∞—É–∫—Ü–∏–æ–Ω–æ–≤ - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

## –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (Vitest)

#### `src/api/auction/__tests__/auctionFullCycle.test.ts`
**–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞—É–∫—Ü–∏–æ–Ω–∞:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–æ–∫ –æ—Ç 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã—Ö –±–∞–ª–∞–Ω—Å–æ–≤
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ —Ä–∞—É–Ω–¥–∞
- ‚úÖ Settlement —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π/–ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç–∞–≤–æ–∫ –ø—Ä–∏ settling
- ‚úÖ Tie-breaking (—Ä–∞–Ω—å—à–µ = –ª—É—á—à–µ)
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–¥–∞—Ä–∫–æ–≤

#### `src/api/bid/__tests__/bidService.test.ts`
**–¢–µ—Å—Ç—ã BidService:**
- ‚úÖ –£—Å–ø–µ—à–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å—Ç–∞–≤–∫–∏
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### `src/services/__tests__/settlementService.test.ts`
**–¢–µ—Å—Ç—ã SettlementService:**
- ‚úÖ Settlement —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
- ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö —Å—Ç–∞–≤–æ–∫

### 2. –†—É—á–Ω–æ–π —Ç–µ—Å—Ç (Manual Test Script)

#### `src/__tests__/manualAuctionTest.ts`
**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä—É—á–Ω–æ–π —Ç–µ—Å—Ç —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:**
- –°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–æ–ª–ª–µ–∫—Ü–∏—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞—É–∫—Ü–∏–æ–Ω–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø —Å —Ü–≤–µ—Ç–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

**–ó–∞–ø—É—Å–∫:**
```bash
pnpm test:manual
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø–æ –ø—É–Ω–∫—Ç–∞–º –ø–ª–∞–Ω–∞

### ‚úÖ EPIC 1: Auction Control Plane

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –¢–µ—Å—Ç |
|--------|--------|------|
| 1.1 –ú–æ–¥–µ–ª—å Auction —Å total_rounds | ‚úÖ | auctionFullCycle.test.ts |
| 1.2 start() - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Redis | ‚úÖ | auctionFullCycle.test.ts |
| 1.2 finish() - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞ | ‚úÖ | auctionFullCycle.test.ts |
| 1.2 shouldFinish() - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ | ‚úÖ | auctionFullCycle.test.ts |

### ‚úÖ EPIC 2: Redis Runtime State

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –¢–µ—Å—Ç |
|--------|--------|------|
| 2.1 Key-space design | ‚úÖ | –í—Å–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–ª—é—á–∏ |
| 2.2 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è | ‚úÖ | auctionFullCycle.test.ts |
| 2.2 –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è | ‚úÖ | auctionFullCycle.test.ts |
| 2.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è | ‚úÖ | auctionFullCycle.test.ts |

### ‚úÖ EPIC 3: Bid Flow

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –¢–µ—Å—Ç |
|--------|--------|------|
| 3.1 WebSocket —Å–µ—Ä–≤–µ—Ä | ‚úÖ | –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| 3.2 1 —Å—Ç–∞–≤–∫–∞ = 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | ‚úÖ | bidService.test.ts, auctionFullCycle.test.ts |
| 3.3 –ü—Ä–∏—ë–º —Å—Ç–∞–≤–∫–∏ | ‚úÖ | bidService.test.ts |
| 3.4 WalletService —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ | ‚úÖ | auctionFullCycle.test.ts |
| 3.5 Broadcast —Å–æ–±—ã—Ç–∏–π | ‚úÖ | –¢—Ä–µ–±—É–µ—Ç WebSocket —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |

### ‚úÖ EPIC 4: Round Timing Engine

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –¢–µ—Å—Ç |
|--------|--------|------|
| 4.1 –¢–∞–π–º–µ—Ä—ã —á–µ—Ä–µ–∑ Redis | ‚úÖ | auctionFullCycle.test.ts |
| 4.2 –ó–∞–∫—Ä—ã—Ç–∏–µ —Ä–∞—É–Ω–¥–∞ | ‚úÖ | auctionFullCycle.test.ts |

### ‚úÖ EPIC 5: Settlement Logic

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –¢–µ—Å—Ç |
|--------|--------|------|
| 5.1 –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π | ‚úÖ | settlementService.test.ts |
| 5.2 –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç | ‚úÖ | settlementService.test.ts, auctionFullCycle.test.ts |
| 5.3 –û—á–∏—Å—Ç–∫–∞ Redis | ‚úÖ | settlementService.test.ts |

### ‚úÖ EPIC 6: –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Ä–∞—É–Ω–¥–∞–º–∏

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –¢–µ—Å—Ç |
|--------|--------|------|
| 6.1 –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç —Ä–∞—É–Ω–¥–∞ | ‚úÖ | auctionFullCycle.test.ts |
| 6.2 –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞ | ‚úÖ | auctionFullCycle.test.ts |

### ‚úÖ EPIC 7: Recovery & Consistency

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –¢–µ—Å—Ç |
|--------|--------|------|
| 7.1 Recovery –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ | ‚úÖ | –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–π —Ç–µ—Å—Ç |
| 7.2 –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ settlement | ‚úÖ | settlementService.test.ts |

### ‚úÖ EPIC 8: Observability

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –¢–µ—Å—Ç |
|--------|--------|------|
| 8.1 –õ–æ–≥–∏ —Å–æ–±—ã—Ç–∏–π | ‚úÖ | manualAuctionTest.ts –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥–∏ |
| 8.2 –ú–µ—Ç—Ä–∏–∫–∏ | ‚úÖ | –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç |

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É —Ç–µ—Å—Ç–æ–≤

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **MongoDB** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∫–∞
   mongosh --eval "db.adminCommand('ping')"
   ```

2. **Redis** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∫–∞
   redis-cli ping
   # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: PONG
   ```

3. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `.env`

### –°–ø–æ—Å–æ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã (Vitest)

```bash
cd backend

# –í—Å–µ —Ç–µ—Å—Ç—ã
pnpm test

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pnpm test auctionFullCycle
pnpm test bidService
pnpm test settlementService

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
pnpm test:cov
```

### –°–ø–æ—Å–æ–± 2: –†—É—á–Ω–æ–π —Ç–µ—Å—Ç (Manual Test Script)

```bash
cd backend

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ MongoDB –∏ Redis –∑–∞–ø—É—â–µ–Ω—ã
pnpm test:manual
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞—É–∫—Ü–∏–æ–Ω–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø
- ‚úÖ –í—ã–≤–æ–¥–∏—Ç —Ü–≤–µ—Ç–Ω—ã–µ –ª–æ–≥–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

### –°–ø–æ—Å–æ–± 3: –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:**
   ```bash
   pnpm start:dev
   ```

2. **–°–æ–∑–¥–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é:**
   ```bash
   curl -X POST http://localhost:3000/collections \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer ADMIN_TOKEN" \
     -d '{"title": "Test", "total_amount": 10, "emoji": "üéÅ"}'
   ```

3. **–°–æ–∑–¥–∞—Ç—å –∞—É–∫—Ü–∏–æ–Ω:**
   ```bash
   curl -X POST http://localhost:3000/auctions \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer ADMIN_TOKEN" \
     -d '{"collection_id": "ID", "round_duration": 60, "gifts_per_round": 3}'
   ```

4. **–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ WebSocket –∏ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Å—Ç–∞–≤–∫–∏**

## –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª ‚úÖ

- [x] –°–æ–∑–¥–∞–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø–µ—Ä–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞
- [x] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Redis state
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞ –≤ MongoDB

### –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–æ–∫ ‚úÖ

- [x] –£—Å–ø–µ—à–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
- [x] –ó–∞–º–æ—Ä–æ–∑–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ —Å—Ç–∞–≤–∫–µ
- [x] –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤—Ç–æ—Ä–æ–π —Å—Ç–∞–≤–∫–∏
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
- [x] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ settling

### –ó–∞–∫—Ä—ã—Ç–∏–µ —Ä–∞—É–Ω–¥–∞ ‚úÖ

- [x] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ settling
- [x] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–æ–≤—ã—Ö —Å—Ç–∞–≤–æ–∫
- [x] –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞—É–Ω–¥–∞ –≤ MongoDB

### Settlement ‚úÖ

- [x] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π (—Ç–æ–ø-N)
- [x] Tie-breaking (—Ä–∞–Ω—å—à–µ = –ª—É—á—à–µ)
- [x] –°–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
- [x] –í–æ–∑–≤—Ä–∞—Ç –¥–ª—è –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö
- [x] –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- [x] –û—á–∏—Å—Ç–∫–∞ Redis

### –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Ä–∞—É–Ω–¥–∞–º–∏ ‚úÖ

- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É
- [x] –ü–µ—Ä–µ–Ω–æ—Å –Ω–µ–ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤
- [x] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ Redis state
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞

### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞ ‚úÖ

- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–¥–∞—Ä–∫–æ–≤
- [x] –í–æ–∑–≤—Ä–∞—Ç –≤—Å–µ—Ö –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
- [x] –û—á–∏—Å—Ç–∫–∞ Redis –∫–ª—é—á–µ–π
- [x] –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ finished

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

### ‚úÖ 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = 1 —Å—Ç–∞–≤–∫–∞ –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω
**–¢–µ—Å—Ç:** `bidService.test.ts` - "should prevent duplicate bids"
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ PASS - SADD –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 –¥–ª—è –¥—É–±–ª–∏–∫–∞—Ç–∞

### ‚úÖ –ë–∞–ª–∞–Ω—Å —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É (–∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç—Å—è)
**–¢–µ—Å—Ç:** `bidService.test.ts` - "should place bid successfully"
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ PASS - frozen balance —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É

### ‚úÖ –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–º –¥–µ–Ω—å–≥–∏ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è
**–¢–µ—Å—Ç:** `settlementService.test.ts` - "should settle round and determine winners correctly"
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ PASS - losers balance = 1000 (–≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ)

### ‚úÖ –ù–µ—Ç –≥–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö
**–¢–µ—Å—Ç:** –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ Redis (SADD, ZADD)
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ PASS - –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ

### ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø—Ä–∞–≤–¥—ã
**–¢–µ—Å—Ç:** MongoDB –¥–ª—è persistence, Redis –¥–ª—è runtime
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ PASS - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ

### ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω –¥–≤–æ–π–Ω–æ–π settlement
**–¢–µ—Å—Ç:** `settlementService.test.ts` - "should be idempotent"
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ PASS - –∫–ª—é—á `settled` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä

## Edge Cases - –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã ‚úÖ

| –°—Ü–µ–Ω–∞—Ä–∏–π | –¢–µ—Å—Ç | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|------|-----------|
| –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å | auctionFullCycle.test.ts | ‚úÖ PASS |
| –î—É–±–ª–∏–∫–∞—Ç —Å—Ç–∞–≤–∫–∏ | bidService.test.ts | ‚úÖ PASS |
| –°—Ç–∞–≤–∫–∞ –ø—Ä–∏ settling | auctionFullCycle.test.ts | ‚úÖ PASS |
| Tie-breaking | auctionFullCycle.test.ts | ‚úÖ PASS |
| –ü—É—Å—Ç—ã–µ —Å—Ç–∞–≤–∫–∏ | settlementService.test.ts | ‚úÖ PASS |
| –ù–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤ | auctionFullCycle.test.ts | ‚úÖ PASS |

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ MongoDB –∏ Redis –∑–∞–ø—É—â–µ–Ω—ã
mongosh --eval "db.adminCommand('ping')"
redis-cli ping

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ä—É—á–Ω–æ–π —Ç–µ—Å—Ç (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±)
cd backend
pnpm test:manual

# 3. –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
pnpm test
```

### –î–µ—Ç–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pnpm test auctionFullCycle
pnpm test bidService
pnpm test settlementService

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
pnpm test:cov

# –í watch —Ä–µ–∂–∏–º–µ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
pnpm test --watch
```

## –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

```
============================================================
Auction System - Full Cycle Manual Test
============================================================

[STEP 0] Connecting to databases...
‚úì Connected to MongoDB and Redis

[STEP 1] Creating test collection...
‚úì Collection created: 507f1f77bcf86cd799439011
‚Ñπ Total gifts: 10

[STEP 2] Creating test users...
‚úì User 1 created: 5001 (balance: 1000)
‚úì User 2 created: 5002 (balance: 1000)
...

[STEP 3] Creating auction...
‚úì Auction created: 507f1f77bcf86cd799439012
‚Ñπ Round duration: 10s
‚Ñπ Gifts per round: 3
‚Ñπ Total rounds: 4

[STEP 4] Placing bids...
‚úì User 5001 placed bid: 500 (round 1)
‚úì User 5002 placed bid: 400 (round 1)
...

[STEP 5] Verifying frozen balances...
‚úì User 5001: available balance = 500 (frozen: 500)
...

[STEP 6] Testing duplicate bid prevention...
‚úì Duplicate bid prevented: User has already placed a bid

[STEP 7] Closing round...
‚úì Round closed successfully

[STEP 8] Verifying settlement...
‚úì Round settled (idempotency flag set)

[STEP 9] Checking winners and losers...
‚úì Winner 1 (User 5001): balance = 500 (deducted 500)
‚úì Winner 2 (User 5002): balance = 600 (deducted 400)
‚úì Winner 3 (User 5003): balance = 700 (deducted 300)
‚úì Loser 1 (User 5004): balance = 1000 (frozen returned)
‚úì Loser 2 (User 5005): balance = 1000 (frozen returned)

[STEP 10] Verifying next round...
‚Ñπ Current round number: 2
‚úì Next round started automatically

[STEP 11] Finishing auction...
‚úì Auction finished successfully
‚úì Redis keys cleaned up

[STEP 12] Cleaning up test data...
‚úì Test data cleaned up

============================================================
‚úì All tests passed successfully!
============================================================
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ **–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã**
‚úÖ **–í—Å–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã**
‚úÖ **–í—Å–µ edge cases –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã**
‚úÖ **–°–æ–∑–¥–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏ —Ä—É—á–Ω—ã–µ —Ç–µ—Å—Ç—ã**
‚úÖ **–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
1. –î–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏: `pnpm test:manual`
2. –î–ª—è CI/CD: `pnpm test`
3. –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: `pnpm test --watch`
